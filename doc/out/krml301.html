<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <meta name="generator" content="Madoko, version 1.2.3" />
  <meta name="viewport" content="initial-scale=1.0" />
  <meta name="author" content="K. Rustan M. Leino" />
  <meta name="description" content="Leino mode: Start numbering at 0" />
  <title>B3: An intermediate verification language</title>
  <style type="text/css"  class="link">
  /*# sourceURL=madoko.css */
  
  .madoko .toc>.tocblock .tocblock .tocblock {
    margin-left: 2.25em;
  }
  .madoko .toc>.tocblock .tocblock {
    margin-left: 1.5em;
  }
  .madoko .toc-contents>.tocblock>.tocitem {
    font-weight: bold;
  }
  .madoko .toc {
    margin-top: 1em;
  }
  .madoko p.para-continue {
    margin-bottom: 0pt;
  }
  .madoko .para-block+p {
    margin-top: 0pt;
  }
  .madoko ul.para-block, .madoko ol.para-block {
    margin-top: 0pt;
    margin-bottom: 0pt;
  }
  .madoko ul.para-end, .madoko ol.para-end {
    margin-bottom: 1em;
  }
  .madoko dl {
    margin-left: 0em;
  }
  .madoko blockquote {
    font-style: italic;
  }
  .madoko a.localref {
    text-decoration: none;
  }
  .madoko a.localref:hover {
    text-decoration: underline;
  }
  .madoko .footnotes {
    font-size: smaller;
    margin-top: 2em;
  }
  .madoko .footnotes hr {
    width: 50%;
    text-align: left;
  }
  .madoko .footnote {
    margin-left: 1em;
  }
  .madoko .footnote-before {
    margin-left: -1em;
    width: 1em;
    display: inline-block;
  }
  .madoko .align-center, .madoko .align-center>p {
    text-align: center !important;
  }
  .madoko .align-center pre {
    text-align: left;
  }
  .madoko .align-center>* {
    margin-left: auto !important;
    margin-right: auto !important;
  }
  .madoko .align-left, .madoko .align-left>p {
    text-align: left !important;
  }
  .madoko .align-left>* {
    margin-left: 0pt !important;
    margin-right: auto !important;
  }
  .madoko .align-right, .madoko .align-right>p {
    text-align: right !important;
  }
  .madoko .align-right>* {
    margin-left: auto !important;
    margin-right: 0pt !important;
  }
  .madoko .align-center>table,
  .madoko .align-left>table,
  .madoko .align-right>table {
    text-align: left !important;
  }
  .madoko .equation-before {
    float: right;
  }
  .madoko .bibitem {
    font-size: smaller;
  }
  .madoko .bibsearch {
    font-size: x-small;
    text-decoration:none;
    color: black;
    font-family: "Segoe UI Symbol", Symbola, serif;
  }
  .madoko .block, .madoko .figure, .madoko .bibitem, .madoko .equation, .madoko div.math {
    margin-top: 1ex;
    margin-bottom: 1ex;
  }
  .madoko .figure {
    padding: 0.5em;
    margin-left: 0pt;
    margin-right: 0pt;
  }
  .madoko .hidden {
    display: none;
  }
  .madoko .invisible {
    visibility: hidden;
  }
  .madoko.preview .invisible {
    visibility: visible;
    opacity: 0.5;
  }
  .madoko code.code, .madoko span.code {
    white-space: pre-wrap;
  }
  .madoko hr, hr.madoko {
    border: none;
    border-bottom: black solid 1px;
    margin-bottom: 0.5ex;
  }
  .madoko .framed>*:first-child {
    margin-top: 0pt;
  }
  .madoko .framed>*:last-child {
    margin-bottom: 0pt;
  }
  .madoko ul.list-style-type-dash {
      list-style-type: none !important;
  }
  .madoko ul.list-style-type-dash > li:before {
      content: "\2013";
      position: absolute;
      margin-left: -1em;
  }
  .madoko table.madoko {
    border-collapse: collapse;
  }
  .madoko td, .madoko th {
    padding: 0ex 0.5ex;
    margin: 0pt;
    vertical-align: top;
  }
  .madoko .cell-border-left {
    border-left: 1px solid black;
  }
  .madoko .cell-border-right {
    border-right: 1px solid black;
  }
  .madoko thead>tr:first-child>.cell-line,
  .madoko tbody:first-child>tr:first-child>.cell-line {
    border-top: 1px solid black;
    border-bottom: none;
  }
  .madoko .cell-line, .madoko .cell-double-line {
    border-bottom: 1px solid black;
    border-top: none;
  }
  .madoko .cell-double-line {
    border-top: 1px solid black;
    padding-top: 1.5px !important;
  }
  .madoko .input-mathpre .MathJax_Display {
    text-align: left !important;
  }
  .madoko div.input-mathpre {
    text-align: left;
    margin-top: 1.5ex;
    margin-bottom: 1ex;
  }
  .madoko .math-rendering {
    text-align: left;
    white-space: pre;
    color: gray;
  }
  .madoko .mathdisplay {
    text-align: center;
  }
  .madoko span.math-rendering {
    display:inline-block;
    width:8em;
    overflow-x:auto;
    font-size:70%;
  }
  .madoko span.math-rendering::-webkit-scrollbar {
    width:4px;
  }
  .madoko .pretty table {
    border-collapse: collapse;
  }
  .madoko .pretty td {
    padding: 0em;
  }
  .madoko .pretty td.empty {
    min-width: 1.5ex;
  }
  .madoko .pretty td.expander {
    width: 100em;
  }
  body.madoko, .madoko .serif {
    font-family: Cambria,"Times New Roman","Liberation Serif","Times",serif;
  }
  .madoko .sans-serif {
    font-family: "Calibri", "Optima", sans-serif;
  }
  .madoko .symbol {
    font-family: "Segoe UI Symbol", Symbola, serif;
  }
  body.madoko {
    -webkit-text-size-adjust: 100%;       
    text-rendering: optimizeLegibility;
  }
  body.madoko {
    max-width: 88ex; 
    margin: 1em auto;
    padding: 0em 2em;
  }
  body.preview.madoko {
    padding: 0em 1em;
  }
  .madoko p {
    text-align: justify;
  }
  .madoko h1, .madoko h2, .madoko h3, .madoko h4 {
    margin-top: 1.22em;
    margin-bottom: 1ex;
  }
  .madoko h1+p, .madoko h2+p, .madoko h3+p, .madoko h4+p, .madoko h5+p  {
    margin-top: 1ex;
  }
  .madoko h5, .madoko h6 {
    margin-top: 1ex;
    font-size: 1em;
  }
  .madoko h5 {
    margin-bottom: 0.5ex;
  }
  .madoko h5 + p {
    margin-top: 0.5ex;
  }
  .madoko h6 {
    margin-bottom: 0pt;
  }
  .madoko h6 + p {
    margin-top: 0pt;
  }
  .madoko pre, .madoko code, .madoko kbd, .madoko samp, .madoko tt,
  .madoko .monospace, .madoko .token-indent, .madoko .reveal pre, .madoko .reveal code, .madoko .email {
    font-family: Consolas,"Andale Mono WT","Andale Mono",Lucida Console,Monaco,monospace,monospace;
    font-size: 0.85em;
  }
  .madoko pre code, .madoko .token-indent {
    font-size: 0.95em;
  }
  .madoko pre code {
    font-family: inherit !important;
  }
  .madoko ol.linenums li {
    background-color: white;
    list-style-type: decimal;
  }
  .madoko .remote {
    background-color: #F0FFF0;
  }
  .madoko .remote + * {
    margin-top: 0pt;
  }
  @media print {
    body.madoko {
      font-size: 10pt;
    }
    @page {
      margin: 1in 1.5in;
    }
  }
  @media only screen and (max-device-width:1024px) {
    body.madoko {
      padding: 0em 0.5em;
    }
    .madoko li {
      text-align: left;
    }
  }
  
    </style>
  
  <style>
    .pre-indented { margin-left: 20pt; }
        .pre-fenced { margin-left: 20pt; }
  </style>
  </head>
<body class="madoko">

<div class="body madoko" style="line-adjust:0">
<div class="titleblock align-center para-block" data-line="106" style="text-align:center;line-adjust:0">
<div class="titleheader align-center" data-line="106" style="text-align:center;line-adjust:0">
<div class="title para-block" data-line="106" style="font-size:xx-large;font-weight:bold;margin-bottom:0.5ex;line-adjust:0"><span data-line="106"></span>B3: An intermediate verification language</div></div>
<div class="authors align-center" data-line="111" style="text-align:center;width:80%;line-adjust:0"><table class="authorrow columns block" data-line="111" style="margin-top:2ex;width:100%;line-adjust:0">
<tbody><tr><td class="author column" data-line="111" style="text-align:center;line-adjust:0">
<div class="authorname" data-line="111" style="font-size:large;line-adjust:0"><span data-line="111"></span>K. Rustan M. Leino</div></td></tr></tbody></table></div>
<div class="titlefooter align-center" data-line="120" style="text-align:center;margin-top:0.5ex;line-adjust:0"><span data-line="120"></span>Manuscript KRML 301, 18 February 2025</div></div>
<div class="abstract" data-line="108" style="margin-left:3em;margin-right:3em;font-size:small">
<p class="p noindent" data-line="109"><span data-line="109"></span><strong class="strong-star2">Abstract.</strong><span data-line="109"></span> This document defines the intermediate verification language B3.
With a design informed by the experience and needs of prescribing verification conditions for
Dafny, B3 aims to support the verification foundation of any similar language.</p></div><h2 id="sec-introduction" class="h1" data-line="114" data-heading-depth="1" style="display:block"><span data-line="114"></span><span class="heading-before"><span class="heading-label">0</span>.&#8194;</span><span data-line="114"></span>Introduction</h2>
<p class="p noindent" data-line="116"><span data-line="116"></span>Authoring an automated program verification is a complex task that can be broken up into two
major components with separate concerns. One component is the <span data-line="117"></span><em class="em-low1">front end</em><span data-line="117"></span>, which prescribes the
proof obligations for any given source program. The other component is the <span data-line="118"></span><em class="em-low1">back end</em><span data-line="118"></span>, which
uses algorithms that try to discharge these proof obligations. The front end is concerned
with <span data-line="120"></span><em class="em-low1">what</em><span data-line="120"></span> the proof obligations are (for the source language at hand), whereas the back end is
concerned with <span data-line="121"></span><em class="em-low1">how</em><span data-line="121"></span> to discharge the proof obligations. The front end and back end are joined
at an Intermediate Verification Language (IVL). For the front-end author, the IVL becomes a
thinking tool that suggests ways to prescribe the kinds of verification conditions that commonly
arise in a program verifier. For the back-end author, the IVL provides a primitive and precise
foundation upon which to build its algorithms.
</p>
<p class="p indent" data-line="127"><span data-line="127"></span>The back end makes use of a set of cooperating decision procedures or semi-decision procedures,
each of which is equipped to handle a particular domain (e.g., linear integer arithmetic). Such
decision procedures are provided in off-the-shelf Satisfiability Modulo Theories (SMT) solvers.
The back end works by turning the proof obligations prescribed by a given IVL program into
queries posed to one or several SMT solvers (henceforth referred to as just the <span data-line="131"></span><em class="em-low1">solver</em><span data-line="131"></span>).
</p>
<p class="p indent" data-line="133"><span data-line="133"></span>In the last 25 years, IVLs have been used effectively in dozens of automated program
verifiers. Widely used IVLs include Boogie, Why3, and Viper. For example, the verifier for the
Dafny programming language has, since its creation 17 years ago, used the Boogie 2 IVL and
tool. This long experience has developed several patterns of prescribing proof obligations that
are not well supported by Boogie 2.
</p>
<p class="p indent" data-line="139"><span data-line="139"></span>This document describes a new IVL, named B3, which incorporates support for
these common patterns. The semantics of B3 is defined by strongest postconditions and its
associated proof obligations (which, equivalently, can in the opposite direction be computed as
weakest conservative preconditions in the standard way). The semantics is presented as two operations
on a solver state <span data-line="143"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&Omega;</span></code><span data-line="143"></span>: <span data-line="143"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&Omega;</span>.extend(e)</code><span data-line="143"></span> records strongest postconditions and <span data-line="143"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&Omega;</span>.prove(e)</code><span data-line="143"></span>
indicates proof obligations. Through these two solver operations, B3 essentially defines a script
for automatically interacting with the solver.
</p>
<p class="p indent" data-line="147"><span data-line="147"></span>In contrast to the organization of a reference manual that introduces each construct with all its
details and variations, this document aims to introduce ideas in a top-down fashion, starting with
larger ideas and later going into further details and variations.
</p><h2 id="sec-overview" class="h1" data-line="151" data-heading-depth="1" style="display:block"><span data-line="151"></span><span class="heading-before"><span class="heading-label">1</span>.&#8194;</span><span data-line="151"></span>Overview</h2>
<p class="p noindent" data-line="153"><span data-line="153"></span>At the top level, B3 provides declarations to introduce types, functions, axioms, and procedures.
It builds in some primitive types, including <span data-line="154"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:teal">bool</span></code><span data-line="154"></span> and <span data-line="154"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:teal">int</span></code><span data-line="154"></span>, and operations on these.
</p>
<p class="p indent" data-line="156"><span data-line="156"></span>The following sections are ordered to first highlight the core features of the language. Later
sections add variations and unsurprising features.
</p><h2 id="sec-statements" class="h1" data-line="159" data-heading-depth="1" style="display:block"><span data-line="159"></span><span class="heading-before"><span class="heading-label">2</span>.&#8194;</span><span data-line="159"></span>Statements</h2>
<p class="p noindent" data-line="161"><span data-line="161"></span>A prominent feature of any IVL is its support for <span data-line="161"></span><em class="em-low1">control flow</em><span data-line="161"></span> and <span data-line="161"></span><em class="em-low1">data flow</em><span data-line="161"></span>. This provides
the front end a straightforward way to encode the statements of the source language, like <span data-line="162"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">if</span></code><span data-line="162"></span>
statements and assignment statements. Therefore, let<span data-line="163"></span>&#39;<span data-line="163"></span>s start with B3<span data-line="163"></span>&#39;<span data-line="163"></span>s statements.
</p>
<p class="p indent" data-line="165"><span data-line="165"></span>Here is the grammar of (the core) statements. In it, capitalized words denote non-terminal grammar
productions. As suggestive alternatives to the non-terminal <span data-line="166"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Identifier</code><span data-line="166"></span>, the grammar uses the
letters <span data-line="167"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x</code><span data-line="167"></span>, <span data-line="167"></span><code class="code code1 language-b3 lang-b3 b3 colorized">y</code><span data-line="167"></span>, <span data-line="167"></span><code class="code code1 language-b3 lang-b3 b3 colorized">z</code><span data-line="167"></span> (for variables and parameters), <span data-line="167"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&ell;</span></code><span data-line="167"></span> (for labels), <span data-line="167"></span><code class="code code1 language-b3 lang-b3 b3 colorized">F</code><span data-line="167"></span> (for functions),
and <span data-line="168"></span><code class="code code1 language-b3 lang-b3 b3 colorized">M</code><span data-line="168"></span> (for procedures).  Keywords are syntax highlighted. Punctuation is shown as is, except
for the punctuation that<span data-line="169"></span>&#39;<span data-line="169"></span>s part of the grammar definition: <span data-line="169"></span><code class="code code1 language-b3 lang-b3 b3 colorized">::=</code><span data-line="169"></span> (which defines its LHS grammar
production), <span data-line="170"></span><code class="code code1 language-b3 lang-b3 b3 colorized">|</code><span data-line="170"></span> (for choice), parentheses (for grouping), square brackets (to denote an
optional component), a suffix <span data-line="171"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped"><sup>*</sup></span></code><span data-line="171"></span> to denote 0 or more occurrences of what just precedes
it, and <span data-line="172"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped"><sup>*,</sup></span></code><span data-line="172"></span> as a variation of <span data-line="172"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped"><sup>*</sup></span></code><span data-line="172"></span> that says the occurrences are comma-separated.
Tokens that may be confused with such grammar components are enclosed in double quotes.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="175" data-line-first="176" style="display:block"><code data-line="176">Stmt ::=
  | <span style="color:blue">var</span> x: Type
  | x := Expr
  | Assertion
  | [ <span class="code-escaped">&ell;</span>: ] Block
  | <span style="color:blue">exit</span> <span class="code-escaped">&ell;</span>
  | If
  | [ <span class="code-escaped">&ell;</span>: ] Loop
  | <span style="color:blue">return</span>
  | Call
  | ...
Block ::=
  | <span style="color:maroon">&quot;</span><span style="color:maroon">{</span><span style="color:maroon">&quot;</span> Stmt<span class="code-escaped"><sup>*</sup></span> <span style="color:maroon">&quot;</span><span style="color:maroon">}</span><span style="color:maroon">&quot;</span>
If ::=
  | <span style="color:blue">if</span> Expr Block <span style="color:blue">else</span> Block
  | ...</code></pre>
<p class="p noindent para-continued" data-line="194"><span data-line="194"></span>These grammatical elements will be elaborated further later in the document.
</p>
<p class="p indent" data-line="196"><span data-line="196"></span>Blocks contain a sequence of statements. The variable declarations among those statements must
use distinct names. The language allows a block to introduce a variable that shadows a variable
with the same name in an outer block.  The scope of a variable ends at
the end of the enclosing block.  Variables can be updated with assignment statements.
</p>
<p class="p indent" data-line="201"><span data-line="201"></span>The left-hand side of an assignment must be a mutable variable. Local variables, in/out-parameters,
and out-parameters are mutable, but in-parameters are not.
</p>
<p class="p indent" data-line="204"><span data-line="204"></span>Some statements can be labeled. Subcomponents of such a statement can use an <span data-line="204"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">exit</span></code><span data-line="204"></span> statement to
exit the statement. That is, a statement <span data-line="205"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">exit</span> <span class="code-escaped">&ell;</span></code><span data-line="205"></span> is allowed only inside the statement
labeled with <span data-line="206"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&ell;</span></code><span data-line="206"></span>.  This provides outward jumps, as provided for example in a source-language
<span data-line="207"></span><code class="code code1 language-dafnyx lang-dafnyx dafnyx colorized"><span style="color:blue">break</span></code><span data-line="207"></span> statement out of a loop.
(For a variation of this statement, see section<span data-line="208"></span>&nbsp;<a href="#sec-exit-without-label" title="15.0.&#8194;Exit without argument" class="localref" style="target-element:h2"><span class="heading-label">15.0</span></a><span data-line="208"></span>.)
</p>
<p class="p indent" data-line="210"><span data-line="210"></span>The grammar shows the basic form of an <span data-line="210"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">if</span></code><span data-line="210"></span> statement. For variations of it, see section<span data-line="210"></span>&nbsp;<a href="#sec-if-variations" title="16.&#8194;Variations on conditional statements" class="localref" style="target-element:h1"><span class="heading-label">16</span></a><span data-line="210"></span>.
There are also variations on the <span data-line="211"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">var</span></code><span data-line="211"></span> statement and the assignment statement, see sections
<span data-line="212"></span><a href="#sec-havoc" title="15.1.&#8194;Havoc" class="localref" style="target-element:h2"><span class="heading-label">15.1</span></a><span data-line="212"></span> and<span data-line="212"></span>&nbsp;<a href="#sec-var-init" title="15.2.&#8194;Initializing variable declaration" class="localref" style="target-element:h2"><span class="heading-label">15.2</span></a><span data-line="212"></span>, respectively.
</p>
<p class="p indent" data-line="214"><span data-line="214"></span>Assertions are defined in sections<span data-line="214"></span>&nbsp;<a href="#sec-assertions" title="4.&#8194;Assertions" class="localref" style="target-element:h1"><span class="heading-label">4</span></a><span data-line="214"></span> and<span data-line="214"></span>&nbsp;<a href="#sec-more-assertions" title="17.&#8194;Variations on assertions" class="localref" style="target-element:h1"><span class="heading-label">17</span></a><span data-line="214"></span>,
calls are defined in section<span data-line="215"></span>&nbsp;<a href="#sec-calls" title="6.&#8194;Calls" class="localref" style="target-element:h1"><span class="heading-label">6</span></a><span data-line="215"></span>, and
the loop statement is defined in section<span data-line="216"></span>&nbsp;<a href="#sec-loops" title="10.&#8194;Loops" class="localref" style="target-element:h1"><span class="heading-label">10</span></a><span data-line="216"></span>.
</p><h2 id="sec-symbolic-execution" class="h1" data-line="218" data-heading-depth="1" style="display:block"><span data-line="218"></span><span class="heading-before"><span class="heading-label">3</span>.&#8194;</span><span data-line="218"></span>Symbolic execution</h2>
<p class="p noindent" data-line="220"><span data-line="220"></span>The statements are given a strongest-postcondition semantics, presented in terms of processing
rules that strongly hint at a symbolic execution. However, note that the semantics does not
depend on using symbolic execution. Indeed, the given <span data-line="222"></span><code class="code code1 language-b3 lang-b3 b3 colorized">extend</code><span data-line="222"></span> and <span data-line="222"></span><code class="code code1 language-b3 lang-b3 b3 colorized">prove</code><span data-line="222"></span> operations for a
statement <span data-line="223"></span><code class="code code1 language-b3 lang-b3 b3 colorized">S</code><span data-line="223"></span> are the duals of the weakest-precondition operations <span data-line="223"></span><code class="code code1 language-b3 lang-b3 b3 colorized">wlp.S</code><span data-line="223"></span> and <span data-line="223"></span><code class="code code1 language-b3 lang-b3 b3 colorized">wp.S.<span style="color:blue">true</span></code><span data-line="223"></span>.
Such a weakest-precondition semantics can be used to formulate a single verification-condition
formula for each B3 procedure (and one can also obtain a single verification-condition formula
straight from the <span data-line="226"></span><code class="code code1 language-b3 lang-b3 b3 colorized">extend</code><span data-line="226"></span> and <span data-line="226"></span><code class="code code1 language-b3 lang-b3 b3 colorized">prove</code><span data-line="226"></span> operations).  From the given semantics, it is also
possible to define an operational semantics for B3, for example a trace semantics (analogous to
what<span data-line="228"></span>&#39;<span data-line="228"></span>s in the Boogie 2 language reference manual).
</p>
<p class="p indent" data-line="230"><span data-line="230"></span>To describe the processing of statements, we first introduce its components.
</p><h3 id="sec-continuations" class="h2" data-line="232" data-heading-depth="2" style="display:block"><span data-line="232"></span><span class="heading-before"><span class="heading-label">3.0</span>.&#8194;</span><span data-line="232"></span>Continuations</h3>
<p class="p noindent" data-line="234"><span data-line="234"></span>The symbolic execution is defined for a given <span data-line="234"></span><em class="em-low1">continuation</em><span data-line="234"></span>, which is a sequence of statements,
with typical names <span data-line="235"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Ss</code><span data-line="235"></span> and <span data-line="235"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Cc</code><span data-line="235"></span>.
We denote the empty sequence by <span data-line="236"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.4922em;width:0.5307em" viewBox='34.67 57.347 5.054 4.688'><desc>$\varepsilon$</desc><g id='math-f8b1c5'><use x='34.869' y='61.836' xlink:href='#g3-34'/></g></svg></span></code><span data-line="236"></span> and use the operator <span data-line="236"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span></code><span data-line="236"></span> to denote sequence concatenation.
</p><h3 id="sec-incarnations" class="h2" data-line="238" data-heading-depth="2" style="display:block"><span data-line="238"></span><span class="heading-before"><span class="heading-label">3.1</span>.&#8194;</span><span data-line="238"></span>Incarnations</h3>
<p class="p noindent" data-line="240"><span data-line="240"></span>When symbolic execution processes an assignment to a variable, it generates a new name for the
variable and binds the new name to the value being assigned. These names thus denote <span data-line="241"></span><em class="em-low1">incarnations</em><span data-line="241"></span>
of the variable. The incarnation state is a map <span data-line="242"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&sigma;</span></code><span data-line="242"></span> from each variable to the variable<span data-line="242"></span>&#39;<span data-line="242"></span>s current
incarnation.
</p>
<p class="p indent" data-line="245"><span data-line="245"></span>To a first order of approximation, the names used for incarnations are irrelevant, provided there are
no name clashes. However, to make naming deterministic, we use names of the form <span data-line="246"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x</code><span data-line="246"></span> and <span data-line="246"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x%<span class="code-escaped"><em class="em-low1">n</em></span></code><span data-line="246"></span>, where
<span data-line="247"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x</code><span data-line="247"></span> is the name of the variable as declared in the B3 program and <span data-line="247"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped"><em class="em-low1">n</em></span></code><span data-line="247"></span> is a sequence number. When a
variable <span data-line="248"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x</code><span data-line="248"></span> is first declared, it has the name <span data-line="248"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x</code><span data-line="248"></span> (which can be used, but often isn<span data-line="248"></span>&#39;<span data-line="248"></span>t), and subsequence
assignments will use the names <span data-line="249"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x%<span class="constant" style="color:purple">0</span></code><span data-line="249"></span>, <span data-line="249"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x%<span class="constant" style="color:purple">1</span></code><span data-line="249"></span>, <span data-line="249"></span>&#8230;<span data-line="249"></span>.
</p>
<p class="p indent" data-line="251"><span data-line="251"></span>For a variable <span data-line="251"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x</code><span data-line="251"></span>, <span data-line="251"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&sigma;</span>.new(x)</code><span data-line="251"></span> denotes the next name to be used for <span data-line="251"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x</code><span data-line="251"></span>.
For an expression <span data-line="252"></span><code class="code code1 language-b3 lang-b3 b3 colorized">e</code><span data-line="252"></span>, <span data-line="252"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&sigma;</span>[e]</code><span data-line="252"></span> denotes <span data-line="252"></span><code class="code code1 language-b3 lang-b3 b3 colorized">e</code><span data-line="252"></span> in which every variable has been renamed according to
<span data-line="253"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&sigma;</span></code><span data-line="253"></span>.
For a map <span data-line="254"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&sigma;</span></code><span data-line="254"></span>, we write <span data-line="254"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&sigma;</span>[x := y]</code><span data-line="254"></span> to denote a map that is like <span data-line="254"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&sigma;</span></code><span data-line="254"></span> except that it
maps <span data-line="255"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x</code><span data-line="255"></span> to <span data-line="255"></span><code class="code code1 language-b3 lang-b3 b3 colorized">y</code><span data-line="255"></span>.
</p><h3 id="sec-solver-state" class="h2" data-line="257" data-heading-depth="2" style="display:block"><span data-line="257"></span><span class="heading-before"><span class="heading-label">3.2</span>.&#8194;</span><span data-line="257"></span>Solver state</h3>
<p class="p noindent" data-line="259"><span data-line="259"></span>Symbolic execution makes use of a solver <span data-line="259"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&Omega;</span></code><span data-line="259"></span>, whose state is essentially a logical formula (but
with additional bookkeeping information that we<span data-line="260"></span>&#39;<span data-line="260"></span>ll see later).
The two main operations on a solver state <span data-line="261"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&Omega;</span></code><span data-line="261"></span> are
</p>
<ul class="ul list-star compact" data-line="263">
<li class="li ul-li list-star-li compact-li" data-line="263"><span data-line="263"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&Omega;</span>.extend(e)</code><span data-line="263"></span> returns a new solver state that also contains the constraint (boolean expression) <span data-line="263"></span><code class="code code1 language-b3 lang-b3 b3 colorized">e</code><span data-line="263"></span>.
  In other words, it returns a state that denotes <span data-line="264"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&Omega;</span> <span class="code-escaped">&#8743;</span> e</code><span data-line="264"></span>.
</li>
<li class="li ul-li list-star-li compact-li" data-line="265"><span data-line="265"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&Omega;</span>.prove(e)</code><span data-line="265"></span> attempts prove the boolean expression <span data-line="265"></span><code class="code code1 language-b3 lang-b3 b3 colorized">e</code><span data-line="265"></span> in the state <span data-line="265"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&Omega;</span></code><span data-line="265"></span>. In other words, it
  attempts to prove the validity of the formula <span data-line="266"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.4257em;width:1.7282em" viewBox='34.67 57.981 16.459 4.054'><desc>$\Longrightarrow$</desc><g id='math-8258de'><use x='34.869' y='61.836' xlink:href='#g4-61'/><use x='40.958' y='61.836' xlink:href='#g2-41'/></g></svg></span> e</code><span data-line="266"></span>.
</li></ul>

<p class="p noindent" data-line="268"><span data-line="268"></span>As we represent it, the solver state is immutable and the definition of symbolic execution sometimes
uses the same solver state more than once. In practice, a solver may be incremental, so the interaction
with the solver may use SMT Lib <span data-line="270"></span><code class="code code1 language-b3 lang-b3 b3 colorized">PUSH</code><span data-line="270"></span> and <span data-line="270"></span><code class="code code1 language-b3 lang-b3 b3 colorized">POP</code><span data-line="270"></span> operations to efficiently accomplish what we describe here.
</p><h3 id="sec-statement-processing" class="h2" data-line="272" data-heading-depth="2" style="display:block"><span data-line="272"></span><span class="heading-before"><span class="heading-label">3.3</span>.&#8194;</span><span data-line="272"></span>Statement processing</h3>
<p class="p noindent" data-line="274"><span data-line="274"></span>Symbolic execution is defined from
</p>
<ul class="ul list-star compact" data-line="276">
<li class="li ul-li list-star-li compact-li" data-line="276"><span data-line="276"></span>a possibly empty sequence <span data-line="276"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Ss</code><span data-line="276"></span> of statements
</li>
<li class="li ul-li list-star-li compact-li" data-line="277"><span data-line="277"></span>an incarnation map <span data-line="277"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&sigma;</span></code><span data-line="277"></span>
</li>
<li class="li ul-li list-star-li compact-li" data-line="278"><span data-line="278"></span>a map <span data-line="278"></span><code class="code code1 language-b3 lang-b3 b3 colorized">B</code><span data-line="278"></span> from block names to pairs <span data-line="278"></span><code class="code code1 language-b3 lang-b3 b3 colorized">(V, Ss)</code><span data-line="278"></span> of variable sets and statement sequences
</li>
<li class="li ul-li list-star-li compact-li" data-line="279"><span data-line="279"></span>a solver state <span data-line="279"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&Omega;</span></code><span data-line="279"></span>
</li></ul>

<p class="p noindent" data-line="281"><span data-line="281"></span>The translation function <span data-line="281"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> Ss, <span class="code-escaped">&sigma;</span>, B, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span></code><span data-line="281"></span> gives a sequence a solver
commands.  These say how the state of the symbolic execution proceeds and what needs to be
proved when.  For example, if <span data-line="283"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&sigma;</span></code><span data-line="283"></span> respectively maps <span data-line="283"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x</code><span data-line="283"></span> and <span data-line="283"></span><code class="code code1 language-b3 lang-b3 b3 colorized">y</code><span data-line="283"></span> to the incarnations <span data-line="283"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x%<span class="constant" style="color:purple">4</span></code><span data-line="283"></span>
and <span data-line="284"></span><code class="code code1 language-b3 lang-b3 b3 colorized">y%<span class="constant" style="color:purple">1</span></code><span data-line="284"></span>, then, as we<span data-line="284"></span>&#39;<span data-line="284"></span>ll soon see, <span data-line="284"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> y := x + <span class="constant" style="color:purple">1</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> <span style="color:blue">check</span> x &lt; y, <span class="code-escaped">&sigma;</span>, B, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span></code><span data-line="284"></span>
gives the solver commands
</p>
<pre class="para-block pre-indented language-b3 lang-b3 b3 colorized" data-line="287" style="display:block"><code><span class="code-escaped">&Omega;</span>.extend(y%<span class="constant" style="color:purple">2</span> = x%<span class="constant" style="color:purple">4</span> + <span class="constant" style="color:purple">1</span>).prove(x%<span class="constant" style="color:purple">4</span> &lt; y%<span class="constant" style="color:purple">2</span>)</code></pre>
<p class="p noindent para-continued" data-line="289"><span data-line="289"></span>For now, we define <span data-line="289"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Process</code><span data-line="289"></span> only for a few statements, enough to give a representative idea of how the
symbolic execution works. Later sections will define <span data-line="290"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Process</code><span data-line="290"></span> for other statements.
We suppose that every block has been given a label.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="293" data-line-first="294" style="display:block"><code data-line="294">Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.4922em;width:0.5307em" viewBox='34.67 57.347 5.054 4.688'><desc>$\varepsilon$</desc><g id='math-f8b1c5'><use x='34.869' y='61.836' xlink:href='#g3-34'/></g></svg></span>, <span class="code-escaped">&sigma;</span>, B, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =

Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span style="color:blue">var</span> x: T <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> Cc, <span class="code-escaped">&sigma;</span>, B, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> Cc, <span class="code-escaped">&sigma;</span>[x := x], B, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>

Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> x := e <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> Cc, <span class="code-escaped">&sigma;</span>, B, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  let e&#39; be <span class="code-escaped">&sigma;</span>[e]
  let x&#39; be <span class="code-escaped">&sigma;</span>.new(x)
  Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> Cc, <span class="code-escaped">&sigma;</span>[x := x&#39;], B, <span class="code-escaped">&Omega;</span>.extend(x&#39; = e&#39;) <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>

Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span class="code-escaped">&ell;</span>: { Ss } <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> Cc, <span class="code-escaped">&sigma;</span>, B, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  let B&#39; be B[<span class="code-escaped">&ell;</span> := (domain of <span class="code-escaped">&sigma;</span>, Cc)]
  Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> Ss <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> <span style="color:blue">exit</span> <span class="code-escaped">&ell;</span>, <span class="code-escaped">&sigma;</span>, B&#39;, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>

Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span style="color:blue">exit</span> <span class="code-escaped">&ell;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> Cc, <span class="code-escaped">&sigma;</span>, B, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  let (V, Cc&#39;) be the value of B[<span class="code-escaped">&ell;</span>]
  let <span class="code-escaped">&sigma;</span>&#39; be <span class="code-escaped">&sigma;</span> domain-restricted to V
  Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> Cc&#39;, <span class="code-escaped">&sigma;</span>&#39;, B, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>

Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span style="color:blue">return</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> Cc, <span class="code-escaped">&sigma;</span>, B, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  let (V, Cc&#39;) be the value of B[<span style="color:blue">return</span>]
  let <span class="code-escaped">&sigma;</span>&#39; be <span class="code-escaped">&sigma;</span> domain-restricted to V
  Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> Cc&#39;, <span class="code-escaped">&sigma;</span>&#39;, B, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span></code></pre>
<p class="p noindent para-continued" data-line="319"><span data-line="319"></span>A general choice in symbolic execution is whether or not to join the two branches of an <span data-line="319"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">if</span></code><span data-line="319"></span>
before processing its continuation. Here is the version that does not do that join, but instead
processes the branches through an <span data-line="321"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">if</span></code><span data-line="321"></span> separately (quite possibly with some redundancy).
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="323" data-line-first="324" style="display:block"><code data-line="324">Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span style="color:blue">if</span> e S0 <span style="color:blue">else</span> S1 <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> Cc, <span class="code-escaped">&sigma;</span>, B, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  let e&#39; be <span class="code-escaped">&sigma;</span>[e]
  Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> S0 <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> Cc, <span class="code-escaped">&sigma;</span>, B, <span class="code-escaped">&Omega;</span>.extend(e&#39;) <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> S1 <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> Cc, <span class="code-escaped">&sigma;</span>, B, <span class="code-escaped">&Omega;</span>.extend(<span class="code-escaped">&not;</span>e&#39;) <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span></code></pre>
<p class="p noindent para-continued" data-line="330"><span data-line="330"></span>Remark: To support joins without letting branches influence each others, names of incarnations
should be generated in such a way that the numberings in two branches have no effect on each other.
For example, suppose the incarnation of a variable <span data-line="332"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x</code><span data-line="332"></span> is <span data-line="332"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x%<span class="constant" style="color:purple">8</span></code><span data-line="332"></span> upon reaching an <span data-line="332"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">if</span></code><span data-line="332"></span>. Then,
the first new incarnation inside the <span data-line="333"></span><em class="em-low1">then</em><span data-line="333"></span> branch can be <span data-line="333"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x%<span class="constant" style="color:purple">8</span>.<span class="code-escaped">then</span>.<span class="constant" style="color:purple">0</span></code><span data-line="333"></span> and the first new incarnation
inside the <span data-line="334"></span><em class="em-low1">else</em><span data-line="334"></span> branch can be <span data-line="334"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x%<span class="constant" style="color:purple">8</span>.<span class="code-escaped">else</span>.<span class="constant" style="color:purple">0</span></code><span data-line="334"></span>. The incarnation at the join of the two branches
will be <span data-line="335"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x%<span class="constant" style="color:purple">9</span></code><span data-line="335"></span>.
</p><h2 id="sec-assertions" class="h1" data-line="337" data-heading-depth="1" style="display:block"><span data-line="337"></span><span class="heading-before"><span class="heading-label">4</span>.&#8194;</span><span data-line="337"></span>Assertions</h2>
<p class="p noindent" data-line="339"><span data-line="339"></span>A core function of an IVL is to generate proof obligations. These are prescribed using
<span data-line="340"></span><em class="em-low1">assertions</em><span data-line="340"></span>, of which there are two basic forms.
The <span data-line="341"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">check</span></code><span data-line="341"></span> statement <span data-line="341"></span><em class="em-low1">checks</em><span data-line="341"></span> if a condition holds in the current state.
Checks are forgetful, meaning that they have no effect on the solver state.
Stated in terms of an operational semantics, program execution continues after a <span data-line="343"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">check</span></code><span data-line="343"></span> even if its condition does not hold.
The <span data-line="344"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">assume</span></code><span data-line="344"></span> statement lets the solver state <span data-line="344"></span><em class="em-low1">learn</em><span data-line="344"></span> a condition. This means the condition
becomes an antecedent in discharging further proof obligations.
Stated in terms of an operational semantics, any execution that would encounter an <span data-line="346"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">assume</span></code><span data-line="346"></span> with a condition that does not hold
is not considered a possible trace of the program (that is, any analysis of the program ignores such a trace).
</p>
<p class="p indent" data-line="349"><span data-line="349"></span>In simple settings, the property being checked is then learned, so the language offers an
<span data-line="350"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">assert</span></code><span data-line="350"></span> statement that combines the <span data-line="350"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">check</span></code><span data-line="350"></span> and <span data-line="350"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">assume</span></code><span data-line="350"></span> statements.
Stated in terms of an operational semantics, program execution continues after an <span data-line="351"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">assert</span></code><span data-line="351"></span> only if its condition holds.
</p>
<p class="p indent" data-line="353"><span data-line="353"></span>These three statements, along with a block that encloses a sequence of assertions, are
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="355" data-line-first="356" style="display:block"><code data-line="356">Assertion ::=
  | <span style="color:blue">check</span> Expr
  | <span style="color:blue">assume</span> Expr
  | <span style="color:blue">assert</span> Expr
  | ...
ABlock ::=
  | <span style="color:maroon">&quot;</span><span style="color:maroon">{</span><span style="color:maroon">&quot;</span> ABlockAssertion<span class="code-escaped"><sup>*</sup></span> <span style="color:maroon">&quot;</span><span style="color:maroon">}</span><span style="color:maroon">&quot;</span>
ABlockAssertion ::=
  | Assertion
  | ...</code></pre>
<p class="p noindent para-continued" data-line="368"><span data-line="368"></span>The two basic assertions are processed as follows:
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="370" data-line-first="371" style="display:block"><code data-line="371">Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span style="color:blue">check</span> e <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> Cc, <span class="code-escaped">&sigma;</span>, B, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  let e&#39; be <span class="code-escaped">&sigma;</span>[e]
  <span class="code-escaped">&Omega;</span>.prove(e&#39;)
  Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> Cc, <span class="code-escaped">&sigma;</span>, B, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span style="color:blue">assume</span> e <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> Cc, <span class="code-escaped">&sigma;</span>, B, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  let e&#39; be <span class="code-escaped">&sigma;</span>[e]
  let <span class="code-escaped">&Omega;</span>&#39; be <span class="code-escaped">&Omega;</span>.extend(e&#39;)
  Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> Cc, <span class="code-escaped">&sigma;</span>, B, <span class="code-escaped">&Omega;</span>&#39; <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span></code></pre>
<p class="p noindent para-continued" data-line="381"><span data-line="381"></span>The statement <span data-line="381"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">assert</span> e</code><span data-line="381"></span> always means <span data-line="381"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">check</span> e <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> <span style="color:blue">assume</span> e</code><span data-line="381"></span>.
</p>
<p class="p indent" data-line="383"><span data-line="383"></span>As we go along, we will sometimes need to collect the learning that<span data-line="383"></span>&#39;<span data-line="383"></span>s prescribed
by an assertion. This is done by the translation function <span data-line="384"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Learn</code><span data-line="384"></span>, which returns an
expression.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="387" data-line-first="388" style="display:block"><code data-line="388">Learn<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span style="color:blue">check</span> e, <span class="code-escaped">&sigma;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  <span style="color:blue">true</span>

Learn<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span style="color:blue">assume</span> e, <span class="code-escaped">&sigma;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  <span class="code-escaped">&sigma;</span>[e]</code></pre><h2 id="sec-procedures" class="h1" data-line="395" data-heading-depth="1" style="display:block"><span data-line="395"></span><span class="heading-before"><span class="heading-label">5</span>.&#8194;</span><span data-line="395"></span>Procedures</h2>
<p class="p noindent" data-line="397"><span data-line="397"></span>A <span data-line="397"></span><em class="em-low1">procedure</em><span data-line="397"></span> is a name, a signature, a specification, and an optional implementation.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="399" data-line-first="400" style="display:block"><code data-line="400">TopLevelDeclaration ::=
  | <span style="color:blue">procedure</span> M <span style="color:maroon">&quot;</span><span style="color:maroon">(</span><span style="color:maroon">&quot;</span> CParam<span class="code-escaped"><sup>*,</sup></span> <span style="color:maroon">&quot;</span><span style="color:maroon">)</span><span style="color:maroon">&quot;</span> Spec [ Block ]
  | ...
CParam ::=
  | [<span style="color:blue">inout</span> | <span style="color:blue">out</span>] x: Type
Spec ::=
  | PreSpecification<span class="code-escaped"><sup>*</sup></span> PostSpecification<span class="code-escaped"><sup>*</sup></span>
PreSpecification ::=
  | <span style="color:purple">requires</span> Expr
  | <span style="color:purple">requires</span> ABlock
PostSpecification ::=
  | <span style="color:purple">ensures</span> Expr
  | <span style="color:purple">ensures</span> ABlock</code></pre>
<p class="p noindent para-continued" data-line="415"><span data-line="415"></span>The comma-separated parameters of a procedure come in three kinds: in-parameters,
in/out-parameters, and out-parameters. Although a procedure can have any number of parameters,
subsequent declarations and uses of procedures will representatively show three parameters, one
of each kind: <span data-line="418"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x: X, <span style="color:blue">inout</span> y: Y, <span style="color:blue">out</span> z: Z</code><span data-line="418"></span>.
</p>
<p class="p indent" data-line="420"><span data-line="420"></span>The specification consists of any number of preconditions and any number of postconditions, each
of which indicates either an expression or an assertion. Postconditions are allowed to refer to
the initial value of an in/out-parameter <span data-line="422"></span><code class="code code1 language-b3 lang-b3 b3 colorized">y</code><span data-line="422"></span> by the expression <span data-line="422"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">old</span>(y)</code><span data-line="422"></span>. For the purpose of
substitution in expressions, <span data-line="423"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">old</span>(y)</code><span data-line="423"></span> is treated as a variable; that is, we allow <span data-line="423"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">old</span>(y)</code><span data-line="423"></span> to
be used as a left-hand side in the incarnation map <span data-line="424"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&sigma;</span></code><span data-line="424"></span>.
</p>
<p class="p indent" data-line="426"><span data-line="426"></span>The processing of a procedure consists of three tasks. The first task <span data-line="426"></span><em class="em-low1">vets</em><span data-line="426"></span> the precondition,
the second task vets the postcondition, and the third task <span data-line="427"></span><em class="em-low1">enforces</em><span data-line="427"></span> that the body, if any, establishes
the postcondition.
The first of these tasks precedes the other two, but the second and third tasks do not depend on each other.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="431" data-line-first="432" style="display:block"><code data-line="432">TopLevelProcess<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span style="color:blue">procedure</span> M(x: X, <span style="color:blue">inout</span> y: Y, <span style="color:blue">out</span> z: Z) PreSpecs PostSpecs Body, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  let <span class="code-escaped">&sigma;</span> be [x := x, y := y]
  let y&#39; be <span class="code-escaped">&sigma;</span>.new(y)
  let z&#39; be <span class="code-escaped">&sigma;</span>.new(z)
  let <span class="code-escaped">&sigma;</span>&#39; be [x := x, <span style="color:blue">old</span>(y) := y, y := y&#39;, z := z&#39;]
  <span style="color:blue">if</span> there is a Body
    let Body&#39; be <span style="color:blue">assume</span> <span style="color:blue">old</span>(y) = y <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> Body
    VetPre<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> PreSpecs, PostSpecs, Body&#39;, <span class="code-escaped">&sigma;</span>, <span class="code-escaped">&sigma;</span>&#39;, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  <span style="color:blue">else</span>
    VetPre<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> PreSpecs, PostSpecs, <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.4922em;width:0.5307em" viewBox='34.67 57.347 5.054 4.688'><desc>$\varepsilon$</desc><g id='math-f8b1c5'><use x='34.869' y='61.836' xlink:href='#g3-34'/></g></svg></span>, <span class="code-escaped">&sigma;</span>, <span class="code-escaped">&sigma;</span>&#39;, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span></code></pre>
<p class="p noindent para-continued" data-line="444"><span data-line="444"></span><code class="code code1 language-b3 lang-b3 b3 colorized">VetPre</code><span data-line="444"></span> vets the precondition and then continues into <span data-line="444"></span><code class="code code1 language-b3 lang-b3 b3 colorized">VetPost</code><span data-line="444"></span> and
<span data-line="445"></span><code class="code code1 language-b3 lang-b3 b3 colorized">EnforcePost</code><span data-line="445"></span>.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="447" data-line-first="448" style="display:block"><code data-line="448">VetPre<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span style="color:purple">requires</span> e <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> PreSpecs, PostSpecs, Body, <span class="code-escaped">&sigma;</span>, <span class="code-escaped">&sigma;</span>&#39;, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  let e&#39; be <span class="code-escaped">&sigma;</span>[e]
  VetPre<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> PreSpecs, PostSpecs, Body, <span class="code-escaped">&sigma;</span>, <span class="code-escaped">&sigma;</span>&#39;, <span class="code-escaped">&Omega;</span>.extend(e&#39;) <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>

VetPre<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span style="color:purple">requires</span> A <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> PreSpecs, PostSpecs, Body, <span class="code-escaped">&sigma;</span>, <span class="code-escaped">&sigma;</span>&#39;, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> A, <span class="code-escaped">&sigma;</span>, <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.4922em;width:0.5307em" viewBox='34.67 57.347 5.054 4.688'><desc>$\varepsilon$</desc><g id='math-f8b1c5'><use x='34.869' y='61.836' xlink:href='#g3-34'/></g></svg></span>, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  let L be Learn<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> A, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  VetPre<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> PreSpecs, PostSpecs, Body, <span class="code-escaped">&sigma;</span>, <span class="code-escaped">&sigma;</span>&#39;, <span class="code-escaped">&Omega;</span>.extend(L) <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>

VetPre<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.4922em;width:0.5307em" viewBox='34.67 57.347 5.054 4.688'><desc>$\varepsilon$</desc><g id='math-f8b1c5'><use x='34.869' y='61.836' xlink:href='#g3-34'/></g></svg></span>, PostSpecs, Body, <span class="code-escaped">&sigma;</span>, <span class="code-escaped">&sigma;</span>&#39;, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  VetPost<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> PostSpecs, <span class="code-escaped">&sigma;</span>&#39;, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  EnforcePost<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> PostSpecs, Body, <span class="code-escaped">&sigma;</span>&#39;, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span></code></pre>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="462" data-line-first="463" style="display:block"><code data-line="463">VetPost<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span style="color:purple">ensures</span> e <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> PostSpecs, <span class="code-escaped">&sigma;</span>, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  let e&#39; be <span class="code-escaped">&sigma;</span>[e]
  VetPost<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> PostSpecs, <span class="code-escaped">&sigma;</span>, <span class="code-escaped">&Omega;</span>.extend(e&#39;) <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>

VetPost<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span style="color:purple">ensures</span> A <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> PostSpecs, <span class="code-escaped">&sigma;</span>, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> A, <span class="code-escaped">&sigma;</span>, <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.4922em;width:0.5307em" viewBox='34.67 57.347 5.054 4.688'><desc>$\varepsilon$</desc><g id='math-f8b1c5'><use x='34.869' y='61.836' xlink:href='#g3-34'/></g></svg></span>, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  let L be Learn<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> A, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  VetPost<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> PostSpecs, <span class="code-escaped">&sigma;</span>, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>

VetPost<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.4922em;width:0.5307em" viewBox='34.67 57.347 5.054 4.688'><desc>$\varepsilon$</desc><g id='math-f8b1c5'><use x='34.869' y='61.836' xlink:href='#g3-34'/></g></svg></span>, <span class="code-escaped">&sigma;</span>, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =</code></pre>
<p class="p noindent para-continued" data-line="475"><span data-line="475"></span>To enforce that the body establishes the postconditions, and also to enforce that a caller
establishes the precondition (see section<span data-line="476"></span>&nbsp;<a href="#sec-calls" title="6.&#8194;Calls" class="localref" style="target-element:h1"><span class="heading-label">6</span></a><span data-line="476"></span> on calls), we define two
operations on specifications, <span data-line="477"></span><code class="code code1 language-b3 lang-b3 b3 colorized">ConvertToLearn</code><span data-line="477"></span> and <span data-line="477"></span><code class="code code1 language-b3 lang-b3 b3 colorized">ConvertToCheck</code><span data-line="477"></span>.  These learn from the
assertions and either just learn or both check and learn the conditions. The operations process
<span data-line="479"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:purple">requires</span></code><span data-line="479"></span> and <span data-line="479"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:purple">ensures</span></code><span data-line="479"></span> (and in section<span data-line="479"></span>&nbsp;<a href="#sec-loops" title="10.&#8194;Loops" class="localref" style="target-element:h1"><span class="heading-label">10</span></a><span data-line="479"></span> also <span data-line="479"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:purple">invariant</span></code><span data-line="479"></span> for loops) in the same
way; the following definitions use the ficticious keyword <span data-line="480"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:purple">reqensinv</span></code><span data-line="480"></span> to stand for any of
<span data-line="481"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:purple">requires</span></code><span data-line="481"></span>, <span data-line="481"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:purple">ensures</span></code><span data-line="481"></span>, or <span data-line="481"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:purple">invariant</span></code><span data-line="481"></span>.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="483" data-line-first="484" style="display:block"><code data-line="484">ConvertToLearn<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span style="color:purple">reqensinv</span> e <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> Specs <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  let Sp be ConvertToLearn<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> Specs <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  <span style="color:blue">assume</span> e <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> Sp

ConvertToLearn<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span style="color:purple">reqensinv</span> A <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> Specs <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  let L be Learn<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> A <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  let Sp be ConvertToLearn<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> Specs <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  <span style="color:blue">assume</span> L <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> Sp

ConvertToLearn<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.4922em;width:0.5307em" viewBox='34.67 57.347 5.054 4.688'><desc>$\varepsilon$</desc><g id='math-f8b1c5'><use x='34.869' y='61.836' xlink:href='#g3-34'/></g></svg></span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.4922em;width:0.5307em" viewBox='34.67 57.347 5.054 4.688'><desc>$\varepsilon$</desc><g id='math-f8b1c5'><use x='34.869' y='61.836' xlink:href='#g3-34'/></g></svg></span></code></pre>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="497" data-line-first="498" style="display:block"><code data-line="498">ConvertToCheck<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span style="color:purple">reqensinv</span> e <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> Specs <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  let Sp be ConvertToCheck<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> Specs <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  <span style="color:blue">check</span> e <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> Sp

ConvertToCheck<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span style="color:purple">reqensinv</span> A <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> Specs <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  let L be Learn<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> A <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  let Sp be ConvertToCheck<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> Specs <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  <span style="color:blue">assume</span> L <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> Sp

ConvertToCheck<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.4922em;width:0.5307em" viewBox='34.67 57.347 5.054 4.688'><desc>$\varepsilon$</desc><g id='math-f8b1c5'><use x='34.869' y='61.836' xlink:href='#g3-34'/></g></svg></span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.4922em;width:0.5307em" viewBox='34.67 57.347 5.054 4.688'><desc>$\varepsilon$</desc><g id='math-f8b1c5'><use x='34.869' y='61.836' xlink:href='#g3-34'/></g></svg></span></code></pre>
<p class="p noindent para-continued" data-line="511"><span data-line="511"></span>Now, we define the third task of processing procedure declarations. It <span data-line="511"></span><em class="em-low1">uses</em><span data-line="511"></span> the procedure<span data-line="511"></span>&#39;<span data-line="511"></span>s precondition,
as provided in the <span data-line="512"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&Omega;</span></code><span data-line="512"></span> parameter to <span data-line="512"></span><code class="code code1 language-b3 lang-b3 b3 colorized">EnforcePost</code><span data-line="512"></span>, and it enforces the postcondition after processing
the body.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="515" data-line-first="516" style="display:block"><code data-line="516">EnforcePost<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> PostSpecs, Body, <span class="code-escaped">&sigma;</span>, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  let Ens be ConvertToCheck<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> PostSpecs <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  let B be [<span style="color:blue">return</span> := (domain of <span class="code-escaped">&sigma;</span>, Ens)]
  Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> Body <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> <span style="color:blue">return</span>, <span class="code-escaped">&sigma;</span>, B, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span></code></pre><h3 id="sec-proc-example" class="h2" data-line="522" data-heading-depth="2" style="display:block"><span data-line="522"></span><span class="heading-before"><span class="heading-label">5.0</span>.&#8194;</span><span data-line="522"></span>Example</h3>
<p class="p noindent" data-line="524"><span data-line="524"></span>Consider the following procedure declaration:
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="526" data-line-first="527" style="display:block"><code data-line="527"><span style="color:blue">procedure</span> M(x: <span style="color:teal">int</span>, <span style="color:blue">inout</span> y: <span style="color:teal">int</span>)
  <span style="color:purple">requires</span> { <span style="color:blue">check</span> FPre(x, y) <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> <span style="color:blue">assume</span> FCanCall(x, y) }
  <span style="color:purple">requires</span> F(x, y) &lt; <span class="constant" style="color:purple">10</span>
  <span style="color:purple">ensures</span> { <span style="color:blue">check</span> GPre(x, y) <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> <span style="color:blue">assume</span> GCanCall(x, y) }
  <span style="color:purple">ensures</span> <span style="color:blue">old</span>(y) &lt;= G(x, y)</code></pre>
<p class="p noindent para-continued" data-line="534"><span data-line="534"></span>Vetting this procedure declaration from a solver state <span data-line="534"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&Omega;</span></code><span data-line="534"></span> involves the following checks:
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="536" data-line-first="537" style="display:block"><code data-line="537"><span style="color:darkgreen">// vet precondition</span>
<span class="code-escaped">&Omega;</span>.prove(FPre(x, y))
<span class="code-escaped">&Omega;</span>&#39; := <span class="code-escaped">&Omega;</span>.extend(FCanCall(x, y))
<span class="code-escaped">&Omega;</span><span class="code-escaped">"</span> := <span class="code-escaped">&Omega;</span>&#39;.extend(F(x, y) &lt; <span class="constant" style="color:purple">10</span>)
<span style="color:darkgreen">// vet postcondition</span>
<span class="code-escaped">&Omega;</span><span class="code-escaped">"</span>.prove(GPre(x, y%<span class="constant" style="color:purple">0</span>))
<span class="code-escaped">&Omega;</span><span class="code-escaped"><sup>3</sup></span> := <span class="code-escaped">&Omega;</span><span class="code-escaped">"</span>.extend(GCanCall(x, y%<span class="constant" style="color:purple">0</span>))
<span class="code-escaped">&Omega;</span><span class="code-escaped"><sup>4</sup></span> := <span class="code-escaped">&Omega;</span><span class="code-escaped"><sup>3</sup></span>.extend(y &lt; G(x, y%<span class="constant" style="color:purple">0</span>))</code></pre>
<p class="p noindent para-continued" data-line="547"><span data-line="547"></span>Note that vetting learns from, but does not check, the expression forms of the pre- and postconditions.
</p>
<p class="p indent" data-line="549"><span data-line="549"></span>If the procedure has a body <span data-line="549"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Body</code><span data-line="549"></span>, then it will be processed by
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="551" data-line-first="552" style="display:block"><code data-line="552">Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> Body <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> <span style="color:blue">return</span>, ..., ..., <span class="code-escaped">&Omega;</span><span class="code-escaped">"</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span></code></pre>
<p class="p noindent para-continued" data-line="555"><span data-line="555"></span>When this processing reaches the <span data-line="555"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">return</span></code><span data-line="555"></span> label, say in a solver state <span data-line="555"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&Omega;</span><span class="code-escaped"><sup>5</sup></span></code><span data-line="555"></span> and with
the incarnation <span data-line="556"></span><code class="code code1 language-b3 lang-b3 b3 colorized">y%<span class="constant" style="color:purple">8</span></code><span data-line="556"></span> for <span data-line="556"></span><code class="code code1 language-b3 lang-b3 b3 colorized">y</code><span data-line="556"></span>, then processing will enforce the postcondition by
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="558" data-line-first="559" style="display:block"><code data-line="559"><span class="code-escaped">&Omega;</span><span class="code-escaped"><sup>6</sup></span> := <span class="code-escaped">&Omega;</span><span class="code-escaped"><sup>5</sup></span>.extend(GCanCall(x, y%<span class="constant" style="color:purple">8</span>))
<span class="code-escaped">&Omega;</span><span class="code-escaped"><sup>6</sup></span>.prove(y &lt;= G(x, y%<span class="constant" style="color:purple">8</span>))</code></pre>
<p class="p noindent para-continued" data-line="563"><span data-line="563"></span>Note that enforcement does not make use of the <span data-line="563"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">check</span></code><span data-line="563"></span> assertions in the procedure<span data-line="563"></span>&#39;<span data-line="563"></span>s pre- and postcondition.
</p><h2 id="sec-calls" class="h1" data-line="565" data-heading-depth="1" style="display:block"><span data-line="565"></span><span class="heading-before"><span class="heading-label">6</span>.&#8194;</span><span data-line="565"></span>Calls</h2>
<p class="p noindent" data-line="567"><span data-line="567"></span>A procedure can be called as a statement. This <span data-line="567"></span><em class="em-low1">enforces</em><span data-line="567"></span> that the caller has established the precondition
and in return lets the caller <span data-line="568"></span><em class="em-low1">use</em><span data-line="568"></span> the procedure<span data-line="568"></span>&#39;<span data-line="568"></span>s postcondition.
In a call, the in/out- and out-arguments must be distinct variables.
(Following the good idea in C<span data-line="570"></span>#<span data-line="570"></span>) the arguments are syntactically tagged with the same labels as the formal
parameters.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="573" data-line-first="574" style="display:block"><code data-line="574">Call ::=
  | <span style="color:blue">call</span> M <span style="color:maroon">&quot;</span><span style="color:maroon">(</span><span style="color:maroon">&quot;</span> Argument<span class="code-escaped"><sup>*,</sup></span> <span style="color:maroon">&quot;</span><span style="color:maroon">)</span><span style="color:maroon">&quot;</span>

Argument ::=
  | Expr
  | ( <span style="color:blue">inout</span> | <span style="color:blue">out</span> ) x</code></pre>
<p class="p noindent para-continued" data-line="582"><span data-line="582"></span>It would be possible to define a call as an elaboration of the body of the called procedure (provided the
procedure has a body). However, here, we just define the processing of a call in terms of the procedure<span data-line="583"></span>&#39;<span data-line="583"></span>s
specification.
</p>
<p class="p indent" data-line="586"><span data-line="586"></span>Suppose <span data-line="586"></span><code class="code code1 language-b3 lang-b3 b3 colorized">M</code><span data-line="586"></span> is a procedure
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="588" data-line-first="589" style="display:block"><code data-line="589"><span style="color:blue">procedure</span> M(x: X, <span style="color:blue">inout</span> y: Y, <span style="color:blue">out</span> z: Z) PreSpecs PostSpecs</code></pre>
<p class="p noindent para-continued" data-line="592"><span data-line="592"></span>Then,
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="594" data-line-first="595" style="display:block"><code data-line="595">Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span style="color:blue">call</span> M(e, <span style="color:blue">inout</span> b, <span style="color:blue">out</span> c) <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> Cc, <span class="code-escaped">&sigma;</span>, B, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  let e&#39; be <span class="code-escaped">&sigma;</span>[e]
  let x&#39; be <span class="code-escaped">&sigma;</span>.new(x%in)
  let b&#39; be <span class="code-escaped">&sigma;</span>[b]
  let b<span class="code-escaped">"</span> be <span class="code-escaped">&sigma;</span>.new(b&#39;)
  let c&#39; be <span class="code-escaped">&sigma;</span>.new(c)
  let <span class="code-escaped">&sigma;</span>&#39; be [x := x&#39;, y := b&#39;]
  let Pre be ConvertToCheck<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> PreSpecs <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  let <span class="code-escaped">&Omega;</span>&#39; be <span class="code-escaped">&Omega;</span>.extend(x&#39; = e&#39;)
  Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> Pre, <span class="code-escaped">&sigma;</span>&#39;, B, <span class="code-escaped">&Omega;</span>&#39; <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  let <span class="code-escaped">&sigma;</span><span class="code-escaped">"</span> be <span class="code-escaped">&sigma;</span>[x := x&#39;, <span style="color:blue">old</span>(y) := b&#39;, y := b<span class="code-escaped">"</span>, z := c&#39;]
  let Post be ConvertToLearn<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> PostSpecs <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> Post <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> Cc, <span class="code-escaped">&sigma;</span><span class="code-escaped">"</span>, B, <span class="code-escaped">&Omega;</span>&#39; <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span></code></pre>
<p class="p noindent para-continued" data-line="610"><span data-line="610"></span>Note that the semantics of the <span data-line="610"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">call</span></code><span data-line="610"></span> statement does not retain any part of the precondition in
the continuation of the call. In other words, the <span data-line="611"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">call</span></code><span data-line="611"></span> <span data-line="611"></span>&#8220;checks and forgets&#8221;<span data-line="611"></span> the precondition.
</p><h3 id="sec-example" class="h2" data-line="613" data-heading-depth="2" style="display:block"><span data-line="613"></span><span class="heading-before"><span class="heading-label">6.0</span>.&#8194;</span><span data-line="613"></span>Example</h3>
<p class="p noindent" data-line="615"><span data-line="615"></span>Continuing the example from section<span data-line="615"></span>&nbsp;<a href="#sec-proc-example" title="5.0.&#8194;Example" class="localref" style="target-element:h2"><span class="heading-label">5.0</span></a><span data-line="615"></span>, consider a call
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="617" data-line-first="618" style="display:block"><code data-line="618"><span style="color:blue">call</span> M(a, <span style="color:blue">inout</span> b)</code></pre>
<p class="p noindent para-continued" data-line="621"><span data-line="621"></span>From a solver state <span data-line="621"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&Omega;</span></code><span data-line="621"></span> and with incarnations <span data-line="621"></span><code class="code code1 language-b3 lang-b3 b3 colorized">a%<span class="constant" style="color:purple">3</span></code><span data-line="621"></span> and <span data-line="621"></span><code class="code code1 language-b3 lang-b3 b3 colorized">b%<span class="constant" style="color:purple">5</span></code><span data-line="621"></span> for <span data-line="621"></span><code class="code code1 language-b3 lang-b3 b3 colorized">a</code><span data-line="621"></span> and <span data-line="621"></span><code class="code code1 language-b3 lang-b3 b3 colorized">b</code><span data-line="621"></span>, the call is processed as follows:
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="623" data-line-first="624" style="display:block"><code data-line="624"><span class="code-escaped">&Omega;</span>&#39; := <span class="code-escaped">&Omega;</span>.extend(x%in = a%<span class="constant" style="color:purple">3</span>)
<span class="code-escaped">&Omega;</span><span class="code-escaped">"</span> := <span class="code-escaped">&Omega;</span>&#39;.extend(FCanCall(x%in, b%<span class="constant" style="color:purple">5</span>))
<span class="code-escaped">&Omega;</span><span class="code-escaped">"</span>.prove(F(x%in, b%<span class="constant" style="color:purple">5</span>) &lt; <span class="constant" style="color:purple">10</span>)
<span class="code-escaped">&Omega;</span><span class="code-escaped"><sup>3</sup></span> := <span class="code-escaped">&Omega;</span>&#39;.extend(GCanCall(x%in, b%<span class="constant" style="color:purple">6</span>))
<span class="code-escaped">&Omega;</span><span class="code-escaped"><sup>4</sup></span> := <span class="code-escaped">&Omega;</span><span class="code-escaped"><sup>3</sup></span>.extend(b%<span class="constant" style="color:purple">5</span> &lt;= G(x%in, b%<span class="constant" style="color:purple">6</span>))</code></pre><h2 id="sec-types" class="h1" data-line="631" data-heading-depth="1" style="display:block"><span data-line="631"></span><span class="heading-before"><span class="heading-label">7</span>.&#8194;</span><span data-line="631"></span>Types</h2>
<p class="p noindent" data-line="633"><span data-line="633"></span>B3 features the some built-in primitive types as well as user-defined types.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="635" data-line-first="636" style="display:block"><code data-line="636">Type ::=
  | <span style="color:teal">bool</span>
  | <span style="color:teal">int</span>
  | <span style="color:teal">real</span>
  | <span style="color:teal">bv0</span> | <span style="color:teal">bv1</span> | <span style="color:teal">bv2</span> | ...
  | T</code></pre>
<p class="p noindent para-continued" data-line="644"><span data-line="644"></span>There<span data-line="644"></span>&#39;<span data-line="644"></span>s not much to say about type declarations. Simply, they introduce names of uninterpreted, user-defined types.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="646" data-line-first="647" style="display:block"><code data-line="647">TopLevelDeclaration ::=
  | ...
  | <span style="color:blue">type</span> T</code></pre>
<p class="p noindent para-continued" data-line="652"><span data-line="652"></span>There<span data-line="652"></span>&#39;<span data-line="652"></span>s nothing to process about a type.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="654" data-line-first="655" style="display:block"><code data-line="655">TopLevelProcess<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span style="color:blue">type</span> T <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =</code></pre>
<p class="p noindent para-continued" data-line="658"><span data-line="658"></span>For variations of type declarations, see section<span data-line="658"></span>&nbsp;<a href="#sec-type-variations" title="18.&#8194;Variations on types" class="localref" style="target-element:h1"><span class="heading-label">18</span></a><span data-line="658"></span>.
</p>
<p class="p indent" data-line="660"><span data-line="660"></span>(TODO: Consider adding record types and/or collections of variables as a type.)
</p><h2 id="sec-axioms" class="h1" data-line="662" data-heading-depth="1" style="display:block"><span data-line="662"></span><span class="heading-before"><span class="heading-label">8</span>.&#8194;</span><span data-line="662"></span>Axioms</h2>
<p class="p noindent" data-line="664"><span data-line="664"></span>An <span data-line="664"></span><em class="em-low1">axiom</em><span data-line="664"></span> declares a top-level assumption. It can be used to (fully or partially) describe properties
of functions or relations between functions.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="667" data-line-first="668" style="display:block"><code data-line="668">TopLevelDeclaration ::=
  | ...
  | <span style="color:blue">axiom</span> Explains<span class="code-escaped"><sup>*</sup></span> Expr</code></pre>
<p class="p noindent para-continued" data-line="673"><span data-line="673"></span>The <span data-line="673"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Explains</code><span data-line="673"></span> clauses are explained in section<span data-line="673"></span>&nbsp;<a href="#sec-dependencies" title="12.&#8194;Dependency management" class="localref" style="target-element:h1"><span class="heading-label">12</span></a><span data-line="673"></span> on dependency management.
</p>
<p class="p indent" data-line="675"><span data-line="675"></span>There<span data-line="675"></span>&#39;<span data-line="675"></span>s nothing to process about an axiom.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="677" data-line-first="678" style="display:block"><code data-line="678">TopLevelProcess<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span style="color:blue">axiom</span> e <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =</code></pre><h2 id="sec-functions" class="h1" data-line="681" data-heading-depth="1" style="display:block"><span data-line="681"></span><span class="heading-before"><span class="heading-label">9</span>.&#8194;</span><span data-line="681"></span>Functions</h2>
<p class="p noindent" data-line="683"><span data-line="683"></span>A <span data-line="683"></span><em class="em-low1">function</em><span data-line="683"></span> is a name, a signature, and an optional definition.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="685" data-line-first="686" style="display:block"><code data-line="686">TopLevelDeclaration ::=
  | ...
  | <span style="color:blue">function</span> F <span style="color:maroon">&quot;</span><span style="color:maroon">(</span><span style="color:maroon">&quot;</span> FParam<span class="code-escaped"><sup>*,</sup></span> <span style="color:maroon">&quot;</span><span style="color:maroon">)</span><span style="color:maroon">&quot;</span> <span style="color:maroon">&quot;</span><span style="color:maroon">:</span><span style="color:maroon">&quot;</span> TypeOrPartition [ FDefinition ]
FParam ::=
  | FParamModifier<span class="code-escaped"><sup>*</sup></span> x: Type
FDefinition ::=
  | [ ForallHeader ] Trigger<span class="code-escaped"><sup>*</sup></span> FPre<span class="code-escaped"><sup>*</sup></span> <span style="color:maroon">&quot;</span><span style="color:maroon">{</span><span style="color:maroon">&quot;</span> Expr <span style="color:maroon">&quot;</span><span style="color:maroon">}</span><span style="color:maroon">&quot;</span>
ForallHeader ::=
  | <span style="color:blue">forall</span> x: Type
FPre ::=
  | <span style="color:purple">requires</span> Expr</code></pre>
<p class="p noindent para-continued" data-line="699"><span data-line="699"></span>In its simplest form, a function declaration just introduces an uninterpreted function symbol; for example:
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="701" data-line-first="702" style="display:block"><code data-line="702"><span style="color:blue">function</span> Fib(x: <span style="color:teal">int</span>): <span style="color:teal">int</span></code></pre>
<p class="p noindent para-continued" data-line="705"><span data-line="705"></span>Functions live in a different name space from variables.
</p>
<p class="p indent" data-line="707"><span data-line="707"></span>For details of partitions, see sections<span data-line="707"></span>&nbsp;<a href="#sec-partition" title="18.1.&#8194;Partitions" class="localref" style="target-element:h2"><span class="heading-label">18.1</span></a><span data-line="707"></span> and<span data-line="707"></span>&nbsp;<a href="#sec-function-with-partition" title="19.1.&#8194;Using partition as function result" class="localref" style="target-element:h2"><span class="heading-label">19.1</span></a><span data-line="707"></span>; for
now, it suffices to think of <span data-line="708"></span><code class="code code1 language-b3 lang-b3 b3 colorized">TypeOrPartition</code><span data-line="708"></span> as just <span data-line="708"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Type</code><span data-line="708"></span>.  The <span data-line="708"></span><code class="code code1 language-b3 lang-b3 b3 colorized">FParamModifier</code><span data-line="708"></span> production
is defined in section<span data-line="709"></span>&nbsp;<a href="#sec-injective" title="19.0.&#8194;Injective parameters" class="localref" style="target-element:h2"><span class="heading-label">19.0</span></a><span data-line="709"></span> and the <span data-line="709"></span><code class="code code1 language-b3 lang-b3 b3 colorized">ForallHeader</code><span data-line="709"></span> production is explained in section
<span data-line="710"></span><a href="#sec-function-forall" title="19.2.&#8194;Additional bound variables for function definitions" class="localref" style="target-element:h2"><span class="heading-label">19.2</span></a><span data-line="710"></span>.
</p><h3 id="sec-function-definition" class="h2" data-line="712" data-heading-depth="2" style="display:block"><span data-line="712"></span><span class="heading-before"><span class="heading-label">9.0</span>.&#8194;</span><span data-line="712"></span>Function definition</h3>
<p class="p noindent" data-line="714"><span data-line="714"></span>The value of a function can be defined using an axiom. It can also be defined as part of the function
declaration. There are two advantages of giving the definition as part of the function declaration.
One advantage is convenience, since it eliminates the need for writing a universally quantified axiom.
The other advantage is that, for a function that returns a boolean (aka, a <span data-line="717"></span><em class="em-low1">predicate</em><span data-line="717"></span>), B3 can trace
into the body to give more detailed error information (see section<span data-line="718"></span>&nbsp;<a href="#sec-markers" title="11.&#8194;Error information" class="localref" style="target-element:h1"><span class="heading-label">11</span></a><span data-line="718"></span> on markers).
</p>
<p class="p indent" data-line="720"><span data-line="720"></span>Here is an example of a simple function declaration:
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="722" data-line-first="723" style="display:block"><code data-line="723"><span style="color:blue">function</span> Triple(x: <span style="color:teal">int</span>): <span style="color:teal">int</span>
{
  <span class="constant" style="color:purple">3</span> * x
}</code></pre>
<p class="p noindent para-continued" data-line="729"><span data-line="729"></span>The definition of this function effectively turns into the following axiom:
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="731" data-line-first="732" style="display:block"><code data-line="732"><span style="color:blue">axiom</span> <span style="color:blue">forall</span> x: <span style="color:teal">int</span> :: Triple(x) = <span class="constant" style="color:purple">3</span> * x</code></pre>
<p class="p noindent para-continued" data-line="735"><span data-line="735"></span>It frequently occurs that a function is <span data-line="735"></span><em class="em-low1">underspecified</em><span data-line="735"></span>, that is, that it is defined only on certain parameters.
This can be incorporated into the axiom by using <span data-line="736"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:purple">requires</span></code><span data-line="736"></span> clauses. For example, to give a definition
of <span data-line="737"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Triple</code><span data-line="737"></span> only for non-negative integers, one can write
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="739" data-line-first="740" style="display:block"><code data-line="740"><span style="color:blue">function</span> Triple(x: <span style="color:teal">int</span>): <span style="color:teal">int</span>
  <span style="color:purple">requires</span> <span class="constant" style="color:purple">0</span> &lt;= x
{
  <span class="constant" style="color:purple">3</span> * x
}</code></pre>
<p class="p noindent para-continued" data-line="747"><span data-line="747"></span>which in effect gives the following axiom:
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="749" data-line-first="750" style="display:block"><code data-line="750"><span style="color:blue">axiom</span> <span style="color:blue">forall</span> x: <span style="color:teal">int</span> :: <span class="constant" style="color:purple">0</span> &lt;= x ==&gt; Triple(x) = <span class="constant" style="color:purple">3</span> * x</code></pre>
<p class="p noindent para-continued" data-line="753"><span data-line="753"></span>(TODO: The use of the <span data-line="753"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:purple">requires</span></code><span data-line="753"></span> keyword here is a bad idea, since <span data-line="753"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:purple">requires</span></code><span data-line="753"></span> suggests enforcing the condition
at call sites, which is not the intention. That is, a function in B3 total but possibly underspecified. The keyword
should be replaced by something that suggests underspecification.)
</p><h2 id="sec-loops" class="h1" data-line="757" data-heading-depth="1" style="display:block"><span data-line="757"></span><span class="heading-before"><span class="heading-label">10</span>.&#8194;</span><span data-line="757"></span>Loops</h2>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="759" data-line-first="760" style="display:block"><code data-line="760">Loop ::=
  | <span style="color:blue">loop</span> Invariant<span class="code-escaped"><sup>*</sup></span> Block
Invariant ::=
  | <span style="color:purple">invariant</span> Expr
  | <span style="color:purple">invariant</span> ABlock</code></pre>
<p class="p noindent para-continued" data-line="767"><span data-line="767"></span>A loop is used to denote a possibly infinite repetition of a block statement. <span data-line="767"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">exit</span></code><span data-line="767"></span> and <span data-line="767"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">return</span></code><span data-line="767"></span> statements
can be used to end the repetition.
</p>
<p class="p indent" data-line="770"><span data-line="770"></span>It would be possible to define a loop as an elaboration of its body.  However, here, we just
define the processing of a loop in terms of the loop<span data-line="771"></span>&#39;<span data-line="771"></span>s specification, its <span data-line="771"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:purple">invariant</span></code><span data-line="771"></span> clauses.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="773" data-line-first="774" style="display:block"><code data-line="774">Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span style="color:blue">loop</span> Invs S <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> Cc, <span class="code-escaped">&sigma;</span>, B, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  let CheckInv be ConvertToCheck<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> Invs <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  let LearnInv be ConvertToLearn<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> Invs <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> CheckInv, <span class="code-escaped">&sigma;</span>, B, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  let x be the assignment targets (see <span class="code-escaped">section&nbsp;<a href="#sec-assignment-targets" title="10.0.&#8194;Assignment targets" class="localref" style="target-element:h2"><span class="heading-label">10.0</span></a></span> below) of the <span class="code-escaped">loop</span> body
  let x&#39; be <span class="code-escaped">&sigma;</span>.new(x)
  let <span class="code-escaped">&sigma;</span>&#39; be <span class="code-escaped">&sigma;</span>[x := x&#39;]
  VetInv<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> Invs, <span class="code-escaped">&sigma;</span>&#39;, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> LearnInv <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> S <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> CheckInv, <span class="code-escaped">&sigma;</span>&#39;, B, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span></code></pre>
<p class="p noindent para-continued" data-line="785"><span data-line="785"></span>where the vetting of the invariant is defined by
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="787" data-line-first="788" style="display:block"><code data-line="788">VetInv<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.4922em;width:0.5307em" viewBox='34.67 57.347 5.054 4.688'><desc>$\varepsilon$</desc><g id='math-f8b1c5'><use x='34.869' y='61.836' xlink:href='#g3-34'/></g></svg></span>, <span class="code-escaped">&sigma;</span>&#39;, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =

VetInv<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span style="color:purple">invariant</span> e <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> Ii, <span class="code-escaped">&sigma;</span>&#39;, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  let e&#39; be <span class="code-escaped">&sigma;</span>&#39;[e]
  VetInv<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> Ii, <span class="code-escaped">&sigma;</span>&#39;, <span class="code-escaped">&Omega;</span>.extend(e&#39;) <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>

VetInv<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span style="color:purple">invariant</span> A <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> Ii, <span class="code-escaped">&sigma;</span>&#39;, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> A, <span class="code-escaped">&sigma;</span>&#39;, <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.4922em;width:0.5307em" viewBox='34.67 57.347 5.054 4.688'><desc>$\varepsilon$</desc><g id='math-f8b1c5'><use x='34.869' y='61.836' xlink:href='#g3-34'/></g></svg></span>, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  let L be Learn<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> A, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  VetInv<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> Ii, <span class="code-escaped">&sigma;</span>&#39;, <span class="code-escaped">&Omega;</span>.extend(L) <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span></code></pre><h3 id="sec-assignment-targets" class="h2" data-line="800" data-heading-depth="2" style="display:block"><span data-line="800"></span><span class="heading-before"><span class="heading-label">10.0</span>.&#8194;</span><span data-line="800"></span>Assignment targets</h3>
<p class="p noindent" data-line="802"><span data-line="802"></span>The <span data-line="802"></span><em class="em-low1">assignment targets</em><span data-line="802"></span> of a loop body is the set of variables that are assigned (either directly by
an assignment statement or as an in/out- or out-argument of a <span data-line="803"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">call</span></code><span data-line="803"></span> statement) on some control
path from the start of the loop body to the loop body<span data-line="804"></span>&#39;<span data-line="804"></span>s back-edge. For example, for the loop
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="806" data-line-first="807" style="display:block"><code data-line="807"><span class="code-escaped">&ell;</span>: <span style="color:blue">loop</span> {
  v := e0
  <span style="color:blue">if</span> A {
    <span style="color:blue">if</span> B {
      w := e1
      <span style="color:blue">exit</span> <span class="code-escaped">&ell;</span>
    } <span style="color:blue">else</span> {
      x := e2
      <span style="color:blue">exit</span> <span class="code-escaped">&ell;</span>&#39;
    }
  } <span style="color:blue">else</span> {
    <span style="color:blue">if</span> C {
      <span style="color:blue">call</span> M(e3, <span style="color:blue">inout</span> y)
    } <span style="color:blue">else</span> {
      z := e4
      <span style="color:blue">return</span>
    }
  }
}</code></pre>
<p class="p noindent para-continued" data-line="828"><span data-line="828"></span>the assignment targets are <span data-line="828"></span><code class="code code1 language-b3 lang-b3 b3 colorized">v</code><span data-line="828"></span> and <span data-line="828"></span><code class="code code1 language-b3 lang-b3 b3 colorized">y</code><span data-line="828"></span>, but not <span data-line="828"></span><code class="code code1 language-b3 lang-b3 b3 colorized">w</code><span data-line="828"></span>, <span data-line="828"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x</code><span data-line="828"></span>, or <span data-line="828"></span><code class="code code1 language-b3 lang-b3 b3 colorized">z</code><span data-line="828"></span>.
</p><h2 id="sec-markers" class="h1" data-line="830" data-heading-depth="1" style="display:block"><span data-line="830"></span><span class="heading-before"><span class="heading-label">11</span>.&#8194;</span><span data-line="830"></span>Error information</h2>
<p class="p noindent" data-line="832"><span data-line="832"></span>As presented so far, a call to <span data-line="832"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&Omega;</span>.prove(e)</code><span data-line="832"></span> attempts to prove <span data-line="832"></span><code class="code code1 language-b3 lang-b3 b3 colorized">e</code><span data-line="832"></span> in the solver state <span data-line="832"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&Omega;</span></code><span data-line="832"></span> and
reports an error if no such proof is found. Each <span data-line="833"></span><code class="code code1 language-b3 lang-b3 b3 colorized">prove</code><span data-line="833"></span> operation stems from a <span data-line="833"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">check</span></code><span data-line="833"></span> statement, so
an error reported by <span data-line="834"></span><code class="code code1 language-b3 lang-b3 b3 colorized">prove</code><span data-line="834"></span> includes information that identifies the failing <span data-line="834"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">check</span></code><span data-line="834"></span>. While <span data-line="834"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">check</span></code><span data-line="834"></span> statements
can be explicit in the program text, some <span data-line="835"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">check</span></code><span data-line="835"></span> statements are generated as part of <span data-line="835"></span><code class="code code1 language-b3 lang-b3 b3 colorized">ConvertToCheck</code><span data-line="835"></span>
operations. In case of the latter, the <span data-line="836"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:purple">requires</span></code><span data-line="836"></span>, <span data-line="836"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:purple">ensures</span></code><span data-line="836"></span>, or <span data-line="836"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:purple">invariant</span></code><span data-line="836"></span> clause that uses <span data-line="836"></span><code class="code code1 language-b3 lang-b3 b3 colorized">ConvertToCheck</code><span data-line="836"></span>
is included in the error report.
</p>
<p class="p indent" data-line="839"><span data-line="839"></span>Beyond identifying the (explicit or implicit) <span data-line="839"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">check</span></code><span data-line="839"></span> statement the proof of whose condition failed,
<span data-line="840"></span><code class="code code1 language-b3 lang-b3 b3 colorized">prove</code><span data-line="840"></span> does two more things to add more information to error reports.
</p><h3 id="sec-road-post-markers" class="h2" data-line="842" data-heading-depth="2" style="display:block"><span data-line="842"></span><span class="heading-before"><span class="heading-label">11.0</span>.&#8194;</span><span data-line="842"></span>Road post markers</h3>
<p class="p noindent" data-line="844"><span data-line="844"></span>One thing is to include <span data-line="844"></span><em class="em-low1">road post markers</em><span data-line="844"></span>. A road post marker is declared by the <span data-line="844"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">probe</span></code><span data-line="844"></span> statement:
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="846" data-line-first="847" style="display:block"><code data-line="847">Stmt ::=
  | ...
  | <span style="color:blue">probe</span> [ Expr ]</code></pre>
<p class="p noindent para-continued" data-line="852"><span data-line="852"></span>Such a <span data-line="852"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">probe</span></code><span data-line="852"></span> statement has no effect on the evaluation of the program. Instead, the expression is
recorded into the solver state as an <span data-line="853"></span><em class="em-low1">expression of interest</em><span data-line="853"></span>. In the event that an error is reported,
the solver evaluates all expressions of interest and reports their values paired with their respective
<span data-line="855"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">probe</span></code><span data-line="855"></span> statements.
</p>
<p class="p indent" data-line="857"><span data-line="857"></span>For example, consider the following program snippet, started in a state where the value of <span data-line="857"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x</code><span data-line="857"></span> is not known:
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="859" data-line-first="860" style="display:block"><code data-line="860"><span style="color:blue">if</span> x &lt; <span class="constant" style="color:purple">10</span> {
  <span style="color:blue">probe</span> x + x
  <span style="color:blue">check</span> x &lt; <span class="constant" style="color:purple">100</span>
}</code></pre>
<p class="p noindent para-continued" data-line="866"><span data-line="866"></span>This <span data-line="866"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">probe</span></code><span data-line="866"></span> has no effect on the output (which is that no error is reported). However, for
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="868" data-line-first="869" style="display:block"><code data-line="869"><span style="color:blue">if</span> x &lt; <span class="constant" style="color:purple">10</span> {
  <span style="color:blue">probe</span> x + x
  <span style="color:blue">check</span> <span class="constant" style="color:purple">100</span> &lt;= x
}</code></pre>
<p class="p noindent para-continued" data-line="875"><span data-line="875"></span>the error reported will include a value for the expression <span data-line="875"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x + x</code><span data-line="875"></span> (for example, <span data-line="875"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="constant" style="color:purple">14</span></code><span data-line="875"></span>).
</p>
<p class="p indent" data-line="877"><span data-line="877"></span>We introduce a new operation, <span data-line="877"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&Omega;</span>.record(e)</code><span data-line="877"></span>, which returns a solver state that additionally
keeps track of <span data-line="878"></span><code class="code code1 language-b3 lang-b3 b3 colorized">e</code><span data-line="878"></span> as an expression of interest.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="880" data-line-first="881" style="display:block"><code data-line="881">Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span style="color:blue">probe</span> e <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> Cc, <span class="code-escaped">&sigma;</span>, B, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  let e&#39; be <span class="code-escaped">&sigma;</span>[e]
  Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> Cc, <span class="code-escaped">&sigma;</span>, B, <span class="code-escaped">&Omega;</span>.record(e&#39;) <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span></code></pre>
<p class="p noindent para-continued" data-line="886"><span data-line="886"></span>One use of probes is to just record path information, as road post markers leading to the error.
This can be done with <span data-line="887"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">probe</span> <span style="color:blue">true</span></code><span data-line="887"></span> or <span data-line="887"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">probe</span> <span class="constant" style="color:purple">0</span></code><span data-line="887"></span>, where the value of the expression is not interesting
but the presence of information for the <span data-line="888"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">probe</span></code><span data-line="888"></span> in the error report says that the error reported
occurred on a control path that passed through the <span data-line="889"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">probe</span></code><span data-line="889"></span>. Rather than forcing the user to pick an
arbitrary expression, the language allows a <span data-line="890"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">probe</span></code><span data-line="890"></span> statement without an argument.
</p><h3 id="sec-labeled-expressions" class="h2" data-line="892" data-heading-depth="2" style="display:block"><span data-line="892"></span><span class="heading-before"><span class="heading-label">11.1</span>.&#8194;</span><span data-line="892"></span>Labeled expressions</h3>
<p class="p noindent" data-line="894"><span data-line="894"></span>In its error reports, the <span data-line="894"></span><code class="code code1 language-b3 lang-b3 b3 colorized">prove</code><span data-line="894"></span> operation also provides <span data-line="894"></span><em class="em-low1">auxiliary information</em><span data-line="894"></span> that comes from
labeled conjuncts and inlined predicates. To that avail, any expression can be labeled:
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="897" data-line-first="898" style="display:block"><code data-line="898">Expr ::=
  | ...
  | <span class="code-escaped">&ell;</span>: Expr</code></pre>
<p class="p noindent para-continued" data-line="903"><span data-line="903"></span>It is now time to describe the <span data-line="903"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&Omega;</span>.prove(e)</code><span data-line="903"></span> operation in more detail. Here is pseudo code,
where each <span data-line="904"></span><code class="code code1 language-b3 lang-b3 b3 colorized">yield</code><span data-line="904"></span> shows one of the return values. In the top-level <span data-line="904"></span><code class="code code1 language-b3 lang-b3 b3 colorized">prove</code><span data-line="904"></span> operation, the values
returned will be reported.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="907" data-line-first="908" style="display:block"><code data-line="908"><span style="color:blue">if</span> e can be proved in <span class="code-escaped">&Omega;</span> {
  yield Success
} <span style="color:blue">else</span> {
  let RoadPostMarkers be values for the expressions of interest in <span class="code-escaped">&Omega;</span>

  let e0,e1,... be the top-level conjuncts e0 <span class="code-escaped">&#8743;</span> e1 <span class="code-escaped">&#8743;</span> ... of e
  for each such conjunct e<span class="code-escaped"><em class="em-low1">i</em></span> {
    <span style="color:blue">if</span> e<span class="code-escaped"><em class="em-low1">i</em></span> is a labeled expression <span class="code-escaped">&ell;</span>: ee {
      for each (roadPosts, auxInfo) in <span class="code-escaped">&Omega;</span>.prove(ee) {
        yield (RoadPostMarkers, <span class="code-escaped">&ell;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> auxInfo)
      }
    }
  }

  <span style="color:blue">if</span> nothing is yielded above {
    <span style="color:blue">if</span> e <span class="code-escaped">is a call to a function</span> P(args) <span class="code-escaped">where</span> P has an FDefinition {
      let Pre be (the conjunction of expressions in) the FDefinition&#39;s <span style="color:purple">requires</span> clauses
      let Body be the body in the FDefinition
      let Pre&#39;,Body&#39; be Pre,Body <span class="code-escaped">in which the formal parameters are replaced by</span> args
      <span style="color:blue">if</span> <span class="code-escaped">&Omega;</span>.prove(Pre&#39;) returns Success {
        for each (roadPosts, auxInfo) in <span class="code-escaped">&Omega;</span>.prove(Body&#39;) {
          yield (RoadPostMarkers, <span style="color:maroon">&quot;</span><span style="color:maroon">P</span><span style="color:maroon">&quot;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> auxInfo)
        }
      }
    }
  }

  <span style="color:blue">if</span> nothing is yielded above {
    yield (RoadPostMarkers, <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.4922em;width:0.5307em" viewBox='34.67 57.347 5.054 4.688'><desc>$\varepsilon$</desc><g id='math-f8b1c5'><use x='34.869' y='61.836' xlink:href='#g3-34'/></g></svg></span>)
  }
}</code></pre>
<p class="p noindent para-continued" data-line="941"><span data-line="941"></span>(TODO: The above does not nothing for <span data-line="941"></span>&#8220;opening&#8221;<span data-line="941"></span> a quantifier.)
</p><h2 id="sec-dependencies" class="h1" data-line="943" data-heading-depth="1" style="display:block"><span data-line="943"></span><span class="heading-before"><span class="heading-label">12</span>.&#8194;</span><span data-line="943"></span>Dependency management</h2>
<p class="p noindent" data-line="945"><span data-line="945"></span>It is important to know which function definitions and axioms get included in a verification
condition.  There are two reasons for this.  One reason is that more antecedents makes a
verification condition logically weaker, that is, easier to discharge.  In an extreme case,
contradictory axioms (like the blatant <span data-line="948"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">axiom</span> <span style="color:blue">false</span></code><span data-line="948"></span>) make everything logically provable.  A
second reason is that experience has shown that extraneous axioms, however irrelevant to the
proof at hand, can severely slow down solver performance.  The first reason implies we want to
include enough axioms and the second reason implies that we don<span data-line="951"></span>&#39;<span data-line="951"></span>t want to include too many
axioms, where <span data-line="952"></span>&#8220;enough&#8221;<span data-line="952"></span> and <span data-line="952"></span>&#8220;too many&#8221;<span data-line="952"></span> can be controlled by a program.
</p>
<p class="p indent" data-line="954"><span data-line="954"></span>We want the included antecedents to be determined from the control path leading to a proof obligation. For
example, we<span data-line="955"></span>&#39;<span data-line="955"></span>d like the statements in a <span data-line="955"></span><em class="em-low1">then</em><span data-line="955"></span> branch of an <span data-line="955"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">if</span></code><span data-line="955"></span> not to affect the set of antecedents included when
proving the <span data-line="956"></span><em class="em-low1">else</em><span data-line="956"></span> branch. Therefore, the inclusion of such antecedents is done lazily. In a nutshell,
for any solver operation <span data-line="957"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&Omega;</span>.extend(e)</code><span data-line="957"></span> or <span data-line="957"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&Omega;</span>.prove(e)</code><span data-line="957"></span>, the solver state is first updated
to include the axioms in the <span data-line="958"></span><em class="em-low1">cone of influence</em><span data-line="958"></span> of <span data-line="958"></span><code class="code code1 language-b3 lang-b3 b3 colorized">e</code><span data-line="958"></span>.
</p>
<p class="p indent" data-line="960"><span data-line="960"></span>In a little more detail, a solver operation that<span data-line="960"></span>&#39;<span data-line="960"></span>s given an expression <span data-line="960"></span><code class="code code1 language-b3 lang-b3 b3 colorized">e</code><span data-line="960"></span>, say
<span data-line="961"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&Omega;</span>.extend(e)</code><span data-line="961"></span>, starts by computing the cone of influence of <span data-line="961"></span><code class="code code1 language-b3 lang-b3 b3 colorized">e</code><span data-line="961"></span>. This cone of influence,
call it <span data-line="962"></span><code class="code code1 language-b3 lang-b3 b3 colorized">C</code><span data-line="962"></span>, is a set of top-level declarations in the given B3 program. Then, the set of
top-level declarations that have already been used to form the solver state <span data-line="963"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&Omega;</span></code><span data-line="963"></span> are
subtracted, given a set of declarations <span data-line="964"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&Omega;</span> - C</code><span data-line="964"></span>. Finally, the declarations in <span data-line="964"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&Omega;</span> - C</code><span data-line="964"></span>
are added added to the solver state, <span data-line="965"></span><em class="em-low1">in the order in which these declarations occur in the
program</em><span data-line="966"></span>.
</p>
<p class="p indent" data-line="968"><span data-line="968"></span>It remains to define the cone of influence of an expression <span data-line="968"></span><code class="code code1 language-b3 lang-b3 b3 colorized">e</code><span data-line="968"></span>. It is the smallest set <span data-line="968"></span><code class="code code1 language-b3 lang-b3 b3 colorized">C</code><span data-line="968"></span> of
type, function, and axiom declarations such that
</p>
<ul class="ul list-star compact" data-line="971">
<li class="li ul-li list-star-li compact-li" data-line="971"><span data-line="971"></span>every global axiom (defined just below) is in <span data-line="971"></span><code class="code code1 language-b3 lang-b3 b3 colorized">C</code><span data-line="971"></span>
</li>
<li class="li ul-li list-star-li compact-li" data-line="972"><span data-line="972"></span>every function and type mentioned in <span data-line="972"></span><code class="code code1 language-b3 lang-b3 b3 colorized">e</code><span data-line="972"></span> is in <span data-line="972"></span><code class="code code1 language-b3 lang-b3 b3 colorized">C</code><span data-line="972"></span>
</li>
<li class="li ul-li list-star-li compact-li" data-line="973"><span data-line="973"></span>every function and type mentioned in a declaration in <span data-line="973"></span><code class="code code1 language-b3 lang-b3 b3 colorized">C</code><span data-line="973"></span> is in <span data-line="973"></span><code class="code code1 language-b3 lang-b3 b3 colorized">C</code><span data-line="973"></span>
</li>
<li class="li ul-li list-star-li compact-li" data-line="974"><span data-line="974"></span>for every function <span data-line="974"></span><code class="code code1 language-b3 lang-b3 b3 colorized">F</code><span data-line="974"></span> or type <span data-line="974"></span><code class="code code1 language-b3 lang-b3 b3 colorized">T</code><span data-line="974"></span> in <span data-line="974"></span><code class="code code1 language-b3 lang-b3 b3 colorized">C</code><span data-line="974"></span>, every axiom whose <span data-line="974"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:purple">explains</span></code><span data-line="974"></span> clauses include <span data-line="974"></span><code class="code code1 language-b3 lang-b3 b3 colorized">F</code><span data-line="974"></span> or <span data-line="974"></span><code class="code code1 language-b3 lang-b3 b3 colorized">T</code><span data-line="974"></span> is in <span data-line="974"></span><code class="code code1 language-b3 lang-b3 b3 colorized">C</code><span data-line="974"></span>
</li></ul>

<p class="p noindent" data-line="976"><span data-line="976"></span>Each <span data-line="976"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">axiom</span></code><span data-line="976"></span> declaration (see section<span data-line="976"></span>&nbsp;<a href="#sec-axioms" title="8.&#8194;Axioms" class="localref" style="target-element:h1"><span class="heading-label">8</span></a><span data-line="976"></span>) can explicitly declare which functions and types
depend on the axiom:
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="979" data-line-first="980" style="display:block"><code data-line="980">Explains ::=
  | <span style="color:purple">explains</span> Identifier</code></pre>
<p class="p noindent para-continued" data-line="984"><span data-line="984"></span>where <span data-line="984"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Identifier</code><span data-line="984"></span> denotes either a function or a type. An axiom without any explicit <span data-line="984"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:purple">explains</span></code><span data-line="984"></span>
clauses is called a <span data-line="985"></span><em class="em-low1">global axiom</em><span data-line="985"></span>. Global axioms and their dependencies are always included in
every verification condition. That is, every solver state is initialized so that it includes all
global axioms and their cones of influence.
</p><h3 id="sec-example" class="h2" data-line="989" data-heading-depth="2" style="display:block"><span data-line="989"></span><span class="heading-before"><span class="heading-label">12.0</span>.&#8194;</span><span data-line="989"></span>Example</h3>
<p class="p noindent" data-line="991"><span data-line="991"></span>Suppose a program contains the following top-level declarations:
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="993" data-line-first="994" style="display:block"><code data-line="994"><span style="color:blue">function</span> H(): <span style="color:teal">bool</span>

<span style="color:blue">type</span> A
<span style="color:blue">function</span> J(): A
<span style="color:blue">function</span> K(x: <span style="color:teal">int</span>): A
<span style="color:blue">function</span> L(x: <span style="color:teal">int</span>): A
<span style="color:blue">function</span> F(x: <span style="color:teal">int</span>): A
  <span style="color:purple">requires</span> H()
{
  <span style="color:blue">if</span> G(<span class="constant" style="color:purple">2</span>) = G(x) <span style="color:blue">then</span> L(<span class="constant" style="color:purple">0</span>) <span style="color:blue">else</span> L(<span class="constant" style="color:purple">1</span>)
}

<span style="color:blue">type</span> B
<span style="color:blue">function</span> G(): B

<span style="color:blue">axiom</span> <span style="color:purple">explains</span> H
  P
<span style="color:blue">axiom</span> <span style="color:purple">explains</span> B <span style="color:purple">explains</span> K
  Q
<span style="color:blue">axiom</span> S
<span style="color:blue">axiom</span> <span style="color:purple">explains</span> K
  <span style="color:blue">forall</span> x: <span style="color:teal">int</span> <span style="color:purple">trigger</span> K(x) <span style="color:purple">trigger</span> F(x) :: K(x) =&gt; F(x)
<span style="color:blue">axiom</span> <span style="color:purple">explains</span> A
  R</code></pre>
<p class="p noindent para-continued" data-line="1020"><span data-line="1020"></span>for some boolean expressions <span data-line="1020"></span><code class="code code1 language-b3 lang-b3 b3 colorized">P</code><span data-line="1020"></span>, <span data-line="1020"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Q</code><span data-line="1020"></span>, <span data-line="1020"></span><code class="code code1 language-b3 lang-b3 b3 colorized">R</code><span data-line="1020"></span>, and <span data-line="1020"></span><code class="code code1 language-b3 lang-b3 b3 colorized">S</code><span data-line="1020"></span> whose form we ignore for the purposes of this example.
Consider the processing of the statements
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1023" data-line-first="1024" style="display:block"><code data-line="1024"><span style="color:blue">var</span> y := J()
<span style="color:blue">var</span> z := F(<span class="constant" style="color:purple">5</span>)</code></pre>
<p class="p noindent para-continued" data-line="1028"><span data-line="1028"></span>from a solver state <span data-line="1028"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&Omega;</span></code><span data-line="1028"></span>. Since every solver state contains all global axioms,
we have that <span data-line="1029"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&Omega;</span></code><span data-line="1029"></span> contains <span data-line="1029"></span><code class="code code1 language-b3 lang-b3 b3 colorized">S</code><span data-line="1029"></span>. The processing of <span data-line="1029"></span><code class="code code1 language-b3 lang-b3 b3 colorized">y := J()</code><span data-line="1029"></span> performs the operation <span data-line="1029"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&Omega;</span>.extend(y = J())</code><span data-line="1029"></span>,
which will compute the cone of influence of <span data-line="1030"></span><code class="code code1 language-b3 lang-b3 b3 colorized">J()</code><span data-line="1030"></span>, namely the declarations
</p>
<ul class="ul list-star compact" data-line="1032">
<li class="li ul-li list-star-li compact-li" data-line="1032"><span data-line="1032"></span>axiom <span data-line="1032"></span><code class="code code1 language-b3 lang-b3 b3 colorized">S</code><span data-line="1032"></span>
</li>
<li class="li ul-li list-star-li compact-li" data-line="1033"><span data-line="1033"></span>function <span data-line="1033"></span><code class="code code1 language-b3 lang-b3 b3 colorized">J</code><span data-line="1033"></span> (which adds <span data-line="1033"></span><code class="code code1 language-b3 lang-b3 b3 colorized">A</code><span data-line="1033"></span>)
</li>
<li class="li ul-li list-star-li compact-li" data-line="1034"><span data-line="1034"></span>type <span data-line="1034"></span><code class="code code1 language-b3 lang-b3 b3 colorized">A</code><span data-line="1034"></span> (which adds <span data-line="1034"></span><code class="code code1 language-b3 lang-b3 b3 colorized">R</code><span data-line="1034"></span>)
</li>
<li class="li ul-li list-star-li compact-li" data-line="1035"><span data-line="1035"></span>axiom <span data-line="1035"></span><code class="code code1 language-b3 lang-b3 b3 colorized">R</code><span data-line="1035"></span>
</li></ul>

<p class="p noindent" data-line="1037"><span data-line="1037"></span>Since axiom <span data-line="1037"></span><code class="code code1 language-b3 lang-b3 b3 colorized">S</code><span data-line="1037"></span> is already accounted for in <span data-line="1037"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&Omega;</span></code><span data-line="1037"></span>, the operation <span data-line="1037"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&Omega;</span>.extend(y = J())</code><span data-line="1037"></span>
will have the effect of creating a solver state <span data-line="1038"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&Omega;</span>&#39;</code><span data-line="1038"></span> that represents
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1040" data-line-first="1041" style="display:block"><code data-line="1041"><span class="code-escaped">&Omega;</span> <span class="code-escaped">&#8743;</span> R <span class="code-escaped">&#8743;</span> y = J()</code></pre>
<p class="p noindent para-continued" data-line="1044"><span data-line="1044"></span>(shown here are only the constraints in the state, not the associated type and function declarations).
Then, for <span data-line="1045"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&Omega;</span>&#39;.extend(z = F(<span class="constant" style="color:purple">5</span>))</code><span data-line="1045"></span>, the cone of influence of <span data-line="1045"></span><code class="code code1 language-b3 lang-b3 b3 colorized">F(<span class="constant" style="color:purple">5</span>)</code><span data-line="1045"></span> is
</p>
<ul class="ul list-star compact" data-line="1047">
<li class="li ul-li list-star-li compact-li" data-line="1047"><span data-line="1047"></span>axiom <span data-line="1047"></span><code class="code code1 language-b3 lang-b3 b3 colorized">S</code><span data-line="1047"></span>
</li>
<li class="li ul-li list-star-li compact-li" data-line="1048"><span data-line="1048"></span>function <span data-line="1048"></span><code class="code code1 language-b3 lang-b3 b3 colorized">F</code><span data-line="1048"></span> (which adds <span data-line="1048"></span><code class="code code1 language-b3 lang-b3 b3 colorized">A</code><span data-line="1048"></span>, <span data-line="1048"></span><code class="code code1 language-b3 lang-b3 b3 colorized">H</code><span data-line="1048"></span>, <span data-line="1048"></span><code class="code code1 language-b3 lang-b3 b3 colorized">G</code><span data-line="1048"></span>, <span data-line="1048"></span><code class="code code1 language-b3 lang-b3 b3 colorized">L</code><span data-line="1048"></span>)
</li>
<li class="li ul-li list-star-li compact-li" data-line="1049"><span data-line="1049"></span>type <span data-line="1049"></span><code class="code code1 language-b3 lang-b3 b3 colorized">A</code><span data-line="1049"></span> (which adds <span data-line="1049"></span><code class="code code1 language-b3 lang-b3 b3 colorized">R</code><span data-line="1049"></span>)
</li>
<li class="li ul-li list-star-li compact-li" data-line="1050"><span data-line="1050"></span>function <span data-line="1050"></span><code class="code code1 language-b3 lang-b3 b3 colorized">H</code><span data-line="1050"></span> (which adds <span data-line="1050"></span><code class="code code1 language-b3 lang-b3 b3 colorized">P</code><span data-line="1050"></span>)
</li>
<li class="li ul-li list-star-li compact-li" data-line="1051"><span data-line="1051"></span>function <span data-line="1051"></span><code class="code code1 language-b3 lang-b3 b3 colorized">G</code><span data-line="1051"></span> (which adds <span data-line="1051"></span><code class="code code1 language-b3 lang-b3 b3 colorized">B</code><span data-line="1051"></span>)
</li>
<li class="li ul-li list-star-li compact-li" data-line="1052"><span data-line="1052"></span>function <span data-line="1052"></span><code class="code code1 language-b3 lang-b3 b3 colorized">L</code><span data-line="1052"></span>
</li>
<li class="li ul-li list-star-li compact-li" data-line="1053"><span data-line="1053"></span>axiom <span data-line="1053"></span><code class="code code1 language-b3 lang-b3 b3 colorized">R</code><span data-line="1053"></span>
</li>
<li class="li ul-li list-star-li compact-li" data-line="1054"><span data-line="1054"></span>axiom <span data-line="1054"></span><code class="code code1 language-b3 lang-b3 b3 colorized">P</code><span data-line="1054"></span>
</li>
<li class="li ul-li list-star-li compact-li" data-line="1055"><span data-line="1055"></span>type <span data-line="1055"></span><code class="code code1 language-b3 lang-b3 b3 colorized">B</code><span data-line="1055"></span> (which adds <span data-line="1055"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Q</code><span data-line="1055"></span>)
</li>
<li class="li ul-li list-star-li compact-li" data-line="1056"><span data-line="1056"></span>axiom <span data-line="1056"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Q</code><span data-line="1056"></span>
</li></ul>

<p class="p noindent" data-line="1058"><span data-line="1058"></span>Since axioms <span data-line="1058"></span><code class="code code1 language-b3 lang-b3 b3 colorized">S</code><span data-line="1058"></span> and <span data-line="1058"></span><code class="code code1 language-b3 lang-b3 b3 colorized">R</code><span data-line="1058"></span> are already accounted for in <span data-line="1058"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&Omega;</span>&#39;</code><span data-line="1058"></span>, the operation
<span data-line="1059"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&Omega;</span>&#39;.extend(z = F(<span class="constant" style="color:purple">5</span>))</code><span data-line="1059"></span> will have the effect of creating a solver state that represents
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1061" data-line-first="1062" style="display:block"><code data-line="1062"><span class="code-escaped">&Omega;</span>&#39; <span class="code-escaped">&#8743;</span> P <span class="code-escaped">&#8743;</span> Q <span class="code-escaped">&#8743;</span> z = F(<span class="constant" style="color:purple">5</span>)</code></pre>
<p class="p noindent para-continued" data-line="1065"><span data-line="1065"></span>Note the order in which <span data-line="1065"></span><code class="code code1 language-b3 lang-b3 b3 colorized">P</code><span data-line="1065"></span> and <span data-line="1065"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Q</code><span data-line="1065"></span> are included, namely the order in which these two axioms are
declared in the program.
</p><h2 id="sec-triggers" class="h1" data-line="1068" data-heading-depth="1" style="display:block"><span data-line="1068"></span><span class="heading-before"><span class="heading-label">13</span>.&#8194;</span><span data-line="1068"></span>Triggers</h2>
<p class="p noindent" data-line="1070"><span data-line="1070"></span>To facilitate goal-directed instantiations of universal quantifications (and negated existential
quantifiers) in the solver, all quantified variables are given <span data-line="1071"></span><em class="em-low1">triggers</em><span data-line="1071"></span> (aka <span data-line="1071"></span><em class="em-low1">matching
patterns</em><span data-line="1072"></span>). These are part of assertions (section<span data-line="1072"></span>&nbsp;<a href="#sec-assertions" title="4.&#8194;Assertions" class="localref" style="target-element:h1"><span class="heading-label">4</span></a><span data-line="1072"></span>), function definitions
(<span data-line="1073"></span><a href="#sec-functions" title="9.&#8194;Functions" class="localref" style="target-element:h1"><span class="heading-label">9</span></a><span data-line="1073"></span>), <span data-line="1073"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">forall</span></code><span data-line="1073"></span>/<span data-line="1073"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">exists</span></code><span data-line="1073"></span> expressions (section<span data-line="1073"></span>&nbsp;<a href="#sec-expressions" title="14.&#8194;Expressions" class="localref" style="target-element:h1"><span class="heading-label">14</span></a><span data-line="1073"></span>), and
closures (section<span data-line="1074"></span>&nbsp;<a href="#sec-closures" title="20.&#8194;Closures" class="localref" style="target-element:h1"><span class="heading-label">20</span></a><span data-line="1074"></span>).
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1076" data-line-first="1077" style="display:block"><code data-line="1077">Trigger ::=
  <span style="color:purple">trigger</span> Expr ( <span style="color:maroon">&quot;</span><span style="color:maroon">,</span><span style="color:maroon">&quot;</span> Expr)<span class="code-escaped"><sup>*</sup></span></code></pre><h2 id="sec-expressions" class="h1" data-line="1081" data-heading-depth="1" style="display:block"><span data-line="1081"></span><span class="heading-before"><span class="heading-label">14</span>.&#8194;</span><span data-line="1081"></span>Expressions</h2>
<p class="p noindent" data-line="1083"><span data-line="1083"></span>Expressions are pretty standard. Noteworthy here is that
</p>
<ul class="ul list-star compact" data-line="1085">
<li class="li ul-li list-star-li compact-li" data-line="1085"><span data-line="1085"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">old</span>(y)</code><span data-line="1085"></span> is an expression that denotes the value of in/out-parameter <span data-line="1085"></span><code class="code code1 language-b3 lang-b3 b3 colorized">y</code><span data-line="1085"></span> on entry to the enclosing procedure
</li>
<li class="li ul-li list-star-li compact-li" data-line="1086"><span data-line="1086"></span>quantifiers have <span data-line="1086"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Trigger</code><span data-line="1086"></span>s (see section<span data-line="1086"></span>&nbsp;<a href="#sec-triggers" title="13.&#8194;Triggers" class="localref" style="target-element:h1"><span class="heading-label">13</span></a><span data-line="1086"></span>)
</li>
<li class="li ul-li list-star-li compact-li" data-line="1087"><span data-line="1087"></span>expressions can be labeled (see section<span data-line="1087"></span>&nbsp;<a href="#sec-markers" title="11.&#8194;Error information" class="localref" style="target-element:h1"><span class="heading-label">11</span></a><span data-line="1087"></span>)
</li></ul>
<h2 id="sec-variations-on-statements" class="h1" data-line="1089" data-heading-depth="1" style="display:block"><span data-line="1089"></span><span class="heading-before"><span class="heading-label">15</span>.&#8194;</span><span data-line="1089"></span>Variations on statements</h2><h3 id="sec-exit-without-label" class="h2" data-line="1091" data-heading-depth="2" style="display:block"><span data-line="1091"></span><span class="heading-before"><span class="heading-label">15.0</span>.&#8194;</span><span data-line="1091"></span>Exit without argument</h3>
<p class="p noindent" data-line="1093"><span data-line="1093"></span>Common loops in source languages have predefined ways of exiting the loop. In B3, all loop exits
use the <span data-line="1094"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">exit</span></code><span data-line="1094"></span> statement (or the <span data-line="1094"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">return</span></code><span data-line="1094"></span> statement). To reduce the number of labels a B3 user
has to invent, B3 also allows <span data-line="1095"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">exit</span></code><span data-line="1095"></span> to be used without an argument. It is allowed only in
contexts that are enclosed by one or more loops. The meaning of <span data-line="1096"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">exit</span></code><span data-line="1096"></span> is <span data-line="1096"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">exit</span> <span class="code-escaped">&ell;</span></code><span data-line="1096"></span>, where
<span data-line="1097"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&ell;</span></code><span data-line="1097"></span> is the (given or by B3 generated) label of the closest enclosing loop.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1099" data-line-first="1100" style="display:block"><code data-line="1100">Stmt ::=
  | ...
  | <span style="color:blue">exit</span> [ <span class="code-escaped">&ell;</span> ]</code></pre><h3 id="sec-havoc" class="h2" data-line="1105" data-heading-depth="2" style="display:block"><span data-line="1105"></span><span class="heading-before"><span class="heading-label">15.1</span>.&#8194;</span><span data-line="1105"></span>Havoc</h3>
<p class="p noindent" data-line="1107"><span data-line="1107"></span>To set a variable <span data-line="1107"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x</code><span data-line="1107"></span> of type <span data-line="1107"></span><code class="code code1 language-b3 lang-b3 b3 colorized">T</code><span data-line="1107"></span> to an arbitrary value, one can write
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1109" data-line-first="1110" style="display:block"><code data-line="1110"><span style="color:blue">var</span> tmp: T
x := tmp</code></pre>
<p class="p noindent para-continued" data-line="1114"><span data-line="1114"></span>However, this puts the burden on the B3 user to come up with a new name <span data-line="1114"></span><code class="code code1 language-b3 lang-b3 b3 colorized">tmp</code><span data-line="1114"></span>. Plus, since the
assignment to <span data-line="1115"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x</code><span data-line="1115"></span> generates a new incarnation anyway, the resulting solver context will contain
two extra names.
</p>
<p class="p indent" data-line="1118"><span data-line="1118"></span>To improve on these issues, B3 also supports a special assignment statement, commonly
known as the <span data-line="1119"></span><em class="em-low1">havoc</em><span data-line="1119"></span> statement, that assigns to arbitrary value.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1121" data-line-first="1122" style="display:block"><code data-line="1122">Stmt ::=
  | ...
  | x := *</code></pre>
<p class="p noindent para-continued" data-line="1127"><span data-line="1127"></span>It is processed as follows:
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1129" data-line-first="1130" style="display:block"><code data-line="1130">Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> x := * <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> Cc, <span class="code-escaped">&sigma;</span>, B, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  let x&#39; be <span class="code-escaped">&sigma;</span>.new(x)
  Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> Cc, <span class="code-escaped">&sigma;</span>[x := x&#39;], B, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span></code></pre>
<p class="p noindent para-continued" data-line="1135"><span data-line="1135"></span>Note that the havoc statement is nondeterministic.
</p><h3 id="sec-var-init" class="h2" data-line="1137" data-heading-depth="2" style="display:block"><span data-line="1137"></span><span class="heading-before"><span class="heading-label">15.2</span>.&#8194;</span><span data-line="1137"></span>Initializing variable declaration</h3>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1139" data-line-first="1140" style="display:block"><code data-line="1140">Stmt ::=
  | ...
  | <span style="color:blue">var</span> x [: Type] := Expr</code></pre>
<p class="p noindent para-continued" data-line="1145"><span data-line="1145"></span>The statement <span data-line="1145"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">var</span> x: T := e</code><span data-line="1145"></span> is a shorthand for
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1147" data-line-first="1148" style="display:block"><code data-line="1148"><span style="color:blue">var</span> x: T
x := e</code></pre>
<p class="p noindent para-continued" data-line="1152"><span data-line="1152"></span>However, the initializing form of the variable declaration
</p>
<ul class="ul list-star compact" data-line="1154">
<li class="li ul-li list-star-li compact-li" data-line="1154"><span data-line="1154"></span>does not require a type, since the type can be inferred from the expression <span data-line="1154"></span><code class="code code1 language-b3 lang-b3 b3 colorized">e</code><span data-line="1154"></span>
</li>
<li class="li ul-li list-star-li compact-li" data-line="1155"><span data-line="1155"></span>saves one incarnation variable, since it is not necessary for processing to name the unused, uninitialized value
</li>
<li class="li ul-li list-star-li compact-li" data-line="1156"><span data-line="1156"></span>is the only form of the <span data-line="1156"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">var</span></code><span data-line="1156"></span> statement that<span data-line="1156"></span>&#39;<span data-line="1156"></span>s allowed in an <span data-line="1156"></span><code class="code code1 language-b3 lang-b3 b3 colorized">ABlock</code><span data-line="1156"></span> (see section<span data-line="1156"></span>&nbsp;<a href="#sec-more-assertions" title="17.&#8194;Variations on assertions" class="localref" style="target-element:h1"><span class="heading-label">17</span></a><span data-line="1156"></span>)
</li></ul>

<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1158" data-line-first="1159" style="display:block"><code data-line="1159">Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span style="color:blue">var</span> x: T := e <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> Cc, <span class="code-escaped">&sigma;</span>, B, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  let e&#39; be <span class="code-escaped">&sigma;</span>[e]
  let x&#39; be <span class="code-escaped">&sigma;</span>.new(x)
  Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> Cc, <span class="code-escaped">&sigma;</span>[x := x&#39;], B, <span class="code-escaped">&Omega;</span>.extend(x&#39; = e&#39;) <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span></code></pre><h3 id="sec-auto-invariants" class="h2" data-line="1165" data-heading-depth="2" style="display:block"><span data-line="1165"></span><span class="heading-before"><span class="heading-label">15.3</span>.&#8194;</span><span data-line="1165"></span>Auto-invariants</h3>
<p class="p noindent" data-line="1167"><span data-line="1167"></span>A source language typically has more fine-grained types than those provided in B3. For example,
one way to translate a source language with classes and subclasses is to use a single type for all references
in B3, say <span data-line="1169"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">type</span> Ref</code><span data-line="1169"></span>. This means that the more specific type information, say, the fact that a parameter or local
variable <span data-line="1170"></span><code class="code code1 language-b3 lang-b3 b3 colorized">c: C</code><span data-line="1170"></span> in the source language is declared to be of a specific class <span data-line="1170"></span><code class="code code1 language-b3 lang-b3 b3 colorized">C</code><span data-line="1170"></span>, is instead encoded as a logical
condition, like <span data-line="1171"></span><code class="code code1 language-b3 lang-b3 b3 colorized">IsC(c)</code><span data-line="1171"></span> for some B3 function <span data-line="1171"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">function</span> IsC(r: Ref): <span style="color:teal">bool</span></code><span data-line="1171"></span>.
</p>
<p class="p indent" data-line="1173"><span data-line="1173"></span>B3 supports <span data-line="1173"></span><em class="em-low1">auto-invariants</em><span data-line="1173"></span> as a way to help maintain such conditions. This affects loops and procedures.
</p><h4 id="sec-auto-invariants-for-loops" class="h3" data-line="1175" data-heading-depth="3" style="display:block"><span data-line="1175"></span><span class="heading-before"><span class="heading-label">15.3.0</span>.&#8194;</span><span data-line="1175"></span>Auto-invariants for loops</h4>
<p class="p noindent" data-line="1177"><span data-line="1177"></span>Deductive reasoning about a loop considers one arbitrary iteration of the loop, starting from a
state where the loop body<span data-line="1178"></span>&#39;<span data-line="1178"></span>s assignment targets have arbitrary values satisfying the loop
invariant (see section<span data-line="1179"></span>&nbsp;<a href="#sec-loops" title="10.&#8194;Loops" class="localref" style="target-element:h1"><span class="heading-label">10</span></a><span data-line="1179"></span>). Thus, if <span data-line="1179"></span><code class="code code1 language-b3 lang-b3 b3 colorized">c</code><span data-line="1179"></span> is a variable that is assigned in the loop
body, then we would like <span data-line="1180"></span><code class="code code1 language-b3 lang-b3 b3 colorized">IsC(c)</code><span data-line="1180"></span> to be part of the loop invariant. Let<span data-line="1180"></span>&#39;<span data-line="1180"></span>s consider how a translation from a
source language can arrange to emit such loop invariants.
</p>
<p class="p indent" data-line="1183"><span data-line="1183"></span>One way is for the translation to add a loop invariant <span data-line="1183"></span><code class="code code1 language-b3 lang-b3 b3 colorized">IsC(c)</code><span data-line="1183"></span> for every mutable variable in
scope. But that would mean a lot of invariants about variables that aren<span data-line="1184"></span>&#39;<span data-line="1184"></span>t ever changed by the
loop.
</p>
<p class="p indent" data-line="1187"><span data-line="1187"></span>Alternatively, the translation from a source language could work out which variables are
potentially modified by the loop and emit an invariant <span data-line="1188"></span><code class="code code1 language-b3 lang-b3 b3 colorized">IsC(c)</code><span data-line="1188"></span> only if <span data-line="1188"></span><code class="code code1 language-b3 lang-b3 b3 colorized">c</code><span data-line="1188"></span> may be modified by
the loop body. But this means the translator needs to work out the loop<span data-line="1189"></span>&#39;<span data-line="1189"></span>s assignment targets, a
task that is already provided by B3 (section<span data-line="1190"></span>&nbsp;<a href="#sec-loops" title="10.&#8194;Loops" class="localref" style="target-element:h1"><span class="heading-label">10</span></a><span data-line="1190"></span>).
</p>
<p class="p indent" data-line="1192"><span data-line="1192"></span>To this end, B3 allows variable
declarations to include an <span data-line="1193"></span><em class="em-low1">auto-invariant</em><span data-line="1193"></span>. B3 adds a variable<span data-line="1193"></span>&#39;<span data-line="1193"></span>s auto-invariant to the loop
invariant of any loop that assigns to the variable.
</p><h4 id="sec-auto-invariants-for-procedures" class="h3" data-line="1196" data-heading-depth="3" style="display:block"><span data-line="1196"></span><span class="heading-before"><span class="heading-label">15.3.1</span>.&#8194;</span><span data-line="1196"></span>Auto-invariants for procedures</h4>
<p class="p noindent" data-line="1198"><span data-line="1198"></span>Consider an in/out-parameter <span data-line="1198"></span><code class="code code1 language-b3 lang-b3 b3 colorized">c</code><span data-line="1198"></span> of a procedure. To obtain an invariant (like <span data-line="1198"></span><code class="code code1 language-b3 lang-b3 b3 colorized">IsC(c)</code><span data-line="1198"></span>) for <span data-line="1198"></span><code class="code code1 language-b3 lang-b3 b3 colorized">c</code><span data-line="1198"></span>
in any loops that modify <span data-line="1199"></span><code class="code code1 language-b3 lang-b3 b3 colorized">c</code><span data-line="1199"></span>, we declare <span data-line="1199"></span><code class="code code1 language-b3 lang-b3 b3 colorized">c</code><span data-line="1199"></span> with an auto-invariant. In addition, we want this
condition to be a pre- and postcondition of the procedure. But it would be annoying to have to
declare conditions like <span data-line="1201"></span><code class="code code1 language-b3 lang-b3 b3 colorized">IsC(c)</code><span data-line="1201"></span> in three places: in a <span data-line="1201"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:purple">requires</span></code><span data-line="1201"></span> clause, in an <span data-line="1201"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:purple">ensures</span></code><span data-line="1201"></span>
clause, and as an auto-invariant.  To avoid this redundancy, B3 incorporates parameter
auto-invariants into procedure pre- and postconditions as well.
</p>
<p class="p indent" data-line="1205"><span data-line="1205"></span>In other words, an auto-invariant plays a role in two places: on procedure boundaries (for parameters),
and on loop boundaries (for parameters and local variables assigned in the loop body). In other places,
a B3 program is free to temporary violate the conditions stated in auto-invariants.
</p><h4 id="sec-auto-invariant-declarations" class="h3" data-line="1209" data-heading-depth="3" style="display:block"><span data-line="1209"></span><span class="heading-before"><span class="heading-label">15.3.2</span>.&#8194;</span><span data-line="1209"></span>Auto-invariant declarations</h4>
<p class="p noindent" data-line="1211"><span data-line="1211"></span>To support auto-invariants, variable declarations are changed to
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1213" data-line-first="1214" style="display:block"><code data-line="1214">Stmt ::=
  | ...
  | <span style="color:blue">var</span> x: Type AutoInvariant<span class="code-escaped"><sup>*</sup></span>
  | <span style="color:blue">var</span> x [: Type] AutoInvariant<span class="code-escaped"><sup>*</sup></span> := Expr</code></pre>
<p class="p noindent para-continued" data-line="1220"><span data-line="1220"></span>and parameter declarations are changed to 
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1222" data-line-first="1223" style="display:block"><code data-line="1223">CParam ::=
  | [<span style="color:blue">inout</span> | <span style="color:blue">out</span>] x: Type AutoInvariant<span class="code-escaped"><sup>*</sup></span></code></pre>
<p class="p noindent para-continued" data-line="1227"><span data-line="1227"></span>where
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1229" data-line-first="1230" style="display:block"><code data-line="1230">AutoInvariant ::=
  | <span style="color:purple">invariant</span> Expr
  | <span style="color:purple">invariant</span> ABlock</code></pre>
<p class="p noindent para-continued" data-line="1235"><span data-line="1235"></span>The <span data-line="1235"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Expr</code><span data-line="1235"></span> or <span data-line="1235"></span><code class="code code1 language-b3 lang-b3 b3 colorized">ABlock</code><span data-line="1235"></span> argument in an auto-invariant is allowed to mention the variable being declared.
In addition, for a local variable, an auto-invariant is allowed to mention any of the variables in scope.
For in/out-parameters, the auto-invariant is allowed to mention any in/out-parameter in both its ordinary form
and in the form surround by <span data-line="1238"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">old</span></code><span data-line="1238"></span>, and any in-parameter.
For out-parameters, the auto-invariant is allowed to mention any of the parameters and also any in/out-parameter
in its <span data-line="1240"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">old</span></code><span data-line="1240"></span> form.
</p>
<p class="p indent" data-line="1242"><span data-line="1242"></span>(Note for those familiar with Boogie 2: B3<span data-line="1242"></span>&#39;<span data-line="1242"></span>s auto-invariants are similar to Boogie<span data-line="1242"></span>&#39;<span data-line="1242"></span>s <span data-line="1242"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">where</span></code><span data-line="1242"></span> clauses, but
not exactly.)
</p><h4 id="sec-example" class="h3" data-line="1245" data-heading-depth="3" style="display:block"><span data-line="1245"></span><span class="heading-before"><span class="heading-label">15.3.3</span>.&#8194;</span><span data-line="1245"></span>Example</h4>
<p class="p noindent" data-line="1247"><span data-line="1247"></span>The auto-invariant of a variable <span data-line="1247"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x</code><span data-line="1247"></span> is added to the invariant of a loop if <span data-line="1247"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x</code><span data-line="1247"></span> is an assignment
target (see section<span data-line="1248"></span>&nbsp;<a href="#sec-assignment-targets" title="10.0.&#8194;Assignment targets" class="localref" style="target-element:h2"><span class="heading-label">10.0</span></a><span data-line="1248"></span>) of the loop body. The auto-invariant itself may
mention additional variables, but whether or not those variables are assignment targets does not
play a role in determining whether or not to apply the auto-invariant of <span data-line="1250"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x</code><span data-line="1250"></span>.
</p>
<p class="p indent" data-line="1252"><span data-line="1252"></span>For example, consider the following variable declarations:
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1254" data-line-first="1255" style="display:block"><code data-line="1255"><span style="color:blue">var</span> x$defined: <span style="color:teal">bool</span>
<span style="color:blue">var</span> x: Ref <span style="color:purple">invariant</span> x$defined ==&gt; IsC(x)</code></pre>
<p class="p noindent para-continued" data-line="1259"><span data-line="1259"></span>If a loop body assigns to <span data-line="1259"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x</code><span data-line="1259"></span> or to both <span data-line="1259"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x</code><span data-line="1259"></span> and <span data-line="1259"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x$defined</code><span data-line="1259"></span>, then <span data-line="1259"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x$defined ==&gt; IsC(x)</code><span data-line="1259"></span> is added as
a loop invariant. But if neither of those two variables is an assignment target or if only <span data-line="1260"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x$defined</code><span data-line="1260"></span>
is, then the auto-invariant of <span data-line="1261"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x</code><span data-line="1261"></span> is not added to the loop invariant.
</p><h2 id="sec-if-variations" class="h1" data-line="1263" data-heading-depth="1" style="display:block"><span data-line="1263"></span><span class="heading-before"><span class="heading-label">16</span>.&#8194;</span><span data-line="1263"></span>Variations on conditional statements</h2><h3 id="sec-omitted-else-and-cascading-if" class="h2" data-line="1265" data-heading-depth="2" style="display:block"><span data-line="1265"></span><span class="heading-before"><span class="heading-label">16.0</span>.&#8194;</span><span data-line="1265"></span>Omitted else and cascading if</h3>
<p class="p noindent" data-line="1267"><span data-line="1267"></span>The <span data-line="1267"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">if</span></code><span data-line="1267"></span> statement shown in section<span data-line="1267"></span>&nbsp;<a href="#sec-statements" title="2.&#8194;Statements" class="localref" style="target-element:h1"><span class="heading-label">2</span></a><span data-line="1267"></span> deterministically chooses between a <span data-line="1267"></span><em class="em-low1">then</em><span data-line="1267"></span>
branch and an <span data-line="1268"></span><em class="em-low1">else</em><span data-line="1268"></span> branch. B3 supports two familiar syntactic variations of it. Syntactically,
the <span data-line="1269"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">else</span></code><span data-line="1269"></span> branch can be omitted, which stands for <span data-line="1269"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">else</span> { }</code><span data-line="1269"></span>. Also, if the <span data-line="1269"></span><em class="em-low1">else</em><span data-line="1269"></span> branch is a block
with just an <span data-line="1270"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">if</span></code><span data-line="1270"></span> statement, then the braces around it can be omitted, which makes for a cascading
<span data-line="1271"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">if</span></code><span data-line="1271"></span> statement.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1273" data-line-first="1274" style="display:block"><code data-line="1274">If ::=
  | <span style="color:blue">if</span> Expr Block [ IfTail ]
  | ...
IfTail ::=
  | <span style="color:blue">else</span> Block
  | <span style="color:blue">else</span> If</code></pre><h3 id="sec-if-case-statement" class="h2" data-line="1282" data-heading-depth="2" style="display:block"><span data-line="1282"></span><span class="heading-before"><span class="heading-label">16.1</span>.&#8194;</span><span data-line="1282"></span>If-case statement</h3>
<p class="p noindent" data-line="1284"><span data-line="1284"></span>The <span data-line="1284"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">if</span></code><span data-line="1284"></span> statement gives two mutually exclusive branches. If the source program wants to prescribe
a conditional with more than two branches that it knows to be mutually exclusive, then the <span data-line="1285"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">if</span></code><span data-line="1285"></span>
statement introduces unnecessary repetition of conditions. For example, in the cascading <span data-line="1286"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">if</span></code><span data-line="1286"></span>
statement
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1289" data-line-first="1290" style="display:block"><code data-line="1290"><span style="color:blue">if</span> x = <span class="constant" style="color:purple">0</span> {
  A
} <span style="color:blue">else</span> <span style="color:blue">if</span> x &lt; <span class="constant" style="color:purple">0</span> {
  B
} <span style="color:blue">else</span> {
  C
}</code></pre>
<p class="p noindent para-continued" data-line="1299"><span data-line="1299"></span>the conditions assumed at the beginning of the second and third branches are
<span data-line="1300"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&not;</span>(x = <span class="constant" style="color:purple">0</span>) <span class="code-escaped">&#8743;</span> x &lt; <span class="constant" style="color:purple">0</span></code><span data-line="1300"></span> and <span data-line="1300"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&not;</span>(x = <span class="constant" style="color:purple">0</span>) <span class="code-escaped">&#8743;</span> <span class="code-escaped">&not;</span>(x &lt; <span class="constant" style="color:purple">0</span>)</code><span data-line="1300"></span>,
respectively, whereas just <span data-line="1301"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x &lt; <span class="constant" style="color:purple">0</span></code><span data-line="1301"></span> and <span data-line="1301"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="constant" style="color:purple">0</span> &lt; x</code><span data-line="1301"></span> would have sufficed.
</p>
<p class="p indent" data-line="1303"><span data-line="1303"></span>Moreover, the branches of the <span data-line="1303"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">if</span></code><span data-line="1303"></span> statement are also exhaustive, meaning that execution
always continues to some branch. To omit a continuation in an <span data-line="1304"></span><em class="em-low1">else</em><span data-line="1304"></span> branch, one needs to
explicitly place a <span data-line="1305"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">assume</span> <span style="color:blue">false</span></code><span data-line="1305"></span> in that branch.
</p>
<p class="p indent" data-line="1307"><span data-line="1307"></span>To improve on these situations, B3 provides a nondeterministic <span data-line="1307"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">if</span></code><span data-line="1307"></span>-<span data-line="1307"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">case</span></code><span data-line="1307"></span> statement.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1309" data-line-first="1310" style="display:block"><code data-line="1310">Stmt ::=
  | ...
  | IfCase
IfCase ::=
  | <span style="color:blue">if</span> Case Case<span class="code-escaped"><sup>*</sup></span>
Case ::=
  | <span style="color:blue">case</span> Expr Block</code></pre>
<p class="p noindent para-continued" data-line="1319"><span data-line="1319"></span>It is processed as follows:
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1321" data-line-first="1322" style="display:block"><code data-line="1322">Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span style="color:blue">if</span> <span style="color:blue">case</span> e0 S0 <span style="color:blue">case</span> e1 S1 ... <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> Cc, <span class="code-escaped">&sigma;</span>, B, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  let e0&#39; be <span class="code-escaped">&sigma;</span>[e0]
  Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> S0 <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> Cc, <span class="code-escaped">&sigma;</span>, B, <span class="code-escaped">&Omega;</span>.extend(e0&#39;) <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  let e1&#39; be <span class="code-escaped">&sigma;</span>[e1]
  Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> S1 <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> Cc, <span class="code-escaped">&sigma;</span>, B, <span class="code-escaped">&Omega;</span>.extend(e1&#39;) <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  ...</code></pre>
<p class="p noindent para-continued" data-line="1330"><span data-line="1330"></span>Note that the cases need not be mutually exclusive, nor do they need to be exhaustive.
</p><h2 id="sec-more-assertions" class="h1" data-line="1332" data-heading-depth="1" style="display:block"><span data-line="1332"></span><span class="heading-before"><span class="heading-label">17</span>.&#8194;</span><span data-line="1332"></span>Variations on assertions</h2>
<p class="p noindent" data-line="1334"><span data-line="1334"></span>Going beyond the simple assertion statements in section<span data-line="1334"></span>&nbsp;<a href="#sec-assertions" title="4.&#8194;Assertions" class="localref" style="target-element:h1"><span class="heading-label">4</span></a><span data-line="1334"></span>,
B3 offers a rich suite of ways to
prescribe checks and learning. These assertions have been tailored around the patterns
built up over the years in the Dafny verifier.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1339" data-line-first="1340" style="display:block"><code data-line="1340">Assertion ::=
  | ...
  | ABlock
  | <span style="color:blue">forall</span> x: Type Trigger<span class="code-escaped"><sup>*</sup></span> ABlock
  | AIf
  | AIfCase
ABlockAssertion ::=
  | ...
  | <span style="color:blue">var</span> x [: Type] := Expr
AIf ::=
  | <span style="color:blue">if</span> Expr ABlock [ AIfTail ]
AIfTail ::=
  | <span style="color:blue">else</span> ABlock
  | <span style="color:blue">else</span> AIf
AIfCase ::=
  | <span style="color:blue">if</span> ACase ACase<span class="code-escaped"><sup>*</sup></span>
ACase ::=
  | <span style="color:blue">case</span> Expr ABlock</code></pre>
<p class="p noindent para-continued" data-line="1360"><span data-line="1360"></span>There<span data-line="1360"></span>&#39;<span data-line="1360"></span>s syntactic overlap between <span data-line="1360"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Assertion</code><span data-line="1360"></span> and other statements. For example, in the grammar
presented,
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1363" data-line-first="1364" style="display:block"><code data-line="1364"><span style="color:blue">if</span> x &lt; y {
  <span style="color:blue">var</span> z := x - y
  <span style="color:blue">assert</span> z <span class="code-escaped">&#8800;</span> <span class="constant" style="color:purple">0</span>
}</code></pre>
<p class="p noindent para-continued" data-line="1370"><span data-line="1370"></span>can be both an <span data-line="1370"></span><code class="code code1 language-b3 lang-b3 b3 colorized">If</code><span data-line="1370"></span> and an <span data-line="1370"></span><code class="code code1 language-b3 lang-b3 b3 colorized">AIf</code><span data-line="1370"></span>. The ambiguity is broken by accepting a statement as an <span data-line="1370"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Assertion</code><span data-line="1370"></span>
if possible and as other statements otherwise.
</p>
<p class="p indent" data-line="1373"><span data-line="1373"></span>We defined the processing of basic assertions in section<span data-line="1373"></span>&nbsp;<a href="#sec-assertions" title="4.&#8194;Assertions" class="localref" style="target-element:h1"><span class="heading-label">4</span></a><span data-line="1373"></span> and defined the
processing of <span data-line="1374"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">var</span></code><span data-line="1374"></span> with an initializer in section<span data-line="1374"></span>&nbsp;<a href="#sec-var-init" title="15.2.&#8194;Initializing variable declaration" class="localref" style="target-element:h2"><span class="heading-label">15.2</span></a><span data-line="1374"></span>. Here is the definition of
<span data-line="1375"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Process</code><span data-line="1375"></span> for the other assertions:
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1377" data-line-first="1378" style="display:block"><code data-line="1378">Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> { Aa } <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> Cc, <span class="code-escaped">&sigma;</span>, B, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  let <span class="code-escaped">&ell;</span> be a new label
  let L be Learn<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> { Aa }, <span class="code-escaped">&sigma;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  let B&#39; be B[<span class="code-escaped">&ell;</span> := (domain of <span class="code-escaped">&sigma;</span>, <span style="color:blue">assume</span> L <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> Cc)]
  Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> Aa <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> <span style="color:blue">exit</span> <span class="code-escaped">&ell;</span>, <span class="code-escaped">&sigma;</span>, B&#39;, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>

Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span style="color:blue">forall</span> x: T A <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> Cc, <span class="code-escaped">&sigma;</span>, B, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span style="color:blue">var</span> x: T A, <span class="code-escaped">&sigma;</span>, B, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  let L be Learn<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span style="color:blue">forall</span> x: T A, <span class="code-escaped">&sigma;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> Cc, <span class="code-escaped">&sigma;</span>, B, <span class="code-escaped">&Omega;</span>.extend(L) <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>

Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span style="color:blue">if</span> e A0 <span style="color:blue">else</span> A1 <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> Cc, <span class="code-escaped">&sigma;</span>, B, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  let e&#39; be <span class="code-escaped">&sigma;</span>[e]
  Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> A0, <span class="code-escaped">&sigma;</span>, B, <span class="code-escaped">&Omega;</span>.extend(e)
  Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> A1, <span class="code-escaped">&sigma;</span>, B, <span class="code-escaped">&Omega;</span>.extend(<span class="code-escaped">&not;</span>e)
  let L be Learn<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span style="color:blue">if</span> e A0 <span style="color:blue">else</span> A1, <span class="code-escaped">&sigma;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> Cc, <span class="code-escaped">&sigma;</span>, B, <span class="code-escaped">&Omega;</span>.extend(L) <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>

Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span style="color:blue">if</span> <span style="color:blue">case</span> e0 A0 <span style="color:blue">case</span> e1 A1 ... <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> Cc, <span class="code-escaped">&sigma;</span>, B, <span class="code-escaped">&Omega;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  let e0&#39; be <span class="code-escaped">&sigma;</span>[e0]
  Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> A0, <span class="code-escaped">&sigma;</span>, B, <span class="code-escaped">&Omega;</span>.extend(e0&#39;) <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  let e1&#39; be <span class="code-escaped">&sigma;</span>[e1]
  Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> A1, <span class="code-escaped">&sigma;</span>, B, <span class="code-escaped">&Omega;</span>.extend(e1&#39;) <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  ...
  let L be Learn<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span style="color:blue">if</span> <span style="color:blue">case</span> e0 A0 <span style="color:blue">case</span> e1 A1 ..., <span class="code-escaped">&sigma;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> Cc, <span class="code-escaped">&sigma;</span>, B, <span class="code-escaped">&Omega;</span>.extend(L) <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span></code></pre>
<p class="p noindent para-continued" data-line="1406"><span data-line="1406"></span>Here is the definition of <span data-line="1406"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Learn</code><span data-line="1406"></span> for the new assertions:
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1408" data-line-first="1409" style="display:block"><code data-line="1409">Learn<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> { Aa }, <span class="code-escaped">&sigma;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  LearnSeq<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> Aa, <span class="code-escaped">&sigma;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>

LearnSeq<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.4922em;width:0.5307em" viewBox='34.67 57.347 5.054 4.688'><desc>$\varepsilon$</desc><g id='math-f8b1c5'><use x='34.869' y='61.836' xlink:href='#g3-34'/></g></svg></span>, <span class="code-escaped">&sigma;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  <span style="color:blue">true</span>

LearnSeq<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span style="color:blue">var</span> x: T := e <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> Aa, <span class="code-escaped">&sigma;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  let e&#39; be <span class="code-escaped">&sigma;</span>[e]
  let x&#39; be <span class="code-escaped">&sigma;</span>.new(x)
  let L be LearnSeq<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> Aa, <span class="code-escaped">&sigma;</span>[x := x&#39;] <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  x&#39; = e&#39; <span class="code-escaped">&#8743;</span> L

LearnSeq<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> A <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> Aa, <span class="code-escaped">&sigma;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  let L be Learn<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> A, <span class="code-escaped">&sigma;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  let L&#39; be LearnSeq<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> Aa, <span class="code-escaped">&sigma;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  L <span class="code-escaped">&#8743;</span> L&#39;

Learn<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span style="color:blue">forall</span> x: T A <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.5067em;width:0.3335em" viewBox='88.468 57.209 3.176 4.826'><desc>$\cdot$</desc><g id='math-571ca3'><use x='88.667' y='61.836' xlink:href='#g2-1'/></g></svg></span> Aa, <span class="code-escaped">&sigma;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  let x&#39; be <span class="code-escaped">&sigma;</span>.new(x)
  let <span class="code-escaped">&sigma;</span>&#39; be <span class="code-escaped">&sigma;</span>[x := x&#39;]
  let L be Learn<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> A, <span class="code-escaped">&sigma;</span>&#39; <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  <span style="color:blue">forall</span> x&#39;: T :: L

Learn<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span style="color:blue">if</span> e A0 <span style="color:blue">else</span> A1, <span class="code-escaped">&sigma;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  let L0 be Learn<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> A0, <span class="code-escaped">&sigma;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  let L1 be Learn<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> A1, <span class="code-escaped">&sigma;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  let e&#39; be <span class="code-escaped">&sigma;</span>[e]
  (e <span class="code-escaped">&#8743;</span> L0) <span class="code-escaped">&#8744;</span> (<span class="code-escaped">&not;</span>e <span class="code-escaped">&#8743;</span> Q1)

Learn<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> <span style="color:blue">if</span> <span style="color:blue">case</span> e0 A0 <span style="color:blue">case</span> e1 A1 ..., <span class="code-escaped">&sigma;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span> =
  let e0&#39; be <span class="code-escaped">&sigma;</span>[e0]
  let L0 be Learn<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> A0, <span class="code-escaped">&sigma;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  let e1&#39; be <span class="code-escaped">&sigma;</span>[e1]
  let L1 be Learn<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> A1, <span class="code-escaped">&sigma;</span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span>
  ...
  (e0&#39; <span class="code-escaped">&#8743;</span> L0) <span class="code-escaped">&#8744;</span> (e1&#39; <span class="code-escaped">&#8743;</span> Q1) <span class="code-escaped">&#8744;</span> ...</code></pre><h3 id="sec-example" class="h2" data-line="1447" data-heading-depth="2" style="display:block"><span data-line="1447"></span><span class="heading-before"><span class="heading-label">17.0</span>.&#8194;</span><span data-line="1447"></span>Example</h3>
<p class="p noindent" data-line="1449"><span data-line="1449"></span>As an example, consider a source-language statement <span data-line="1449"></span><code class="code code1 language-b3 lang-b3 b3 colorized">y := <span style="color:blue">forall</span> x: X :: P(x) &amp;&amp; Q(x)</code><span data-line="1449"></span> where <span data-line="1449"></span><code class="code code1 language-b3 lang-b3 b3 colorized">&amp;&amp;</code><span data-line="1449"></span> is a short-circuit
operator. If the source language has a notion of well-formedness that needs to be checked, then this statement
can succinctly be translated into B3 as follows:
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1453" data-line-first="1454" style="display:block"><code data-line="1454"><span style="color:blue">forall</span> x: X {
  <span style="color:blue">check</span> PPre(x)
  <span style="color:blue">assume</span> PCanCall(x)
  <span style="color:blue">if</span> P(x) {
    <span style="color:blue">check</span> QPre(x)
    <span style="color:blue">assume</span> QCanCall(x)
  }
}
y := <span style="color:blue">forall</span> x: X :: P(x) <span class="code-escaped">&#8743;</span> Q(x)</code></pre>
<p class="p noindent para-continued" data-line="1465"><span data-line="1465"></span>This leads to the following interactions with the solver. (Using the definitions above, there will be three variables
in the processed form and all of them will have the name <span data-line="1466"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x</code><span data-line="1466"></span>. This leads to no confusion for machine processing,
since two of the variables are bound variables that shadow the outer variables. To more clearly show these as three
different variables in the following, the example instead uses the names <span data-line="1468"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x%<span class="constant" style="color:purple">0</span></code><span data-line="1468"></span>, <span data-line="1468"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x%<span class="constant" style="color:purple">1</span></code><span data-line="1468"></span>, and <span data-line="1468"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x%<span class="constant" style="color:purple">2</span></code><span data-line="1468"></span>.)
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1470" data-line-first="1471" style="display:block"><code data-line="1471"><span style="color:darkgreen">// process the assertions</span>
<span class="code-escaped">&Omega;</span>.prove(PPre(x%<span class="constant" style="color:purple">0</span>))
<span class="code-escaped">&Omega;</span>&#39; := <span class="code-escaped">&Omega;</span>.extend(PCanCall(x%<span class="constant" style="color:purple">0</span>))
<span class="code-escaped">&Omega;</span><span class="code-escaped">"</span> := <span class="code-escaped">&Omega;</span>.extend(P(x%<span class="constant" style="color:purple">0</span>))
<span class="code-escaped">&Omega;</span><span class="code-escaped">"</span>.prove(QPre(x%<span class="constant" style="color:purple">0</span>))
<span class="code-escaped">&Omega;</span><span class="code-escaped"><sup>3</sup></span> := <span class="code-escaped">&Omega;</span><span class="code-escaped">"</span>.extend(QCanCall(x%<span class="constant" style="color:purple">0</span>))

<span style="color:darkgreen">// learn from the assertions and continue processing</span>
<span class="code-escaped">&Omega;</span><span class="code-escaped"><sup>4</sup></span> := <span class="code-escaped">&Omega;</span>.extend(<span style="color:blue">forall</span> x%<span class="constant" style="color:purple">1</span>: X :: PCanCall(x%<span class="constant" style="color:purple">1</span>) &amp;&amp; (P(x%<span class="constant" style="color:purple">1</span>) ==&gt; QCanCall(x%<span class="constant" style="color:purple">1</span>)))
Process<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='88.468 54.164 4.421 10.361'><desc>$\llbracket$</desc><g id='math-116d6b'><use x='88.667' y='61.836' xlink:href='#g0-74'/></g></svg></span> y := <span style="color:blue">forall</span> x%<span class="constant" style="color:purple">2</span>: X :: P(x%<span class="constant" style="color:purple">2</span>) <span class="code-escaped">&#8743;</span> Q(x%<span class="constant" style="color:purple">2</span>), ..., ..., <span class="code-escaped">&Omega;</span><span class="code-escaped"><sup>4</sup></span> <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.2930em;height:1.0879em;width:0.4642em" viewBox='34.67 54.164 4.421 10.361'><desc>$\rrbracket$</desc><g id='math-480945'><use x='34.869' y='61.836' xlink:href='#g0-75'/></g></svg></span></code></pre>
<p class="p noindent para-continued" data-line="1483"><span data-line="1483"></span>Note that the well-formedness checking of the short-circuit boolean operator includes control flow (namely, the <span data-line="1483"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">if</span></code><span data-line="1483"></span>
statement that is part of the assertion block). However, what is learnt from this check (as assigned to <span data-line="1484"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped">&Omega;</span><span class="code-escaped"><sup>4</sup></span></code><span data-line="1484"></span>)
does not involve control flow. So, the well-formedness checking does not force an exponential explosion of control
paths (unlike how Dafny is encoded into Boogie 2 today).
</p><h2 id="sec-type-variations" class="h1" data-line="1488" data-heading-depth="1" style="display:block"><span data-line="1488"></span><span class="heading-before"><span class="heading-label">18</span>.&#8194;</span><span data-line="1488"></span>Variations on types</h2><h3 id="sec-type-synonyms" class="h2" data-line="1490" data-heading-depth="2" style="display:block"><span data-line="1490"></span><span class="heading-before"><span class="heading-label">18.0</span>.&#8194;</span><span data-line="1490"></span>Type synonyms</h3>
<p class="p noindent" data-line="1492"><span data-line="1492"></span>It is sometimes convenient to have more than one name for a type. A <span data-line="1492"></span><em class="em-low1">type synonym</em><span data-line="1492"></span> provides that facility.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1494" data-line-first="1495" style="display:block"><code data-line="1495">TopLevelDeclaration ::=
  | <span style="color:blue">type</span> T = Type</code></pre>
<p class="p noindent para-continued" data-line="1499"><span data-line="1499"></span>A type synonym is exactly that<span data-line="1499"></span>&#8211;<span data-line="1499"></span>a synonym. There is no difference in using the name of the synonym or using the name of
the type it stands for.
</p>
<p class="p indent" data-line="1502"><span data-line="1502"></span>Declarations of type synonyms are not allowed be cylic. For example, the declarations
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1504" data-line-first="1505" style="display:block"><code data-line="1505"><span style="color:blue">type</span> A = B
<span style="color:blue">type</span> B = A</code></pre>
<p class="p noindent para-continued" data-line="1509"><span data-line="1509"></span>are illegal, as is the declaration
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1511" data-line-first="1512" style="display:block"><code data-line="1512"><span style="color:blue">type</span> D = D</code></pre><h3 id="sec-partition" class="h2" data-line="1515" data-heading-depth="2" style="display:block"><span data-line="1515"></span><span class="heading-before"><span class="heading-label">18.1</span>.&#8194;</span><span data-line="1515"></span>Partitions</h3>
<p class="p noindent" data-line="1517"><span data-line="1517"></span>A <span data-line="1517"></span><em class="em-low1">partition</em><span data-line="1517"></span> is a separation of the values of a type into non-overlapping subsets. A partition can be used in
the declaration of a function, as explained in section<span data-line="1518"></span>&nbsp;<a href="#sec-function-with-partition" title="19.1.&#8194;Using partition as function result" class="localref" style="target-element:h2"><span class="heading-label">19.1</span></a><span data-line="1518"></span>.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1520" data-line-first="1521" style="display:block"><code data-line="1521">TopLevelDeclaration ::=
  | ...
  | <span style="color:blue">partition</span> T [ = Type ]</code></pre>
<p class="p noindent para-continued" data-line="1526"><span data-line="1526"></span>If the right-hand side type of a partition is omitted, the declaration also declares the underlying type.
For example,
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1529" data-line-first="1530" style="display:block"><code data-line="1530"><span style="color:blue">partition</span> Nationality</code></pre>
<p class="p noindent para-continued" data-line="1533"><span data-line="1533"></span>is like the declarations
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1535" data-line-first="1536" style="display:block"><code data-line="1536"><span style="color:blue">type</span> t$Nationality
<span style="color:blue">partition</span> p$Nationality = t$Nationality</code></pre>
<p class="p noindent para-continued" data-line="1540"><span data-line="1540"></span>except that the name <span data-line="1540"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Nationality</code><span data-line="1540"></span> is used for both. If the name is used in a place where a
partition is allowed, then the name refers to the partition; otherwise, it refers to the type.
</p><h2 id="sec-variations-on-functions" class="h1" data-line="1543" data-heading-depth="1" style="display:block"><span data-line="1543"></span><span class="heading-before"><span class="heading-label">19</span>.&#8194;</span><span data-line="1543"></span>Variations on functions</h2>
<p class="p noindent" data-line="1545"><span data-line="1545"></span>This section defines some variations on the declaration of functions (see section<span data-line="1545"></span>&nbsp;<a href="#sec-functions" title="9.&#8194;Functions" class="localref" style="target-element:h1"><span class="heading-label">9</span></a><span data-line="1545"></span>).
</p><h3 id="sec-injective" class="h2" data-line="1547" data-heading-depth="2" style="display:block"><span data-line="1547"></span><span class="heading-before"><span class="heading-label">19.0</span>.&#8194;</span><span data-line="1547"></span>Injective parameters</h3>
<p class="p noindent" data-line="1549"><span data-line="1549"></span>By using the modifier <span data-line="1549"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:purple">injective</span></code><span data-line="1549"></span> for a function parameter, one declares that the function is injective
(that is, one-to-one) in that argument.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1552" data-line-first="1553" style="display:block"><code data-line="1553">FParamModifier ::=
  | <span style="color:purple">injective</span></code></pre>
<p class="p noindent para-continued" data-line="1557"><span data-line="1557"></span>This automatically generates an inverse function
together with (effectively) an axiom that states the injectivity property. For example,
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1560" data-line-first="1561" style="display:block"><code data-line="1561"><span style="color:blue">type</span> Color
<span style="color:blue">function</span> MakeColor(<span style="color:purple">injective</span> colorId: <span style="color:teal">int</span>, <span style="color:purple">injective</span> isSaturated: <span style="color:teal">bool</span>): Color</code></pre>
<p class="p noindent para-continued" data-line="1565"><span data-line="1565"></span>declares three functions and two axioms. The two additional functions and axioms are
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1567" data-line-first="1568" style="display:block"><code data-line="1568"><span style="color:blue">function</span> colorId(c: Color): <span style="color:teal">int</span>
<span style="color:blue">function</span> isSaturated(c: Color): <span style="color:teal">bool</span>

<span style="color:blue">axiom</span> <span style="color:purple">explains</span> MakeColor <span style="color:purple">explains</span> colorId
  <span style="color:blue">forall</span> colorId: <span style="color:teal">int</span>, isSaturated: <span style="color:teal">bool</span> <span style="color:purple">trigger</span> MakeColor(colorId, isSaturated) ::
    colorId(MakeColor(colorId, isSaturated)) = colorId
<span style="color:blue">axiom</span> <span style="color:purple">explains</span> MakeColor <span style="color:purple">explains</span> isSaturated
  <span style="color:blue">forall</span> colorId: <span style="color:teal">int</span>, isSaturated: <span style="color:teal">bool</span> <span style="color:purple">trigger</span> MakeColor(colorId, isSaturated) ::
    isSaturated(MakeColor(colorId, isSaturated)) = isSaturated</code></pre>
<p class="p noindent para-continued" data-line="1579"><span data-line="1579"></span>These inverse functions are available for use in the same way that <span data-line="1579"></span><code class="code code1 language-b3 lang-b3 b3 colorized">MakeColor</code><span data-line="1579"></span> is.
</p><h3 id="sec-function-with-partition" class="h2" data-line="1581" data-heading-depth="2" style="display:block"><span data-line="1581"></span><span class="heading-before"><span class="heading-label">19.1</span>.&#8194;</span><span data-line="1581"></span>Using partition as function result</h3>
<p class="p noindent" data-line="1583"><span data-line="1583"></span>A function<span data-line="1583"></span>&#39;<span data-line="1583"></span>s result can be declared to be either a type of a partition (see <span data-line="1583"></span><code class="code code1 language-b3 lang-b3 b3 colorized">TypeOrPartition</code><span data-line="1583"></span> in
section<span data-line="1584"></span>&nbsp;<a href="#sec-functions" title="9.&#8194;Functions" class="localref" style="target-element:h1"><span class="heading-label">9</span></a><span data-line="1584"></span>, and see section<span data-line="1584"></span>&nbsp;<a href="#sec-partition" title="18.1.&#8194;Partitions" class="localref" style="target-element:h2"><span class="heading-label">18.1</span></a><span data-line="1584"></span> on partitions).
If the function<span data-line="1585"></span>&#39;<span data-line="1585"></span>s result is declared to be a partition, then the declaration says that the
values returned by the function uniquely determine the function. For example, the declarations
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1588" data-line-first="1589" style="display:block"><code data-line="1589"><span style="color:blue">type</span> Person
<span style="color:blue">partition</span> Nationality = Person
<span style="color:blue">function</span> German(x: <span style="color:teal">int</span>): Nationality
<span style="color:blue">function</span> Italian(y: <span style="color:teal">int</span>, z: <span style="color:teal">int</span>): Nationality</code></pre>
<p class="p noindent para-continued" data-line="1595"><span data-line="1595"></span>say that the functions <span data-line="1595"></span><code class="code code1 language-b3 lang-b3 b3 colorized">German</code><span data-line="1595"></span> and <span data-line="1595"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Italian</code><span data-line="1595"></span> return values from disjoint subsets of type <span data-line="1595"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Person</code><span data-line="1595"></span>.
That is, these two function declarations effectively give rise to the declaration
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1598" data-line-first="1599" style="display:block"><code data-line="1599"><span style="color:blue">axiom</span> <span style="color:blue">forall</span> x: <span style="color:teal">int</span>, y: <span style="color:teal">int</span>, z: <span style="color:teal">int</span> :: German(x) <span class="code-escaped">&#8800;</span> Italian(y, z)</code></pre>
<p class="p noindent para-continued" data-line="1602"><span data-line="1602"></span>The use of a partition as a function result is convenient since it saves the B3 user from
having to declare quadratically many axioms like the one above or from having to declare some kind
of tag function and arbitrarily assign distinct tag values.
</p>
<p class="p indent" data-line="1606"><span data-line="1606"></span>Note, the use of a partition result does not imply anything about the exhaustiveness of values.
For example, the declarations above allow the existence of a <span data-line="1607"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Person</code><span data-line="1607"></span> who is neither German nor Italian.
</p>
<p class="p indent" data-line="1609"><span data-line="1609"></span>Also, the use of a partition result does not imply anything about injectivity. For example, the
declarations above allow the possibility that <span data-line="1610"></span><code class="code code1 language-b3 lang-b3 b3 colorized">German(<span class="constant" style="color:purple">17</span>)</code><span data-line="1610"></span> and <span data-line="1610"></span><code class="code code1 language-b3 lang-b3 b3 colorized">German(<span class="constant" style="color:purple">19</span>)</code><span data-line="1610"></span> refer to the same <span data-line="1610"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Person</code><span data-line="1610"></span>.
</p>
<p class="p indent" data-line="1612"><span data-line="1612"></span>By combining partition results and injective parameters, one can declare algebraic datatypes. For example,
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1614" data-line-first="1615" style="display:block"><code data-line="1615"><span style="color:blue">partition</span> List
<span style="color:blue">function</span> Nil(): List
<span style="color:blue">function</span> Cons(head: <span style="color:teal">int</span>, tail: List): List</code></pre>
<p class="p noindent para-continued" data-line="1620"><span data-line="1620"></span>sets up <span data-line="1620"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Nil</code><span data-line="1620"></span> and <span data-line="1620"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Cons</code><span data-line="1620"></span> as the common constructors of an algebraic <span data-line="1620"></span><code class="code code1 language-b3 lang-b3 b3 colorized">List</code><span data-line="1620"></span> type. These declarations do not
imply exhaustiveness; that is, they do not prevent the possibility that some <span data-line="1621"></span><code class="code code1 language-b3 lang-b3 b3 colorized">List</code><span data-line="1621"></span> value is neither <span data-line="1621"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Nil()</code><span data-line="1621"></span>
nor some <span data-line="1622"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Cons(h, t)</code><span data-line="1622"></span>. The declarations also do not say which fixpoint is intended; for example, they allow
the possibility of the usual inductive definition of <span data-line="1623"></span><code class="code code1 language-b3 lang-b3 b3 colorized">List</code><span data-line="1623"></span> (where every list contains a finite number of
elements) as well as a coinductive definition of <span data-line="1624"></span><code class="code code1 language-b3 lang-b3 b3 colorized">List</code><span data-line="1624"></span> (where a list can be cyclic or infinite).
</p><h3 id="sec-function-forall" class="h2" data-line="1626" data-heading-depth="2" style="display:block"><span data-line="1626"></span><span class="heading-before"><span class="heading-label">19.2</span>.&#8194;</span><span data-line="1626"></span>Additional bound variables for function definitions</h3>
<p class="p noindent" data-line="1628"><span data-line="1628"></span>For triggering purposes (see section<span data-line="1628"></span>&nbsp;<a href="#sec-triggers" title="13.&#8194;Triggers" class="localref" style="target-element:h1"><span class="heading-label">13</span></a><span data-line="1628"></span> on triggers above), it can be desirable to obtain an
axiom that quantifies over more variables than the function parameters. For example, one might want the
definition of a function <span data-line="1630"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Elvis</code><span data-line="1630"></span> to be triggered only if it is used as an argument to another
function <span data-line="1631"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Jukebox</code><span data-line="1631"></span>. The desired axiom is then
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1633" data-line-first="1634" style="display:block"><code data-line="1634"><span style="color:blue">axiom</span> <span style="color:blue">forall</span> age: <span style="color:teal">int</span>, coin: <span style="color:teal">int</span> <span style="color:purple">trigger</span> JukeBox(Elvis(age), coin) ::
  <span class="constant" style="color:purple">10</span> &lt;= age &amp;&amp; age &lt;= <span class="constant" style="color:purple">42</span> &amp;&amp; <span class="constant" style="color:purple">0</span> &lt;= coin
  ==&gt;
  Elvis(age) = FavoriteSong(<span class="constant" style="color:purple">1935</span> + age)</code></pre>
<p class="p noindent para-continued" data-line="1640"><span data-line="1640"></span>A first attempt at obtaining this axiom is
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1642" data-line-first="1643" style="display:block"><code data-line="1643"><span style="color:blue">function</span> Elvis(age: <span style="color:teal">int</span>)
  <span style="color:purple">requires</span> <span class="constant" style="color:purple">10</span> &lt;= age &amp;&amp; age &lt;= <span class="constant" style="color:purple">42</span>
  <span style="color:purple">requires</span> <span style="color:blue">exists</span> coin: <span style="color:teal">int</span> <span style="color:purple">trigger</span> JukeBox(Elvis(age), coin) :: <span class="constant" style="color:purple">0</span> &lt;= coin
{
  FavoriteSong(<span class="constant" style="color:purple">1935</span> + age)
}</code></pre>
<p class="p noindent para-continued" data-line="1651"><span data-line="1651"></span>This gives the same logical meaning as the desired axiom above. However, the triggers are different:
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1653" data-line-first="1654" style="display:block"><code data-line="1654"><span style="color:blue">axiom</span> <span style="color:blue">forall</span> age: <span style="color:teal">int</span> <span style="color:purple">trigger</span> Elvis(age) ::
  <span class="constant" style="color:purple">10</span> &lt;= age &amp;&amp; age &lt;= <span class="constant" style="color:purple">42</span> &amp;&amp;
  (<span style="color:blue">exists</span> coin: <span style="color:teal">int</span> <span style="color:purple">trigger</span> JukeBox(Elvis(age), coin) :: <span class="constant" style="color:purple">0</span> &lt;= coin)
  ==&gt;
  Elvis(age) = FavoriteSong(<span class="constant" style="color:purple">1935</span> + age)</code></pre>
<p class="p noindent para-continued" data-line="1661"><span data-line="1661"></span>This axiom does not achieve the intended purpose of limiting its instantiations to uses of <span data-line="1661"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Elvis</code><span data-line="1661"></span>
as an argument to <span data-line="1662"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Jukebox</code><span data-line="1662"></span>.
</p>
<p class="p indent" data-line="1664"><span data-line="1664"></span>To provide a way to obtain the desired axiom, B3 allows a function to have a <span data-line="1664"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:blue">forall</span></code><span data-line="1664"></span> clause whose
purpose it is to introduce further bound variables in the generated function-definition axiom.
Using it, the <span data-line="1666"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Elvis</code><span data-line="1666"></span> function can be defined as follows:
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1668" data-line-first="1669" style="display:block"><code data-line="1669"><span style="color:blue">function</span> Elvis(age: <span style="color:teal">int</span>) <span style="color:blue">forall</span> coin: <span style="color:teal">int</span>
  <span style="color:purple">trigger</span> JukeBox(Elvis(age), coin)
  <span style="color:purple">requires</span> <span class="constant" style="color:purple">10</span> &lt;= age &amp;&amp; age &lt;= <span class="constant" style="color:purple">42</span> &amp;&amp; <span class="constant" style="color:purple">0</span> &lt;= coin
{
  FavoriteSong(<span class="constant" style="color:purple">1935</span> + age)
}</code></pre>
<p class="p noindent para-continued" data-line="1677"><span data-line="1677"></span>Any additional bound variables are allowed only in the preconditions, not in the body of the function.
</p>
<p class="p indent" data-line="1679"><span data-line="1679"></span>Here is another example:
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1681" data-line-first="1682" style="display:block"><code data-line="1682"><span style="color:blue">function</span> FCanCall(x: <span style="color:teal">int</span>, fuel: Fuel): <span style="color:teal">bool</span>
<span style="color:blue">function</span> F(x: <span style="color:teal">int</span>): <span style="color:teal">int</span> <span style="color:blue">forall</span> fuel: Fuel
  <span style="color:purple">trigger</span> FCanCall(x, Succ(fuel))
  <span style="color:purple">requires</span> FCanCall(x, Succ(fuel))
{
  <span style="color:blue">if</span> x = <span class="constant" style="color:purple">0</span> <span style="color:blue">then</span> <span class="constant" style="color:purple">3</span> <span style="color:blue">else</span> <span class="constant" style="color:purple">2</span> <span class="code-escaped"><sup>*</sup></span> F(x - <span class="constant" style="color:purple">1</span>) + <span class="constant" style="color:purple">5</span>
}</code></pre>
<p class="p noindent para-continued" data-line="1691"><span data-line="1691"></span>which in effect generates the axiom
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1693" data-line-first="1694" style="display:block"><code data-line="1694"><span style="color:blue">axiom</span> <span style="color:blue">forall</span> x: <span style="color:teal">int</span>, fuel: Fuel <span style="color:purple">trigger</span> FCanCall(x, Succ(fuel)) ::
  FCanCall(x, Succ(fuel))
  ==&gt;
  F(x) = <span style="color:blue">if</span> x = <span class="constant" style="color:purple">0</span> <span style="color:blue">then</span> <span class="constant" style="color:purple">3</span> <span style="color:blue">else</span> <span class="constant" style="color:purple">2</span> <span class="code-escaped"><sup>*</sup></span> F(x - <span class="constant" style="color:purple">1</span>) + <span class="constant" style="color:purple">5</span></code></pre><h2 id="sec-closures" class="h1" data-line="1700" data-heading-depth="1" style="display:block"><span data-line="1700"></span><span class="heading-before"><span class="heading-label">20</span>.&#8194;</span><span data-line="1700"></span>Closures</h2>
<p class="p noindent" data-line="1702"><span data-line="1702"></span>The translation of some source expressions into B3 follows a recipe like
</p>
<blockquote data-line="1704">

<p class="p noindent" data-line="1704"><span data-line="1704"></span>translate this source expression into a B3 expression that we<span data-line="1704"></span>&#39;<span data-line="1704"></span>ll call <span data-line="1704"></span><code class="code code1 language-b3 lang-b3 b3 colorized">s</code><span data-line="1704"></span> and lay down some
  axioms about the properties of <span data-line="1705"></span><code class="code code1 language-b3 lang-b3 b3 colorized">s</code><span data-line="1705"></span>
</p></blockquote>
<p class="p noindent" data-line="1707"><span data-line="1707"></span>Usually, the
source expression has some free variables. In order to write an axiom about those, it is necessary to
parameterize <span data-line="1709"></span><code class="code code1 language-b3 lang-b3 b3 colorized">s</code><span data-line="1709"></span>, which involves some effort.
</p>
<p class="p indent" data-line="1711"><span data-line="1711"></span>Here<span data-line="1711"></span>&#39;<span data-line="1711"></span>s a simple, concrete example. Suppose the source-language expressions <span data-line="1711"></span><code class="code code1 language-b3 lang-b3 b3 colorized">E0</code><span data-line="1711"></span>, <span data-line="1711"></span><code class="code code1 language-b3 lang-b3 b3 colorized">E1</code><span data-line="1711"></span>, and <span data-line="1711"></span><code class="code code1 language-b3 lang-b3 b3 colorized">E2</code><span data-line="1711"></span>
of type <span data-line="1712"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:teal">int</span></code><span data-line="1712"></span> are translated into B3 as the expressions <span data-line="1712"></span><code class="code code1 language-b3 lang-b3 b3 colorized">e0</code><span data-line="1712"></span>, <span data-line="1712"></span><code class="code code1 language-b3 lang-b3 b3 colorized">e1</code><span data-line="1712"></span>, and <span data-line="1712"></span><code class="code code1 language-b3 lang-b3 b3 colorized">e2</code><span data-line="1712"></span>. Then, a way to
translate the sequence display expression <span data-line="1713"></span><code class="code code1 language-b3 lang-b3 b3 colorized">[E0, E1, E2]</code><span data-line="1713"></span> is <span data-line="1713"></span><code class="code code1 language-b3 lang-b3 b3 colorized">F(e0, e1, e2)</code><span data-line="1713"></span> where <span data-line="1713"></span><code class="code code1 language-b3 lang-b3 b3 colorized">F</code><span data-line="1713"></span> is a new
function
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1716" data-line-first="1717" style="display:block"><code data-line="1717"><span style="color:blue">function</span> F(x0: <span style="color:teal">int</span>, x1: <span style="color:teal">int</span>, x2: <span style="color:teal">int</span>): Sequence</code></pre>
<p class="p noindent para-continued" data-line="1720"><span data-line="1720"></span>with the properties defined via these axioms:
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1722" data-line-first="1723" style="display:block"><code data-line="1723"><span style="color:blue">axiom</span> <span style="color:blue">forall</span> x0: <span style="color:teal">int</span>, x1: <span style="color:teal">int</span>, x2: <span style="color:teal">int</span> <span style="color:purple">trigger</span> SeqLength(F(x0, x1, x2)) ::
  SeqLength(F(x0, x1, x2)) = <span class="constant" style="color:purple">3</span>
<span style="color:blue">axiom</span> <span style="color:blue">forall</span> x0: <span style="color:teal">int</span>, x1: <span style="color:teal">int</span>, x2: <span style="color:teal">int</span> <span style="color:purple">trigger</span> F(x0, x1, x2) ::
  SeqIndex(F(x0, x1, x2), <span class="constant" style="color:purple">0</span>) = Box(x0)
<span style="color:blue">axiom</span> <span style="color:blue">forall</span> x0: <span style="color:teal">int</span>, x1: <span style="color:teal">int</span>, x2: <span style="color:teal">int</span> <span style="color:purple">trigger</span> F(x0, x1, x2) ::
  SeqIndex(F(x0, x1, x2), <span class="constant" style="color:purple">1</span>) = Box(x1)
<span style="color:blue">axiom</span> <span style="color:blue">forall</span> x0: <span style="color:teal">int</span>, x1: <span style="color:teal">int</span>, x2: <span style="color:teal">int</span> <span style="color:purple">trigger</span> F(x0, x1, x2) ::
  SeqIndex(F(x0, x1, x2), <span class="constant" style="color:purple">2</span>) = Box(x2)</code></pre>
<p class="p noindent para-continued" data-line="1733"><span data-line="1733"></span>For functions, this process is known as <span data-line="1733"></span><em class="em-low1">lambda lifting</em><span data-line="1733"></span>. Using a <span data-line="1733"></span><em class="em-low1">closure</em><span data-line="1733"></span>, B3 performs the
heavy lifting (pun intended) in creating such liftings.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1736" data-line-first="1737" style="display:block"><code data-line="1737">Closure ::=
  | <span style="color:blue">lift</span> ClosureBinding<span class="code-escaped"><sup>*,</sup></span> <span style="color:blue">into</span> ClosureVar : Type <span style="color:blue">by</span> <span style="color:maroon">&quot;</span><span style="color:maroon">{</span><span style="color:maroon">&quot;</span> ClosureProperty<span class="code-escaped"><sup>*,</sup></span> <span style="color:maroon">&quot;</span><span style="color:maroon">}</span><span style="color:maroon">&quot;</span>
ClosureBinding ::=
  | ClosureVar [ <span style="color:maroon">&quot;</span><span style="color:maroon">(</span><span style="color:maroon">&quot;</span> CParam<span class="code-escaped"><sup>*,</sup></span> <span style="color:maroon">&quot;</span><span style="color:maroon">)</span><span style="color:maroon">&quot;</span> ] := Expr
CParam ::=
  | x: Type
ClosureProperty ::=
  | [ Trigger Trigger<span class="code-escaped"><sup>*</sup></span> :: ] Expr</code></pre>
<p class="p noindent para-continued" data-line="1747"><span data-line="1747"></span>where <span data-line="1747"></span><code class="code code1 language-b3 lang-b3 b3 colorized">ClosureVar</code><span data-line="1747"></span> is a variable whose name starts with <span data-line="1747"></span><code class="code code1 language-b3 lang-b3 b3 colorized">%</code><span data-line="1747"></span> to visually indicate that the variable
is like a macro that denotes an expression.
</p>
<p class="p indent" data-line="1750"><span data-line="1750"></span>Before giving the details of how to elaborate a closure into logic, it is instructive to look at some examples.
</p><h3 id="sec-example--display-expression" class="h2" data-line="1752" data-heading-depth="2" style="display:block"><span data-line="1752"></span><span class="heading-before"><span class="heading-label">20.0</span>.&#8194;</span><span data-line="1752"></span>Example: display expression</h3>
<p class="p noindent" data-line="1754"><span data-line="1754"></span>Continuing the example above, to obtain the function <span data-line="1754"></span><code class="code code1 language-b3 lang-b3 b3 colorized">F</code><span data-line="1754"></span>, the expression <span data-line="1754"></span><code class="code code1 language-b3 lang-b3 b3 colorized">F(e0, e1, e2)</code><span data-line="1754"></span>, and
the associated axioms for the sequence expression above, one uses the B3 closure
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1757" data-line-first="1758" style="display:block"><code data-line="1758"><span style="color:blue">lift</span>
  %x0 := e0,
  %x1 := e1,
  %x2 := e2
<span style="color:blue">into</span>
  %s: Sequence
<span style="color:blue">by</span> {
  <span style="color:purple">trigger</span> SeqLength(%s) :: SeqLength(%s) = <span class="constant" style="color:purple">3</span>,
  SeqIndex(%s, <span class="constant" style="color:purple">0</span>) = Box(%x0),
  SeqIndex(%s, <span class="constant" style="color:purple">1</span>) = Box(%x1),
  SeqIndex(%s, <span class="constant" style="color:purple">2</span>) = Box(%x2)
}</code></pre><h3 id="sec-example--sequence-constructor" class="h2" data-line="1772" data-heading-depth="2" style="display:block"><span data-line="1772"></span><span class="heading-before"><span class="heading-label">20.1</span>.&#8194;</span><span data-line="1772"></span>Example: sequence constructor</h3>
<p class="p noindent" data-line="1774"><span data-line="1774"></span>Suppose, in the source language, that expression <span data-line="1774"></span><code class="code code1 language-b3 lang-b3 b3 colorized">N</code><span data-line="1774"></span> denotes a desired sequence length,
expression <span data-line="1775"></span><code class="code code1 language-b3 lang-b3 b3 colorized">E</code><span data-line="1775"></span> denotes a function from indices to elements of type <span data-line="1775"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:teal">real</span></code><span data-line="1775"></span>, and that <span data-line="1775"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:teal">seq</span>(N, E)</code><span data-line="1775"></span>
denotes a sequence constructed to have length <span data-line="1776"></span><code class="code code1 language-b3 lang-b3 b3 colorized">N</code><span data-line="1776"></span> and elements described by <span data-line="1776"></span><code class="code code1 language-b3 lang-b3 b3 colorized">E</code><span data-line="1776"></span>. If <span data-line="1776"></span><code class="code code1 language-b3 lang-b3 b3 colorized">N</code><span data-line="1776"></span> and <span data-line="1776"></span><code class="code code1 language-b3 lang-b3 b3 colorized">E</code><span data-line="1776"></span>
are translated into B3 expression <span data-line="1777"></span><code class="code code1 language-b3 lang-b3 b3 colorized">n</code><span data-line="1777"></span> and <span data-line="1777"></span><code class="code code1 language-b3 lang-b3 b3 colorized">e</code><span data-line="1777"></span> (of types <span data-line="1777"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:teal">int</span></code><span data-line="1777"></span> and <span data-line="1777"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Func</code><span data-line="1777"></span>, say), then the
sequence constructor can be translated into the following closure:
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1780" data-line-first="1781" style="display:block"><code data-line="1781"><span style="color:blue">lift</span>
  %len := n,
  %f := e
<span style="color:blue">into</span>
  %s: Sequence
<span style="color:blue">by</span> {
  <span style="color:purple">trigger</span> SeqLength(%s) :: <span class="constant" style="color:purple">0</span> &lt;= %len ==&gt; SeqLength(%s) = %len,
  <span style="color:blue">forall</span> j: <span style="color:teal">int</span> <span style="color:purple">trigger</span> SeqIndex(%s, j) ::
    <span class="constant" style="color:purple">0</span> &lt;= j &amp;&amp; j &lt; %len ==&gt; SeqIndex(%s, j) = Apply(%f, Box(j))
}</code></pre>
<p class="p noindent para-continued" data-line="1793"><span data-line="1793"></span>B3 turns this closure into
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1795" data-line-first="1796" style="display:block"><code data-line="1796"><span style="color:blue">function</span> F(len: <span style="color:teal">int</span>, f: Func): Sequence
<span style="color:blue">axiom</span> <span style="color:blue">forall</span> len: <span style="color:teal">int</span>, f: Func <span style="color:purple">trigger</span> SeqLength(F(len, f)) ::
  <span class="constant" style="color:purple">0</span> &lt;= len ==&gt; SeqLength(F(len, f)) = len
<span style="color:blue">axiom</span> <span style="color:blue">forall</span> len: <span style="color:teal">int</span>, f: Func, j: <span style="color:teal">int</span> <span style="color:purple">trigger</span> SeqIndex(F(len, f), j) ::
  <span class="constant" style="color:purple">0</span> &lt;= j &amp;&amp; j &lt; len ==&gt; SeqIndex(F(len, f), j) = Apply(f, Box(j))</code></pre>
<p class="p noindent para-continued" data-line="1803"><span data-line="1803"></span>for some new function <span data-line="1803"></span><code class="code code1 language-b3 lang-b3 b3 colorized">F</code><span data-line="1803"></span>. If further axiomatization says that <span data-line="1803"></span><code class="code code1 language-b3 lang-b3 b3 colorized">SeqLength</code><span data-line="1803"></span> always returns a
non-negative integer, then it is important to remember the antecedents <span data-line="1804"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="constant" style="color:purple">0</span> &lt;= %len</code><span data-line="1804"></span> in the
closure, or else the resulting axiomatization would be unsound.
</p><h3 id="sec-example--set-comprehension" class="h2" data-line="1807" data-heading-depth="2" style="display:block"><span data-line="1807"></span><span class="heading-before"><span class="heading-label">20.2</span>.&#8194;</span><span data-line="1807"></span>Example: set comprehension</h3>
<p class="p noindent" data-line="1809"><span data-line="1809"></span>Consider a source-language set comprehension <span data-line="1809"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:teal">set</span> x | Constraint</code><span data-line="1809"></span> (representing <span data-line="1809"></span>&quot;<span data-line="1809"></span>the set of
every <span data-line="1810"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x</code><span data-line="1810"></span> satisfying <span data-line="1810"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Constraint</code><span data-line="1810"></span>), where <span data-line="1810"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x</code><span data-line="1810"></span> has type <span data-line="1810"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:teal">int</span></code><span data-line="1810"></span> and <span data-line="1810"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Constraint</code><span data-line="1810"></span> (which may mention
<span data-line="1811"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x</code><span data-line="1811"></span> and other free variables) translates into B3 as <span data-line="1811"></span><code class="code code1 language-b3 lang-b3 b3 colorized">constraint</code><span data-line="1811"></span>. The set comprehension can then
be translated using the following closure:
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1814" data-line-first="1815" style="display:block"><code data-line="1815"><span style="color:blue">lift</span>
  %body(x: <span style="color:teal">int</span>) := constraint
<span style="color:blue">into</span>
  %s: Set
<span style="color:blue">by</span> {
  <span style="color:blue">forall</span> bx: Box <span style="color:purple">trigger</span> SetContains(%s, bx) ::
    SetContains(%s, bx) &lt;==&gt; %body(Unbox(bx))
}</code></pre>
<p class="p noindent para-continued" data-line="1825"><span data-line="1825"></span>Suppose <span data-line="1825"></span><code class="code code1 language-b3 lang-b3 b3 colorized">constraint</code><span data-line="1825"></span> is the expression <span data-line="1825"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Abs(x - e0) + e1</code><span data-line="1825"></span>. Then, B3 turns the closure into
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1827" data-line-first="1828" style="display:block"><code data-line="1828"><span style="color:blue">function</span> F(body0: <span style="color:teal">int</span>, body1: <span style="color:teal">int</span>): Set
<span style="color:blue">axiom</span> <span style="color:blue">forall</span> body0: <span style="color:teal">int</span>, body1: <span style="color:teal">int</span>, bx: Box
  <span style="color:purple">trigger</span> SetContains(F(body0, body1), bx) ::
  SetContains(F(body0, body1), bx) &lt;==&gt; Abs(Unbox(bx) - body0) + body1)</code></pre>
<p class="p noindent para-continued" data-line="1834"><span data-line="1834"></span>for some new function <span data-line="1834"></span><code class="code code1 language-b3 lang-b3 b3 colorized">F</code><span data-line="1834"></span>. Note how the closure automatically decomposes <span data-line="1834"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Abs(x - e0) + e1</code><span data-line="1834"></span>
into pieces that do not mention <span data-line="1835"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x</code><span data-line="1835"></span>.
</p><h3 id="sec-example--sequence-constructor-with-an-initializing-lambda-expression" class="h2" data-line="1837" data-heading-depth="2" style="display:block"><span data-line="1837"></span><span class="heading-before"><span class="heading-label">20.3</span>.&#8194;</span><span data-line="1837"></span>Example: sequence constructor with an initializing lambda expression</h3>
<p class="p noindent" data-line="1839"><span data-line="1839"></span>As a variation of the sequence constructor above, a translation may want to optimize the case where
the expression <span data-line="1840"></span><code class="code code1 language-b3 lang-b3 b3 colorized">E</code><span data-line="1840"></span> is a lambda expression, like <span data-line="1840"></span><code class="code code1 language-b3 lang-b3 b3 colorized">i =&gt; Body</code><span data-line="1840"></span>. If <span data-line="1840"></span><code class="code code1 language-b3 lang-b3 b3 colorized">N</code><span data-line="1840"></span> and <span data-line="1840"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Body</code><span data-line="1840"></span> translate into <span data-line="1840"></span><code class="code code1 language-b3 lang-b3 b3 colorized">n</code><span data-line="1840"></span>
and <span data-line="1841"></span><code class="code code1 language-b3 lang-b3 b3 colorized">body</code><span data-line="1841"></span>, then a translation of <span data-line="1841"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:teal">seq</span>(N, i =&gt; Body)</code><span data-line="1841"></span> into a closure is
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1843" data-line-first="1844" style="display:block"><code data-line="1844"><span style="color:blue">lift</span>
  %len := n,
  %elements(i: <span style="color:teal">int</span>) := body
<span style="color:blue">into</span>
  %s: Sequence
<span style="color:blue">by</span> {
  <span style="color:purple">trigger</span> SeqLength(%s) :: <span class="constant" style="color:purple">0</span> &lt;= %len ==&gt; SeqLength(%s) = %len,
  <span style="color:blue">forall</span> j: <span style="color:teal">int</span> <span style="color:purple">trigger</span> SeqIndex(%s, j) ::
    <span class="constant" style="color:purple">0</span> &lt;= j &amp;&amp; j &lt; %len ==&gt; SeqIndex(%s, j) = Box(%elements(j))
}</code></pre>
<p class="p noindent para-continued" data-line="1856"><span data-line="1856"></span>Suppose <span data-line="1856"></span><code class="code code1 language-b3 lang-b3 b3 colorized">body</code><span data-line="1856"></span> is <span data-line="1856"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Abs(i - e0) + e1</code><span data-line="1856"></span>. Then, B3 turns this closure into:
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1858" data-line-first="1859" style="display:block"><code data-line="1859"><span style="color:blue">function</span> F(len: <span style="color:teal">int</span>, elements0: <span style="color:teal">int</span>, elements1: <span style="color:teal">int</span>): Sequence
<span style="color:blue">axiom</span> <span style="color:blue">forall</span> len: <span style="color:teal">int</span>, elements0: <span style="color:teal">int</span>, elements1: <span style="color:teal">int</span>
  <span style="color:purple">trigger</span> SeqLength(F(len, elements0, elements1)) ::
  <span class="constant" style="color:purple">0</span> &lt;= len ==&gt; SeqLength(F(len, elements0, elements1)) = len
<span style="color:blue">axiom</span> <span style="color:blue">forall</span> len: <span style="color:teal">int</span>, elements0: <span style="color:teal">int</span>, elements1: <span style="color:teal">int</span>, j: <span style="color:teal">int</span>
  <span style="color:purple">trigger</span> SeqIndex(F(len, elements0, elements1), j) ::
  <span class="constant" style="color:purple">0</span> &lt;= j &amp;&amp; j &lt; len ==&gt;
    SeqIndex(F(len, elements0, elements1), j) = Box(Abs(j - elements0) + elements1)</code></pre><h3 id="sec-elaboration" class="h2" data-line="1869" data-heading-depth="2" style="display:block"><span data-line="1869"></span><span class="heading-before"><span class="heading-label">20.4</span>.&#8194;</span><span data-line="1869"></span>Elaboration</h3>
<p class="p noindent" data-line="1871"><span data-line="1871"></span>It<span data-line="1871"></span>&#39;<span data-line="1871"></span>s time for the full details of elaboration. As a concrete representative of a general closure, consider
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1873" data-line-first="1874" style="display:block"><code data-line="1874"><span style="color:blue">lift</span> %b(x: X) := e <span style="color:blue">into</span> %s: S <span style="color:blue">by</span> { p }</code></pre><h5 id="sec-function-name" class="h4" data-line="1877" data-heading-depth="4" style="display:block"><span data-line="1877"></span>Function name</h5>
<p class="p noindent" data-line="1879"><span data-line="1879"></span>Elaboration first creates a name for the resulting function, say <span data-line="1879"></span><code class="code code1 language-b3 lang-b3 b3 colorized">F</code><span data-line="1879"></span>. This function<span data-line="1879"></span>&#39;<span data-line="1879"></span>s result type is the
given type <span data-line="1880"></span><code class="code code1 language-b3 lang-b3 b3 colorized">S</code><span data-line="1880"></span>. The parameters of <span data-line="1880"></span><code class="code code1 language-b3 lang-b3 b3 colorized">F</code><span data-line="1880"></span> are going to be determined as part of processing the closure bindings.
</p><h5 id="sec-holes" class="h4" data-line="1882" data-heading-depth="4" style="display:block"><span data-line="1882"></span>Holes</h5>
<p class="p noindent" data-line="1884"><span data-line="1884"></span>Then, for each binding <span data-line="1884"></span><code class="code code1 language-b3 lang-b3 b3 colorized">%b(x: X) := e</code><span data-line="1884"></span>, elaboration finds non-overlapping subexpressions <span data-line="1884"></span><code class="code code1 language-b3 lang-b3 b3 colorized">e0</code><span data-line="1884"></span>, <span data-line="1884"></span><code class="code code1 language-b3 lang-b3 b3 colorized">e1</code><span data-line="1884"></span>, <span data-line="1884"></span>&#8230;<span data-line="1884"></span> of <span data-line="1884"></span><code class="code code1 language-b3 lang-b3 b3 colorized">e</code><span data-line="1884"></span>
such that <span data-line="1885"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x</code><span data-line="1885"></span> is not a free variable of any <span data-line="1885"></span><code class="code code1 language-b3 lang-b3 b3 colorized">e<span class="code-escaped"><em class="em-low1">i</em></span></code><span data-line="1885"></span> and every occurrence of a non-<span data-line="1885"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x</code><span data-line="1885"></span> variable in <span data-line="1885"></span><code class="code code1 language-b3 lang-b3 b3 colorized">e</code><span data-line="1885"></span> is
contained in one of the <span data-line="1886"></span><code class="code code1 language-b3 lang-b3 b3 colorized">e<span class="code-escaped"><em class="em-low1">i</em></span></code><span data-line="1886"></span>. In the literature, the places where these <span data-line="1886"></span><code class="code code1 language-b3 lang-b3 b3 colorized">e<span class="code-escaped"><em class="em-low1">i</em></span></code><span data-line="1886"></span> appear in <span data-line="1886"></span><code class="code code1 language-b3 lang-b3 b3 colorized">e</code><span data-line="1886"></span> can be
considered to be <span data-line="1887"></span><em class="em-low1">holes</em><span data-line="1887"></span>, often denoted by <span data-line="1887"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.7479em;width:0.8565em" viewBox='88.468 54.912 8.157 7.123'><desc>$\square$</desc><g id='math-ec3446'><use x='88.667' y='61.836' xlink:href='#g1-3'/></g></svg></span></code><span data-line="1887"></span>.
</p>
<p class="p indent" data-line="1889"><span data-line="1889"></span>For example, suppose <span data-line="1889"></span><code class="code code1 language-b3 lang-b3 b3 colorized">e</code><span data-line="1889"></span> is the expression <span data-line="1889"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="constant" style="color:purple">1</span> + y + Abs(x - G(u))</code><span data-line="1889"></span>. There are several ways to carve out holes for
this expression. One way is
</p>
<pre class="para-block pre-indented language-b3 lang-b3 b3 colorized" data-line="1892" style="display:block"><code><span class="constant" style="color:purple">1</span> + <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.7479em;width:0.8565em" viewBox='88.468 54.912 8.157 7.123'><desc>$\square$</desc><g id='math-ec3446'><use x='88.667' y='61.836' xlink:href='#g1-3'/></g></svg></span> + Abs(x - G(<span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.7479em;width:0.8565em" viewBox='88.468 54.912 8.157 7.123'><desc>$\square$</desc><g id='math-ec3446'><use x='88.667' y='61.836' xlink:href='#g1-3'/></g></svg></span>))</code></pre>
<p class="p noindent para-continued" data-line="1894"><span data-line="1894"></span>The subexpressions removed to make these holes are <span data-line="1894"></span><code class="code code1 language-b3 lang-b3 b3 colorized">y</code><span data-line="1894"></span> and <span data-line="1894"></span><code class="code code1 language-b3 lang-b3 b3 colorized">u</code><span data-line="1894"></span>, each one a non-<span data-line="1894"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x</code><span data-line="1894"></span> free variable of the expression.
Another way to carve out holes is
</p>
<pre class="para-block pre-indented language-b3 lang-b3 b3 colorized" data-line="1897" style="display:block"><code><span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.7479em;width:0.8565em" viewBox='88.468 54.912 8.157 7.123'><desc>$\square$</desc><g id='math-ec3446'><use x='88.667' y='61.836' xlink:href='#g1-3'/></g></svg></span> + Abs(x - <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.7479em;width:0.8565em" viewBox='88.468 54.912 8.157 7.123'><desc>$\square$</desc><g id='math-ec3446'><use x='88.667' y='61.836' xlink:href='#g1-3'/></g></svg></span>)</code></pre>
<p class="p noindent para-continued" data-line="1899"><span data-line="1899"></span>Here, the subexpressions removed to make these holes are <span data-line="1899"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="constant" style="color:purple">1</span> + y</code><span data-line="1899"></span> and <span data-line="1899"></span><code class="code code1 language-b3 lang-b3 b3 colorized">G(u)</code><span data-line="1899"></span>, and the strategy used to define these
holes is to make each hole as large as possible (but not so large as to include an occurrence of <span data-line="1900"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x</code><span data-line="1900"></span>).
Note that if the closure binding <span data-line="1901"></span><code class="code code1 language-b3 lang-b3 b3 colorized">%b(x: X)</code><span data-line="1901"></span> doesn<span data-line="1901"></span>&#39;<span data-line="1901"></span>t have any parameters (in other words, it is just <span data-line="1901"></span><code class="code code1 language-b3 lang-b3 b3 colorized">%b</code><span data-line="1901"></span>), then
the as-large-as-possible strategy can always carve out the entire expression as a hole.
</p>
<p class="p indent" data-line="1904"><span data-line="1904"></span>Any way of defining the holes works. For the purpose of continuing the description of elaboration, we<span data-line="1904"></span>&#39;<span data-line="1904"></span>ll use
the as-large-as-possible strategy.
</p><h5 id="sec-function-parameters" class="h4" data-line="1907" data-heading-depth="4" style="display:block"><span data-line="1907"></span>Function parameters</h5>
<p class="p noindent" data-line="1909"><span data-line="1909"></span>For each hole, introduce a parameter to the closure function. One way to do this is to use the name of the
closure variable (in the example, <span data-line="1910"></span><code class="code code1 language-b3 lang-b3 b3 colorized">%b</code><span data-line="1910"></span>) if there<span data-line="1910"></span>&#39;<span data-line="1910"></span>s just one hole, and otherwise to append  <span data-line="1910"></span><code class="code code1 language-b3 lang-b3 b3 colorized">%<span class="code-escaped"><em class="em-low1">i</em></span></code><span data-line="1910"></span> to this
name, where <span data-line="1911"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped"><em class="em-low1">i</em></span></code><span data-line="1911"></span> is the number of holes preceding it. (In the motivating examples above, the names used
were these, but without the <span data-line="1912"></span><code class="code code1 language-b3 lang-b3 b3 colorized">%</code><span data-line="1912"></span>&#39;<span data-line="1912"></span>s.)
</p>
<p class="p indent" data-line="1914"><span data-line="1914"></span>For <span data-line="1914"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.7479em;width:0.8565em" viewBox='88.468 54.912 8.157 7.123'><desc>$\square$</desc><g id='math-ec3446'><use x='88.667' y='61.836' xlink:href='#g1-3'/></g></svg></span> + Abs(x - <span class="code-escaped"><svg  class="math-inline math-render-svg math" style="vertical-align:-0.0210em;height:0.7479em;width:0.8565em" viewBox='88.468 54.912 8.157 7.123'><desc>$\square$</desc><g id='math-ec3446'><use x='88.667' y='61.836' xlink:href='#g1-3'/></g></svg></span>)</code><span data-line="1914"></span>, we thus introduce parameters <span data-line="1914"></span><code class="code code1 language-b3 lang-b3 b3 colorized">%b%<span class="constant" style="color:purple">0</span></code><span data-line="1914"></span> and <span data-line="1914"></span><code class="code code1 language-b3 lang-b3 b3 colorized">%b%<span class="constant" style="color:purple">1</span></code><span data-line="1914"></span>. The types of these parameters is
the type of the expression removed to make the hole (in the example, <span data-line="1915"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:teal">int</span></code><span data-line="1915"></span> and <span data-line="1915"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:teal">int</span></code><span data-line="1915"></span>). Note that these are just
variable names, not function (even though the closure declares <span data-line="1916"></span><code class="code code1 language-b3 lang-b3 b3 colorized">%b(x: X)</code><span data-line="1916"></span> to look like a function).
</p><h5 id="sec-closure-function" class="h4" data-line="1918" data-heading-depth="4" style="display:block"><span data-line="1918"></span>Closure function</h5>
<p class="p noindent" data-line="1920"><span data-line="1920"></span>These <span data-line="1920"></span>&#8220;Holes&#8221;<span data-line="1920"></span> and <span data-line="1920"></span>&#8220;Function parameters&#8221;<span data-line="1920"></span> steps above are followed for all closure bindings. Concatenating all
the function parameters, the closure function is declared. In the example, it is
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1923" data-line-first="1924" style="display:block"><code data-line="1924"><span style="color:blue">function</span> F(%b%<span class="constant" style="color:purple">0</span>: <span style="color:teal">int</span>, %b%<span class="constant" style="color:purple">1</span>: <span style="color:teal">int</span>): S</code></pre><h5 id="sec-lifting" class="h4" data-line="1927" data-heading-depth="4" style="display:block"><span data-line="1927"></span>Lifting</h5>
<p class="p noindent" data-line="1929"><span data-line="1929"></span>The closure is now replaced by the closure function applied to the subexpressions that were carved out for each
hole. In our example, this function application thus becomes
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1932" data-line-first="1933" style="display:block"><code data-line="1933">F(<span class="constant" style="color:purple">1</span> + y, G(u))</code></pre><h5 id="sec-lifting-axioms" class="h4" data-line="1936" data-heading-depth="4" style="display:block"><span data-line="1936"></span>Lifting axioms</h5>
<p class="p noindent" data-line="1938"><span data-line="1938"></span>The final step in elaborating the closure is to generate axioms, one for each given closure property.
</p>
<p class="p indent" data-line="1940"><span data-line="1940"></span>In the closure property, replace the closure variable <span data-line="1940"></span><code class="code code1 language-b3 lang-b3 b3 colorized">%s</code><span data-line="1940"></span> by the closure function applied to its formal
parameters (or, more precisely, to new bound variables that are like the parameters of the function).
In the example, <span data-line="1942"></span><code class="code code1 language-b3 lang-b3 b3 colorized">%s</code><span data-line="1942"></span> is thus replaced by the function application <span data-line="1942"></span><code class="code code1 language-b3 lang-b3 b3 colorized">F(%b%<span class="constant" style="color:purple">0</span>, %b%<span class="constant" style="color:purple">1</span>)</code><span data-line="1942"></span>.
</p>
<p class="p indent" data-line="1944"><span data-line="1944"></span>Next, replace each application <span data-line="1944"></span><code class="code code1 language-b3 lang-b3 b3 colorized">%b(e0)</code><span data-line="1944"></span> of a closure binding by the corresponding expression with holes,
where each hole is replaced by the corresponding function parameter (again, more precisely, to the bound
variable that is like the function parameter) and replace each occurrence of the binding parameter (in the
example, <span data-line="1947"></span><code class="code code1 language-b3 lang-b3 b3 colorized">x: X</code><span data-line="1947"></span>) with <span data-line="1947"></span><code class="code code1 language-b3 lang-b3 b3 colorized">e0</code><span data-line="1947"></span>. In the example, <span data-line="1947"></span><code class="code code1 language-b3 lang-b3 b3 colorized">%b(e)</code><span data-line="1947"></span> is thus replaced by the expression
<span data-line="1948"></span><code class="code code1 language-b3 lang-b3 b3 colorized">%b%<span class="constant" style="color:purple">0</span> + Abs(e0 - %b%<span class="constant" style="color:purple">1</span>)</code><span data-line="1948"></span>.
</p>
<p class="p indent" data-line="1950"><span data-line="1950"></span>Finally, wrap a universal quantifier around the resulting closure property. The quantifier has the
function parameters as its bound variable (these are the bound variables that were alluded to by <span data-line="1951"></span>&#8220;more precisely&#8221;<span data-line="1951"></span>
in the previous two paragraphs). The trigger for the quantifier is the application of the closure function,
that is, the expansion of <span data-line="1953"></span><code class="code code1 language-b3 lang-b3 b3 colorized">%s</code><span data-line="1953"></span>.
</p>
<p class="p indent" data-line="1955"><span data-line="1955"></span>There are two plot twists involved in wrapping the universal quantifier as just described. One plot twist
is that if the the closure property has the form <span data-line="1956"></span><code class="code code1 language-b3 lang-b3 b3 colorized"><span style="color:purple">trigger</span> tr ... :: p0</code><span data-line="1956"></span>, then the generated quantifier
uses the specified triggers instead of the default trigger <span data-line="1957"></span><code class="code code1 language-b3 lang-b3 b3 colorized">%s</code><span data-line="1957"></span>. The other plot twist is if the closure
property is a universal quantifier, say <span data-line="1958"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Q</code><span data-line="1958"></span>, by itself. In that case, the generated quantifier is merged
with the quantifier <span data-line="1959"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Q</code><span data-line="1959"></span> and the triggers used are the those given in <span data-line="1959"></span><code class="code code1 language-b3 lang-b3 b3 colorized">Q</code><span data-line="1959"></span>.
</p>
<p class="p indent" data-line="1961"><span data-line="1961"></span>Note that, since the bound variables of the universal quantifer are generated automatically during the
elaboration of a closure, the only way to mention those variables in a trigger is to make use of <span data-line="1962"></span><code class="code code1 language-b3 lang-b3 b3 colorized">%s</code><span data-line="1962"></span>.
</p><h2 id="sec-macros" class="h1" data-line="1964" data-heading-depth="1" style="display:block"><span data-line="1964"></span><span class="heading-before"><span class="heading-label">21</span>.&#8194;</span><span data-line="1964"></span>Macros</h2>
<p class="p noindent" data-line="1966"><span data-line="1966"></span>Some expressions and statement lists are used in custom patterns. To facilitate simpler generation and reading
of B3 programs, there are macros. The macros come in three forms, one for expressions, one for statements, and
one for the special case of the statements being assertions:
</p>
<pre class="para-block pre-fenced pre-fenced3 language-b3 lang-b3 b3 colorized" data-line="1970" data-line-first="1971" style="display:block"><code data-line="1971">TopLevelDeclaration ::=
  | ...
  | <span style="color:blue">define</span> Identifier <span style="color:maroon">&quot;</span><span style="color:maroon">(</span><span style="color:maroon">&quot;</span> Identifier<span class="code-escaped"><sup>*,</sup></span> <span style="color:maroon">&quot;</span><span style="color:maroon">)</span><span style="color:maroon">&quot;</span> Expr
  | <span style="color:blue">define</span> Identifier <span style="color:maroon">&quot;</span><span style="color:maroon">(</span><span style="color:maroon">&quot;</span> Identifier<span class="code-escaped"><sup>*,</sup></span> <span style="color:maroon">&quot;</span><span style="color:maroon">)</span><span style="color:maroon">&quot;</span> Block
  | <span style="color:blue">define</span> Identifier <span style="color:maroon">&quot;</span><span style="color:maroon">(</span><span style="color:maroon">&quot;</span> Identifier<span class="code-escaped"><sup>*,</sup></span> <span style="color:maroon">&quot;</span><span style="color:maroon">)</span><span style="color:maroon">&quot;</span> ABlock</code></pre>
<p class="p noindent para-continued" data-line="1978"><span data-line="1978"></span>Following Viper, the parameters are given names, but no types. Typing is done after the macros have been
elaborated. Macros are not allowed to be recursive.
</p>
<p class="p indent" data-line="1981"><span data-line="1981"></span>Since the macro parameters have no types, it is not possible to type check the bodies of the macros independently
of their usage sites. However, two things are done with the variable names used inside the macro body.
One is that the free names in the macro body must be parameters of the macro. The other is that all names
that are bound inside the macro body are uniquely renamed. This automatic renaming can be done by prefixing
each bound variable name with <span data-line="1985"></span><code class="code code1 language-b3 lang-b3 b3 colorized">m%</code><span data-line="1985"></span>, where <span data-line="1985"></span><code class="code code1 language-b3 lang-b3 b3 colorized">m</code><span data-line="1985"></span> is the name of the macro.
</p><h2 id="sec-attributes" class="h1" data-line="1987" data-heading-depth="1" style="display:block"><span data-line="1987"></span><span class="heading-before"><span class="heading-label">22</span>.&#8194;</span><span data-line="1987"></span>Attributes</h2>
<p class="p noindent" data-line="1989"><span data-line="1989"></span>All top-level declarations and some statements can be marked with custom <span data-line="1989"></span><em class="em-low1">attributes</em><span data-line="1989"></span>. These are
not given any semantics by the B3 language but are useful for third-party tools that operate on B3 programs.
</p><span data-line=""></span></div>
<svg id='math-svg-paths' style='display:none' version='1.1' viewBox='0 0 0 0' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'>
<defs>
<path id='g3-34' d='M1.405-2.262C1.733-2.122 2.022-2.122 2.262-2.122C2.521-2.122 3.068-2.122 3.068-2.431C3.068-2.67 2.72-2.7 2.341-2.7C2.132-2.7 1.783-2.68 1.415-2.511C1.186-2.63 1.016-2.819 1.016-3.088C1.016-3.696 1.993-4.055 2.889-4.055C3.049-4.055 3.407-4.055 3.806-3.776C3.915-3.696 3.935-3.676 4.005-3.676C4.134-3.676 4.274-3.806 4.274-3.945C4.274-4.134 3.666-4.513 2.989-4.513C1.843-4.513 .767-3.846 .767-3.088C.767-2.66 1.126-2.411 1.166-2.381C.578-2.052 .259-1.494 .259-1.036C.259-.389 .827 .219 1.883 .219C3.198 .219 3.756-.658 3.756-.807C3.756-.867 3.706-.907 3.646-.907C3.597-.907 3.567-.867 3.547-.837C3.407-.608 3.168-.239 1.973-.239C1.365-.239 .518-.389 .518-1.096C.518-1.435 .797-1.963 1.405-2.262ZM1.733-2.391C1.963-2.471 2.172-2.481 2.341-2.481C2.59-2.481 2.63-2.471 2.809-2.421C2.66-2.351 2.64-2.341 2.262-2.341C2.042-2.341 1.923-2.341 1.733-2.391Z'/>
<path id='g2-1' d='M1.913-2.491C1.913-2.78 1.674-3.019 1.385-3.019S.857-2.78 .857-2.491S1.096-1.963 1.385-1.963S1.913-2.202 1.913-2.491Z'/>
<path id='g2-41' d='M7.233-3.258C7.651-2.899 8.159-2.64 8.488-2.491C8.13-2.331 7.641-2.072 7.233-1.724H.907C.737-1.724 .548-1.724 .548-1.524S.727-1.325 .897-1.325H6.785C6.306-.867 5.788 .01 5.788 .139C5.788 .249 5.918 .249 5.978 .249C6.057 .249 6.127 .249 6.167 .169C6.376-.209 6.655-.737 7.303-1.315C7.99-1.923 8.658-2.192 9.176-2.341C9.345-2.401 9.355-2.411 9.375-2.431C9.395-2.441 9.395-2.471 9.395-2.491S9.395-2.531 9.385-2.55L9.355-2.57C9.335-2.58 9.325-2.59 9.136-2.65C7.791-3.049 6.795-3.955 6.237-5.021C6.127-5.22 6.117-5.23 5.978-5.23C5.918-5.23 5.788-5.23 5.788-5.121C5.788-4.991 6.296-4.125 6.785-3.656H.897C.727-3.656 .548-3.656 .548-3.457S.737-3.258 .907-3.258H7.233Z'/>
<path id='g4-61' d='M6.844-3.258C6.994-3.258 7.183-3.258 7.183-3.457S6.994-3.656 6.854-3.656H.887C.747-3.656 .558-3.656 .558-3.457S.747-3.258 .897-3.258H6.844ZM6.854-1.325C6.994-1.325 7.183-1.325 7.183-1.524S6.994-1.724 6.844-1.724H.897C.747-1.724 .558-1.724 .558-1.524S.747-1.325 .887-1.325H6.854Z'/>
<path id='g0-74' d='M1.156 2.381C1.156 2.441 1.205 2.491 1.265 2.491H3.666C3.736 2.491 3.786 2.441 3.786 2.381V2.202C3.786 2.142 3.736 2.092 3.666 2.092H2.79V-7.073H3.666C3.736-7.073 3.786-7.123 3.786-7.183V-7.362C3.786-7.422 3.736-7.472 3.666-7.472H1.265C1.205-7.472 1.156-7.422 1.156-7.362V2.381ZM2.391-7.073V2.092H1.554V-7.073H2.391Z'/>
<path id='g0-75' d='M1.594 2.092V-7.073H2.441V2.092H1.594ZM2.839 2.381V-7.362C2.839-7.422 2.79-7.472 2.73-7.472H.349C.289-7.472 .239-7.422 .239-7.362V-7.183C.239-7.123 .289-7.073 .349-7.073H1.196V2.092H.349C.289 2.092 .239 2.142 .239 2.202V2.381C.239 2.441 .289 2.491 .349 2.491H2.73C2.79 2.491 2.839 2.441 2.839 2.381Z'/>
<path id='g1-3' d='M7.183-6.496C7.183-6.804 7.153-6.844 6.834-6.844H.907C.598-6.844 .558-6.814 .558-6.496V-.359C.558-.04 .588 0 .917 0H6.824C7.153 0 7.183-.03 7.183-.349V-6.496ZM.956-6.446H6.785V-.399H.956V-6.446Z'/>
</defs>
</svg>

</body>

</html>
